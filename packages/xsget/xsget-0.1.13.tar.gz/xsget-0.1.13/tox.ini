[tox]
isolated_build = True
envlist = py3{8,9,10,11,12}

[testenv]
description = testing against {basepython}
deps = pipenv
commands =
    pipenv install --dev
    pipenv run pytest --numprocesses auto --hide-run-results

[testenv:cov]
description = generate code coverage report in html
basepython = python3.11
deps = pipenv
commands =
    pipenv install --dev
    pipenv run pytest --numprocesses auto --cov --cov-report=term --cov-report=html {toxinidir}/tests

[testenv:doc]
description = generate sphinx documentation in html
basepython = python3.11
deps = pipenv
commands =
    pipenv install --categories doc
    pipenv run sphinx-build {toxinidir}/docs/source/ {toxinidir}/docs/build/html

[testenv:pot]
description = update pot/po/mo files
basepython = python3.11
deps = Babel
allowlist_externals =
    msgmerge
    msgfmt
commands =
    pybabel extract \
        {toxinidir}/xsget/ \
        -o {toxinidir}/xsget/locales/xstxt.pot \
        --omit-header

    pybabel update \
        -o {toxinidir}/xsget/locales/en/LC_MESSAGES/xstxt.po \
        -i {toxinidir}/xsget/locales/xstxt.pot \
        -l en \
        --omit-header
    pybabel update \
        -o {toxinidir}/xsget/locales/zh/LC_MESSAGES/xstxt.po \
        -i {toxinidir}/xsget/locales/xstxt.pot \
        -l zh \
        --omit-header

    pybabel compile \
        -o {toxinidir}/xsget/locales/en/LC_MESSAGES/xstxt.mo \
        -i {toxinidir}/xsget/locales/en/LC_MESSAGES/xstxt.po \
        -l en \
        -f
    pybabel compile \
        -o {toxinidir}/xsget/locales/zh/LC_MESSAGES/xstxt.mo \
        -i {toxinidir}/xsget/locales/zh/LC_MESSAGES/xstxt.po \
        -l zh \
        -f
