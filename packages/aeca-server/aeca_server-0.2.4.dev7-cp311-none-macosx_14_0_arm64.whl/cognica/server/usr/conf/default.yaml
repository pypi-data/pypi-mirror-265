---
thread_pool:
  generic:
    num_threads: 0    # use default
  batch:
    num_threads: 0    # use default
  query:
    num_threads: 10
  schema:
    num_threads: 0    # use default
  disk_io:
    num_threads: 0    # use default

db:
  table:
    format_version: 6
    block_size: 32_KB
    enable_index_compression: true
    block_restart_interval: 16
    index_block_restart_interval: 1
    data_block_hash_table_util_ratio: 0.75
    optimize_filters_for_memory: true
    partition_filters: true
    metadata_block_size: 4_KB
    cache_index_and_filter_blocks: true
    cache_index_and_filter_blocks_with_high_priority: true
    whole_key_filtering: true
    filter_policy: ribbon
  block_cache:
    enabled: true
    cache_capacity: 8_GB
    cache_shard_bits: 3
    strict_capacity_limit: true
  secondary_cache:
    enabled: false
    cache_capacity: 4_GB
    cache_shard_bits: 2
    strict_capacity_limit: true
    enable_custom_split_merge: true
  row_cache:
    enabled: false
    cache_capacity: 4_GB
    cache_shard_bits: 2
    strict_capacity_limit: true
  compression:
    enabled: true
    algorithm: lz4
    max_dict_bytes: 32_KB
    zstd_max_train_bytes: 3_MB
    parallel_threads: 2
  bottommost_compression:
    enabled: true
    algorithm: zstd
    max_dict_bytes: 32_KB
    zstd_max_train_bytes: 3_MB
    parallel_threads: 2
  compression_per_level:
    - lz4
    - lz4
    - lz4
    - lz4
    - lz4
    - zstd
    - zstd
  auto_compaction:
    sequential_deletes: 128_K
    sequential_deletes_window: 384_K
  manual_compaction:
    exclusive_manual_compaction: false
    change_level: true
    bottommost_level_compaction: kIfHaveCompactionFilter
    allow_write_stall: false
    max_subcompactions: 2
  storage:
    db_path: ./data/cognica.db
    # db_path: ./data/cognica.db-cliwant-fts
    # db_path: ./data/cognica.db-cliwant
    # db_path: ./data/cognica-wiki-simple.db
    info_log_level: debug

    enable_blob_files: false
    enable_blob_garbage_collection: false
    blob_garbage_collection_age_cutoff: 0.25

    readahead_size: 256_KB
    compaction_readahead_size: 8_MB
    bulk_scan_fill_cache: true

    advise_random_on_open: true
    access_hint_on_compaction_start: normal
    experimental_mempurge_threshold: 1.0
    use_adaptive_mutex: true
    use_direct_reads: true
    use_direct_io_for_flush_and_compaction: true
    writable_file_max_buffer_size: 16_MB
    memtable_prefix_bloom_size_ratio: 0.2

    max_background_jobs: 8
    max_open_files: -1
    max_file_opening_threads: 32
    keep_log_file_num: 10
    recycle_log_file_num: 16

    max_sequential_skip_in_iterations: 128
    max_successive_merges: 0
    optimize_filters_for_hits: true
    force_consistency_checks: false

    write_buffer_size: 256_MB
    min_write_buffer_number_to_merge: 1
    max_write_buffer_number: 16
    arena_block_size: 16_MB
    max_total_wal_size: 2_GB
    wal_bytes_per_sync: 128_MB
    wal_compression: zstd

    wal_ttl_seconds: 3600     # 1 hour
    wal_size_limit_mb: 0_MB   # 0 means no limit

    periodic_compaction_seconds: 172800   # 48 hours
    max_subcompactions: 2

    avoid_unnecessary_blocking_io: true

    enable_pipelined_write: true
    enable_unordered_write: false

    paranoid_checks: true

    transaction_lock_timeout: 40000    # 5 seconds

    dump_malloc_stats: false
    report_bg_io_stats: false
    dump_storage_stats: false
  statistics:
    enabled: false
    level: kExceptDetailedTimers
  rate_limiter:
    enabled: false
    rate_bytes_per_sec: 512_MB
    auto_tuned: true
  document:
    parallel_operation_threshold: 1000
  fts:
    query_cache:
      enabled: true
      capacity: 10240
      num_shards: 8
    hnsw_index:
      flush_before_search: false
    max_query_terms: 1024
    max_search_limit: 100000

logger:
  general:
    level: trace
    sinks:
      - stdout
      - type: file
        max_files: 5
  error:
    level: trace
    sinks:
      - stderr
      - type: file
        max_files: 5
  access:
    level: trace
    sinks:
      - stdout
      - type: file
        max_files: 5
  querylog:
    level: info
    sinks:
      - stdout
      - type: file
        max_files: 5
  slowlog:
    level: trace
    sinks:
      - stdout
      - type: file
        max_files: 5
  system:
    level: trace
    sinks:
      - type: file
        max_files: 5
  cdc:
    level: trace
    sinks:
      - type: file
        max_files: 5
