{"ast":null,"code":"import _objectSpread from\"/home/runner/work/inference/inference/xinference/web/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{Cookies}from'react-cookie';import{isValidBearerToken}from'./utils';var cookies=new Cookies();var updateOptions=function updateOptions(url,options){var update=_objectSpread({},options);if(cookies.get('token')!=='no_auth'){update.headers=_objectSpread(_objectSpread({},update.headers),{},{Authorization:'Bearer '+cookies.get('token')});}return update;};export default function fetcher(url,options){return fetch(url,updateOptions(url,options)).then(function(res){// For the situation that server has already been restarted, the current token may become invalid,\n// which leads to UI hangs.\nif(res.status===401&&isValidBearerToken(cookies.get('token'))){if(localStorage.getItem('authStatus')!=='401'){localStorage.setItem('authStatus','401');window.dispatchEvent(new Event('auth-status'));}}else if(res.status===403&&isValidBearerToken(cookies.get('token'))){if(localStorage.getItem('authStatus')!=='403'){localStorage.setItem('authStatus','403');window.dispatchEvent(new Event('auth-status'));}}else{return res;}});}","map":{"version":3,"names":["Cookies","isValidBearerToken","cookies","updateOptions","url","options","update","_objectSpread","get","headers","Authorization","fetcher","fetch","then","res","status","localStorage","getItem","setItem","window","dispatchEvent","Event"],"sources":["/home/runner/work/inference/inference/xinference/web/ui/src/components/fetcher.js"],"sourcesContent":["import { Cookies } from 'react-cookie'\n\nimport { isValidBearerToken } from './utils'\n\nconst cookies = new Cookies()\n\nconst updateOptions = (url, options) => {\n  const update = { ...options }\n  if (cookies.get('token') !== 'no_auth') {\n    update.headers = {\n      ...update.headers,\n      Authorization: 'Bearer ' + cookies.get('token'),\n    }\n  }\n  return update\n}\n\nexport default function fetcher(url, options) {\n  return fetch(url, updateOptions(url, options)).then((res) => {\n    // For the situation that server has already been restarted, the current token may become invalid,\n    // which leads to UI hangs.\n    if (res.status === 401 && isValidBearerToken(cookies.get('token'))) {\n      if (localStorage.getItem('authStatus') !== '401') {\n        localStorage.setItem('authStatus', '401')\n        window.dispatchEvent(new Event('auth-status'))\n      }\n    } else if (res.status === 403 && isValidBearerToken(cookies.get('token'))) {\n      if (localStorage.getItem('authStatus') !== '403') {\n        localStorage.setItem('authStatus', '403')\n        window.dispatchEvent(new Event('auth-status'))\n      }\n    } else {\n      return res\n    }\n  })\n}\n"],"mappings":"4IAAA,OAASA,OAAO,KAAQ,cAAc,CAEtC,OAASC,kBAAkB,KAAQ,SAAS,CAE5C,GAAM,CAAAC,OAAO,CAAG,GAAI,CAAAF,OAAO,CAAC,CAAC,CAE7B,GAAM,CAAAG,aAAa,CAAG,QAAhB,CAAAA,aAAaA,CAAIC,GAAG,CAAEC,OAAO,CAAK,CACtC,GAAM,CAAAC,MAAM,CAAAC,aAAA,IAAQF,OAAO,CAAE,CAC7B,GAAIH,OAAO,CAACM,GAAG,CAAC,OAAO,CAAC,GAAK,SAAS,CAAE,CACtCF,MAAM,CAACG,OAAO,CAAAF,aAAA,CAAAA,aAAA,IACTD,MAAM,CAACG,OAAO,MACjBC,aAAa,CAAE,SAAS,CAAGR,OAAO,CAACM,GAAG,CAAC,OAAO,CAAC,EAChD,CACH,CACA,MAAO,CAAAF,MAAM,CACf,CAAC,CAED,cAAe,SAAS,CAAAK,OAAOA,CAACP,GAAG,CAAEC,OAAO,CAAE,CAC5C,MAAO,CAAAO,KAAK,CAACR,GAAG,CAAED,aAAa,CAACC,GAAG,CAAEC,OAAO,CAAC,CAAC,CAACQ,IAAI,CAAC,SAACC,GAAG,CAAK,CAC3D;AACA;AACA,GAAIA,GAAG,CAACC,MAAM,GAAK,GAAG,EAAId,kBAAkB,CAACC,OAAO,CAACM,GAAG,CAAC,OAAO,CAAC,CAAC,CAAE,CAClE,GAAIQ,YAAY,CAACC,OAAO,CAAC,YAAY,CAAC,GAAK,KAAK,CAAE,CAChDD,YAAY,CAACE,OAAO,CAAC,YAAY,CAAE,KAAK,CAAC,CACzCC,MAAM,CAACC,aAAa,CAAC,GAAI,CAAAC,KAAK,CAAC,aAAa,CAAC,CAAC,CAChD,CACF,CAAC,IAAM,IAAIP,GAAG,CAACC,MAAM,GAAK,GAAG,EAAId,kBAAkB,CAACC,OAAO,CAACM,GAAG,CAAC,OAAO,CAAC,CAAC,CAAE,CACzE,GAAIQ,YAAY,CAACC,OAAO,CAAC,YAAY,CAAC,GAAK,KAAK,CAAE,CAChDD,YAAY,CAACE,OAAO,CAAC,YAAY,CAAE,KAAK,CAAC,CACzCC,MAAM,CAACC,aAAa,CAAC,GAAI,CAAAC,KAAK,CAAC,aAAa,CAAC,CAAC,CAChD,CACF,CAAC,IAAM,CACL,MAAO,CAAAP,GAAG,CACZ,CACF,CAAC,CAAC,CACJ"},"metadata":{},"sourceType":"module","externalDependencies":[]}