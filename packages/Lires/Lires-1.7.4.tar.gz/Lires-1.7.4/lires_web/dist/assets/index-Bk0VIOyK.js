var It=Object.defineProperty;var Tt=(s,t,e)=>t in s?It(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var Y=(s,t,e)=>(Tt(s,typeof t!="symbol"?t+"":t,e),e);import{d as L,f as B,B as w,C as fe,D as X,E as p,o as me,G as Ut,H as n,c as x,I as T,w as te,a as b,F as W,J as Q,z as P,K as V,L as R,M as E,N as dt,O as A,P as Bt,Q as Mt,R as ne,S as ae,U as ht,V as pt,W as de,X as H,Y as je,Z as G,_ as Ke,$ as ze,a0 as Te,a1 as Re,a2 as Lt,n as At,a3 as Rt,a4 as Et,a5 as at,a6 as st,a7 as qt}from"./@vue-BC7wygdO.js";import{d as qe,c as Ot}from"./pinia-JuONmuTa.js";import{u as ye,a as ft,c as Ft,b as zt}from"./vue-router-BNRov78Z.js";import{M as Ht}from"./async-mutex-CSJywVGb.js";import{f as Nt}from"./fast-xml-parser-CJG3bOwu.js";import{P as He}from"./plotly.js-dist-xw8c5UHU.js";import{E as Wt,M as jt}from"./md-editor-v3-DY1iTu2S.js";import{M as Kt}from"./markdown-it-DI8MEbma.js";import"./strnum-u8jQhLSb.js";import"./copy-to-clipboard-CupmGcto.js";import"./toggle-selection-BHUZwh74.js";import"./@vavt-B4fzJ49s.js";import"./@codemirror-BDhkIXHx.js";import"./@lezer-9ZEEcu4s.js";import"./style-mod-Bc2inJdb.js";import"./w3c-keyname-Vcq4gwWv.js";import"./medium-zoom-CHfgT04g.js";import"./markdown-it-image-figures-BD49Kf-b.js";import"./markdown-it-task-lists-BxuSizwB.js";import"./markdown-it-xss-DwZvMPOe.js";import"./xss-DnjGkJ2-.js";import"./cssfilter-BjxKUPhv.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-kMc2yuuw.js";import"./entities-C20TfXL6.js";import"./linkify-it-DmNjr4Kv.js";import"./punycode.js-Dj65hjkv.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();const Vt=L({__name:"Popup",props:{styleType:{default:"info"},position:{default:"top-center"}},setup(s){const t=s,e=B(()=>t.styleType==="alert"||t.styleType==="error"?{backgroundColor:"rgba(180, 0, 20, 0.9)",color:"rgba(255, 255, 255, 1)"}:t.styleType==="warning"?{backgroundColor:"rgba(210, 150, 0, 0.9)",color:"rgba(255, 255, 255, 1)"}:t.styleType==="info"?{backgroundColor:"rgba(0, 0, 0, 0.75)",color:"rgba(255, 255, 255, 1)"}:t.styleType==="success"?{backgroundColor:"rgba(0, 180, 0, 0.9)",color:"rgba(255, 255, 255, 1)"}:{backgroundColor:"rgba(0, 0, 0, 0.5)",color:"var(--color-text)"}),a=B(()=>{if(t.position==="top-center")return{top:"30px",left:"50%",transform:"translate(-50%, 0)"};if(t.position==="center")return{top:"50%",left:"50%",transform:"translate(-50%, -50%)"};throw Error("Incorrect style.")});return(i,o)=>(p(),w("div",{id:"popup",style:X({...e.value,...a.value})},[fe(i.$slots,"default",{},void 0,!0)],4))}}),q=(s,t)=>{const e=s.__vccOpts||s;for(const[a,i]of t)e[a]=i;return e},ot=q(Vt,[["__scopeId","data-v-e0ba6b84"]]),le="->";class O extends Set{static removeSpaces(t){const e=t.split(le);for(let a=0;a<e.length;a++)e[a]=e[a].trim();return t=e.join(le),t}constructor(t=null){t===null&&(t=[]);const e=t instanceof Set?t:new Set(t);e.forEach(a=>O.removeSpaces(a)),super(e)}copy(){return new O(this)}add(t){return super.add(O.removeSpaces(t))}has(t){return super.has(O.removeSpaces(t))}union(t){const e=new O(this);return e.union_(t),e}union_(t){return t.forEach(e=>this.add(e)),this}pop(t){const e=new O(this);return e.pop_(t),e}pop_(t){return t.forEach(e=>this.delete(e)),this}pop_ifcontains_(t){return t.forEach(e=>{this.has(e)&&this.delete(e)}),this}issubset(t){return Ce.isSubset(this,t)}withParents(){const t=new O(this);return this.forEach(e=>t.union_(Ce.allParentsOf(e))),t}withChildsFrom(t){const e=new O(this);return this.forEach(a=>e.union_(Ce.allChildsOf(a,t))),e}allParents(){const t=new O;return this.forEach(e=>t.union_(Ce.allParentsOf(e))),t}toArray(){return Array.from(this)}}class Ce{static allParentsOf(t){const e=t.split(le);if(e.length===1)return new O([]);const a=[],i=[];for(let o=0;o<e.length-1;o++)a.push(e[o]),i.push(a.join(le));return new O(i)}static allChildsOf(t,e){const a=new O;for(const i of e)i.startsWith(t)&&i.length>t.length+le.length&&i.substring(t.length,t.length+le.length)===`${le}`&&a.add(i);return a}static tagHierarchy(t){const e=le;function a(r,l){const d=r.split(l);return d.length===1?[r]:[d[0],d.slice(1).join(l)]}function i(r,l=e){const d={},g=r.map(f=>a(f,l));for(const f of g)f[0]in d||(d[f[0]]=[]),f.length===2&&d[f[0]].push(f[1]);const u={};for(const f in d)u[f]=i(d[f],l);return u}function o(r,l=e){for(const d in r){const g=r[d];for(const u in g){const f=[d,u].join(e);g[f]=g[u],delete g[u]}o(g,l)}return r}return o(i(Array.from(t)))}static isSubset(t,e){let a=!0;for(const i of t)if(!e.has(i)){a=!1;break}return a}}class Pe{constructor(t,e){Y(this,"summary");Y(this,"supp");Y(this,"conn");this.summary=e,this.supp={note:null,abstract:null},this.conn=t}get backendUrl(){return this.conn.baseURL}get tags(){return new O(this.summary.tags)}get uid(){return this.summary.uuid}get title(){return this.summary.title}get authors(){return this.summary.authors}get year(){return this.summary.year}get publication(){return this.summary.publication}get url(){return this.summary.url}get bibtex(){return this.summary.bibtex}toString(){return`${this.summary.title} - ${this.authorAbbr()} (${this.summary.year}) [uid: ${this.summary.uuid}]`}fetchAbstract(){return new Promise((t,e)=>{this.conn.reqDatapointAbstract(this.summary.uuid).then(a=>{this.supp.abstract=a,t(a)}).catch(a=>{e(a)})})}uploadAbstract(t){return new Promise((e,a)=>{if(t===this.supp.abstract||t===null){e(!0);return}this.conn.updateDatapointAbstract(this.summary.uuid,t).then(i=>{this.supp.abstract=t,e(i)}).catch(i=>{a(i)})})}fetchNote(){return new Promise((t,e)=>{this.conn.reqDatapointNote(this.summary.uuid).then(a=>{this.supp.note=a,t(a)}).catch(a=>{e(a)})})}uploadNote(t){return t===null?Promise.reject("Note is null"):new Promise((e,a)=>{this.conn.updateDatapointNote(this.summary.uuid,t).then(i=>{this.supp.note=t,this.summary.note_linecount=t.split(`
`).map(o=>o.trim()==""?0:1).reduce((o,r)=>o+r,0),e(i)}).catch(i=>{a(i)})})}deleteMiscFile(t){return this.conn.deleteMiscFile(this.summary.uuid,t)}renameMiscFile(t,e){return this.conn.renameMiscFile(this.summary.uuid,t,e)}listMiscFiles(){const t=this.conn.reqMiscFileList(this.summary.uuid),e=`${this.backendUrl}/misc/${this.summary.uuid}`;return t.then(a=>a.map(i=>{const o=new URLSearchParams;return o.append("fname",i),o.append("_u",j().user.id.toString()),{fname:i,rpath:`./misc/${i}`,url:`${e.toString()}?${o.toString()}`}}))}uploadMisc(t){return new Promise((e,a)=>{this.conn.uploadMiscFiles(this.summary.uuid,t).then(i=>{e(i.map(o=>`./misc/${o}`))},i=>{a(i)})})}uploadDocument(t){return this.conn.uploadDocument(this.summary.uuid,t)}freeDocument(){return this.conn.freeDocument(this.summary.uuid)}update(t=null){if(t!==null)return this.summary=t,Promise.resolve(t);const e=this.conn.reqDatapointSummary(this.summary.uuid);return e.then(a=>{this.summary=a}),e}destory(){this.summary=Ee}authorAbbr(){let t="";return this.summary.authors.length>1&&(t=" et al."),this.summary.authors[0]+t}authorYear(){return`${this.authorAbbr()} ${this.summary.year}`}yearAuthor(t=" "){return`${this.summary.year}${t}${this.authorAbbr()}`}isDummy(){return this.summary.uuid===Ee.uuid}getRawDocURL(){const t=this.summary.uuid;return this.summary.has_file?`${this.backendUrl}/doc/${t}?_u=${j().user.id}`:!this.summary.has_file&&this.url?this.url:"about:blank"}getOpenDocURL({extraPDFViewerParams:t={},urlHashMark:e=""}={}){const a=`${this.backendUrl}/pdfjs/web/viewer.html`;function i(l,d=a){const g=new URLSearchParams;d===a&&g.append("key",N().encKey),g.append("file",`${l}`);for(const u in t)g.append(u,t[u]);return`${d}?${g.toString()}`}function o(l){return e?(new URL(l).hash&&(l=l.slice(0,l.indexOf("#"))),`${l}#${e}`):l}let r="about:blank";if(this.isDummy()&&(r="about:blank"),this.summary.has_file&&this.summary.file_type==".pdf"){const l=this.getRawDocURL();r=i(o(l))}if(this.summary.has_file&&this.summary.file_type==".html"){const l=this.getRawDocURL();r=o(l)}return!this.summary.has_file&&this.summary.url&&(r=o(this.summary.url)),console.log("Open doc url: ",r),r}docType(){return this.summary.has_file&&this.summary.file_type==".pdf"?"pdf":this.summary.has_file&&this.summary.file_type==".html"?"html":!this.summary.has_file&&this.summary.url?"url":!this.summary.has_file&&!this.summary.url?"":"unknown"}}const Ee={has_file:!1,file_type:"",year:"0000",title:" ",author:" ",authors:[" "],publication:null,tags:[],uuid:" ",url:"about:blank",time_added:0,time_modified:0,bibtex:"",doc_size:0,note_linecount:0,has_abstract:!1};class Zt{constructor(t){Y(this,"cache");Y(this,"tags");Y(this,"uids");Y(this,"dataInfoAcquireMutex",new Ht);Y(this,"conn");Y(this,"_initliazed");this.cache={},this.uids=new Array,this.tags=new O,this._initliazed=!1,this.conn=t}get initialized(){return this._initliazed}async init(){await this.updateKeyCache(),await this.updateTagCache(),this._initliazed=!0,console.log("Get init data of size: ",((JSON.stringify(this.uids)+JSON.stringify(this.tags)).length*2/1024/1024).toPrecision(2),"MB")}allTags(){return this.tags}allKeys(){return this.uids}async updateKeyCache(){this.uids=await this.conn.reqAllKeys()}async updateTagCache(){this.tags=new O(await this.conn.reqAllTags())}async update(t,e=!0){let a;return t.uuid in this.cache?(this.cache[t.uuid].update(t),a=this.cache[t.uuid].tags):(this.cache[t.uuid]=new Pe(this.conn,t),a=new O),this.uids.includes(t.uuid)||this.uids.unshift(t.uuid),e&&(o=>{const r=new O;for(const l in this.cache)r.union_(this.cache[l].tags);return this.tags.union_(r),!o.issubset(r)})(a)&&await this.updateTagCache(),this.cache[t.uuid]}clear(){this.cache={},this.uids=new Array,this.tags=new O([]),this._initliazed=!1}async delete(t,e=!0){let a;t in this.cache?(a=this.cache[t].tags,delete this.cache[t]):a=null,this.uids.includes(t)&&(this.uids=this.uids.filter(o=>o!==t)),e&&(o=>{if(o===null)return!0;const r=new O;for(const l in this.cache)r.union_(this.cache[l].tags);return!o.issubset(r)})(a)&&await this.updateTagCache()}hasCache(t){return t in this.cache}getDummy(){return new Pe(this.conn,Ee)}async aget(t){if(!(t in this.cache))try{const e=await this.conn.reqDatapointSummary(t);this.cache[t]=new Pe(this.conn,e)}catch(e){return console.warn("Caught error in aget: ",e),new Pe(this.conn,Ee)}return this.cache[t]}async agetMany(t,e=!0,a=!0){const i=async()=>{this.dataInfoAcquireMutex.acquire();try{const l=Object.keys(this.cache),d=t.filter(f=>!l.includes(f));if(d.length===0)return t.map(f=>this.cache[f]);const g=await this.conn.reqDatapointSummaries(d);console.log("DEBUG: get data points of size: ",g.length),g.map(f=>new Pe(this.conn,f)).forEach(f=>{this.cache[f.uid]=f})}catch(l){throw l}finally{this.dataInfoAcquireMutex.release()}return t.map(l=>this.cache[l])},o=async()=>await Promise.all(t.map(l=>this.aget(l)));if(e)try{return await i()}catch(r){if(a)return console.warn("Caught error in agetMany: ",r),await o();throw r}return await o()}async agetByAuthor(t){const e=await this.conn.filter({searchBy:"author",searchContent:t});return await this.agetMany(e.uids)}getCacheByTags(t){t=new O(t);const e=[];for(const a in this.cache){const i=this.cache[a],o=new O(i.summary.tags);t.issubset(o.withParents())&&e.push(i)}return e}}class it{constructor(t,e){Y(this,"conn");Y(this,"info");this.conn=t,this.info=e}get baseURL(){return this.conn.baseURL}avatarURL(t=128,e=-1){let a;return e===null?a="":e<0?a=`&t=${Date.now()}`:a=`&t=${e}`,`${this.baseURL}/user-avatar/${this.info.username}?size=${t}${a}`}}class Gt{constructor(t){Y(this,"conn");this.conn=t}async list(){return(await this.conn.reqUserList()).map(e=>new it(this.conn,e))}async get(t){let e=await this.conn.reqUserInfo(t);return new it(this.conn,e)}}var pe=function s(t){function e(oe,re){return oe>>>re|oe<<32-re}for(var a=Math.pow,i=a(2,32),o="length",r,l,d="",g=[],u=t[o]*8,f=s.h=s.h||[],h=s.k=s.k||[],_=h[o],m={},C=2;_<64;C++)if(!m[C]){for(r=0;r<313;r+=C)m[r]=C;f[_]=a(C,.5)*i|0,h[_++]=a(C,1/3)*i|0}for(t+="";t[o]%64-56;)t+="\0";for(r=0;r<t[o];r++){if(l=t.charCodeAt(r),l>>8)throw new Error("ASCII check failed");g[r>>2]|=l<<(3-r)%4*8}for(g[g[o]]=u/i|0,g[g[o]]=u,l=0;l<g[o];){var D=g.slice(l,l+=16),S=f;for(f=f.slice(0,8),r=0;r<64;r++){var c=D[r-15],v=D[r-2],$=f[0],y=f[4],k=f[7]+(e(y,6)^e(y,11)^e(y,25))+(y&f[5]^~y&f[6])+h[r]+(D[r]=r<16?D[r]:D[r-16]+(e(c,7)^e(c,18)^c>>>3)+D[r-7]+(e(v,17)^e(v,19)^v>>>10)|0),I=(e($,2)^e($,13)^e($,22))+($&f[1]^$&f[2]^f[1]&f[2]);f=[k+I|0].concat(f),f[4]=f[4]+k|0}for(r=0;r<8;r++)f[r]=f[r]+S[r]|0}for(r=0;r<8;r++)for(l=3;l+1;l--){var K=f[r]>>l*8&255;d+=(K<16?0:"")+K.toString(16)}return d};class Jt{constructor({baseUrlGetter:t=()=>"",tokenGetter:e=()=>"",sessionIDGetter:a=()=>""}){this._baseUrlGetter=t,this._tokenGetter=e,this._sessionIDGetter=a}get baseUrl(){return this._baseUrlGetter()}get token(){return this._tokenGetter()}get sessionID(){return this._sessionIDGetter()}async get(t,e={}){const a=new URL(`${this._baseUrlGetter()}${t}`);return Object.keys(e).forEach(i=>a.searchParams.append(i,e[i])),await this._fetch(a.toString(),{method:"GET"})}async post(t,e={}){const a=new FormData;for(const i in e){let o=e[i];o instanceof Array&&(o=JSON.stringify(o)),a.append(i,o)}return await this._fetch(`${this._baseUrlGetter()}${t}`,{method:"POST",body:a})}async put(t,e){const a=new FormData;return a.append("key",this._tokenGetter()),a.append("file",e),await this._fetch(`${this._baseUrlGetter()}${t}`,{method:"PUT",body:a})}async delete(t,e={}){const a=new FormData;for(const i in e){let o=e[i];o instanceof Array&&(o=JSON.stringify(o)),a.append(i,o)}return a.append("key",this._tokenGetter()),await this._fetch(`${this._baseUrlGetter()}${t}`,{method:"DELETE",body:a})}async _fetch(t,e){if((e==null?void 0:e.method)==="GET"){const i=new URL(t);i.searchParams.append("key",this._tokenGetter()),i.searchParams.append("session_id",this._sessionIDGetter()),t=i.toString()}if((e==null?void 0:e.method)==="POST"||(e==null?void 0:e.method)==="PUT"||(e==null?void 0:e.method)==="DELETE")if(e.body===void 0)e.body=JSON.stringify({key:this._tokenGetter()});else if(typeof e.body=="string")e.body=JSON.stringify({key:this._tokenGetter(),session_id:this._sessionIDGetter(),...JSON.parse(e.body)});else if(e.body instanceof FormData)e.body.has("key")||e.body.append("key",this._tokenGetter()),e.body.has("session_id")||e.body.append("session_id",this._sessionIDGetter());else throw new Error("Not implemented body type");const a=await fetch(t,e);if(!a.ok)throw new Error(`Request failed with status ${a.status}`);return a}}class Qt{constructor(t,e,a){this.fetcher=new Jt({baseUrlGetter:t,tokenGetter:e,sessionIDGetter:a})}get baseURL(){return this.fetcher.baseUrl}async authUsr(t){return await this.fetcher.post("/api/auth",{key:t}).then(e=>e.json())}async status(){return await this.fetcher.get("/api/status").then(t=>t.json())}async reqAllKeys(){return await this.fetcher.get("/api/database/keys").then(t=>t.json())}async reqAllTags(){return await this.fetcher.get("/api/database/tags").then(t=>t.json())}async reqDatabaseFeatureTSNE(t="doc_feature",e=3,a=10){return await this.fetcher.get(`/api/datafeat/tsne/${t}`,{n_component:e.toString(),perplexity:a.toString()}).then(i=>i.json())}async reqDatabaseUsage(){return await this.fetcher.get("/api/database/usage").then(t=>t.json())}async reqDatapointSummary(t){return await this.fetcher.get(`/api/datainfo/${t}`).then(e=>e.json())}async reqDatapointSummaries(t){return await this.fetcher.post("/api/datainfo-list",{uids:JSON.stringify(t)}).then(e=>e.json())}async deleteDatapoint(t){return await this.fetcher.post("/api/dataman/delete",{uuid:t}).then(()=>!0)}async updateDatapoint(t,{bibtex:e=null,tags:a=null,url:i=null}){if(!t&&(e===null||a===null||i===null))throw new Error("uid is null, other fields should be complete");const o={};return t!==null&&(o.uuid=JSON.stringify(t)),e!==null&&(o.bibtex=e),a!==null&&(o.tags=JSON.stringify(a)),i!==null&&(o.url=i),await this.fetcher.post("/api/dataman/update",o).then(r=>r.json())}async reqDatapointAbstract(t){return await this.fetcher.get(`/api/datainfo-supp/abstract/${t}`).then(e=>e.text())}async updateDatapointAbstract(t,e){return await this.fetcher.post(`/api/datainfo-supp/abstract-update/${t}`,{content:e}).then(a=>!0)}async reqDatapointNote(t){return await this.fetcher.get(`/api/datainfo-supp/note/${t}`).then(e=>e.text())}async updateDatapointNote(t,e){return await this.fetcher.post(`/api/datainfo-supp/note-update/${t}`,{content:e}).then(a=>!0)}async _search(t,e){return console.warn("ServerConn.search will be deprecated in the future, use ServerConn.filter instead"),await this.fetcher.post("/api/search",{method:t,kwargs:JSON.stringify(e)}).then(a=>a.json())}async filter({tags:t=[],searchBy:e="title",searchContent:a="",maxResults:i=9999}={}){return await this.fetcher.post("/api/filter/basic",{tags:t,search_by:e,search_content:a,top_k:i}).then(o=>o.json())}async featurizeText(t,e=!1){return await this.fetcher.post("/api/iserver/textFeature",{text:t,require_cache:e}).then(a=>a.json())}reqAISummary(t,e,a=()=>{},i=!0,o="DEFAULT"){this.fetcher.post("/api/summary",{force:i,uuid:t,model:o}).then(r=>{if(!r.ok)throw e("(Error: "+r.status+")"),new Error("HTTP error "+r.status);const l=r.body.getReader(),d=({value:g,done:u})=>{if(u){a();return}let f=new TextDecoder().decode(g);return e(f),l.read().then(d)};return l.read().then(d)})}async reqMiscFileList(t){return await this.fetcher.get(`/api/misc-list/${t}`).then(e=>e.json())}async deleteMiscFile(t,e){return await this.fetcher.delete(`/misc/${t}`,{fname:e}).then(()=>!0)}async renameMiscFile(t,e,a){return await this.fetcher.post(`/misc/${t}`,{fname:e,dst_fname:a}).then(()=>!0)}async uploadMiscFiles(t,e){return(await Promise.all(e.map(i=>new Promise((o,r)=>{this.fetcher.put(`/misc/${t}`,i).then(l=>l.json()).then(o).catch(r)})))).map(i=>i.file_name)}async uploadDocument(t,e){return await this.fetcher.put(`/doc/${t}`,e).then(a=>a.json())}async freeDocument(t){return await this.fetcher.delete(`/doc/${t}`).then(e=>e.json())}async renameTag(t,e){return await this.fetcher.post("/api/dataman/tag-rename",{oldTag:t,newTag:e}).then(()=>!0)}async deleteTag(t){return await this.fetcher.post("/api/dataman/tag-delete",{tag:t}).then(()=>!0)}async reqUserInfo(t){return await this.fetcher.post(`/api/user/info/${t}`).then(e=>e.json())}async updateUserNickname(t){return await this.fetcher.post("/api/user/info-update",{name:t}).then(e=>e.json())}async updateUserPassword(t){return await this.fetcher.post("/api/user/info-update",{password:pe(t)}).then(e=>e.json())}async reqUserList(){return await this.fetcher.post("/api/user/list",{}).then(t=>t.json())}async uploadUserAvatar(t,e){return await this.fetcher.put(`/user-avatar/${t}`,e).then(a=>a.json())}async updateUserAccess(t,e,a,i){const o={};return o.username=t,e!==null&&(o.is_admin=e.toString()),a!==null&&(o.mandatory_tags=JSON.stringify(a)),i!==null&&(o.max_storage=i),await this.fetcher.post("/api/userman/modify",o).then(r=>r.json())}async createUser(t,e,a,i,o,r){return await this.fetcher.post("/api/userman/create",{username:t,name:e,password:pe(a),is_admin:i.toString(),mandatory_tags:JSON.stringify(o),max_storage:r}).then(l=>l.json())}async deleteUser(t){return await this.fetcher.post("/api/userman/delete",{username:t}).then(()=>!0)}async reqFeedList({maxResults:t=10,category:e="",timeBefore:a=-1,timeAfter:i=-1}){return console.log("reqFeedList",t,e,a,i),await this.fetcher.post("/api/feed/query",{max_results:t,category:e,time_before:a,time_after:i}).then(o=>o.json())}async reqFeedCategories(){return await this.fetcher.get("/api/feed/categories").then(t=>t.json())}async changelog(){return await this.fetcher.get("/api/info/changelog").then(t=>t.json())}}const he={};window.g_eventHooks=he;function ie(s,t){if(Array.isArray(s)){for(const e of s)ie(e,t);return}he[s]===void 0&&(he[s]=[]),he[s].includes(t)||he[s].push(t)}function mt(s,t){if(Array.isArray(s)){for(const e of s)mt(e,t);return}he[s]!==void 0&&(he[s]=he[s].filter(e=>e!==t))}function Yt(s,t){me(()=>{ie(s,t),console.log(`registered event callback [${s}]`,t.name)}),Ut(()=>{mt(s,t),console.log(`unregistered event callback [${s}]`,t.name)})}class Xt{constructor(t,e){Y(this,"resetRemainingRetries",()=>{this.__remainingRetries=10});Y(this,"decreaseRemainingRetries",()=>{this.__remainingRetries-=1});Y(this,"isOpen",()=>this.ws?this.ws.readyState===WebSocket.OPEN:!1);Y(this,"willTryReconnect",()=>this.__remainingRetries>0);this.__baseUrlGetter=t,this.__tokenGetter=e,this.resetRemainingRetries(),this.sessionID=pe(Date.now().toString()).slice(0,16),this.__eventCallback_records={onopenCallback:()=>{},onmessageCallback:a=>{},oncloseCallback:()=>{},onfailedToConnectCallback:()=>{}}}connect({onopenCallback:t=()=>{},onmessageCallback:e=o=>{},oncloseCallback:a=()=>{},onfailedToConnectCallback:i=()=>{}}={}){this.__eventCallback_records={onopenCallback:t,onmessageCallback:e,oncloseCallback:a,onfailedToConnectCallback:i};const o=new URLSearchParams(window.location.search);o.append("key",this.__tokenGetter()),o.append("session_id",this.sessionID);const r=this.__baseUrlGetter().replace("https://","wss://").replace("http://","ws://")+"/ws?"+o.toString();return console.log("connecting to server websocket at: ",r),this.ws=new WebSocket(r),this.ws.onmessage=l=>{console.log(l);const d=JSON.parse(l.data);if(d.type==="event"){const g=d.content;if(console.log(g),Object.keys(he).includes(g.type))for(const u of he[g.type])u(g)}e(l)},this.ws.onopen=()=>{console.log("connected to server websocket"),t(),this.resetRemainingRetries()},this.ws.onclose=()=>{console.log("server websocket closed, will try to reconnect in 1 second"),a(),this.willTryReconnect()?(this.decreaseRemainingRetries(),new Promise(l=>setTimeout(l,1e3)).then(()=>{this.ws.readyState===WebSocket.CLOSED&&this.connect({onopenCallback:t,onmessageCallback:e,oncloseCallback:a,onfailedToConnectCallback:i})})):i()},this}send(t){this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(t)):console.log("server websocket not ready, cannot send data")}resetReconnect(){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.close(),this.resetRemainingRetries(),this.connect(this.__eventCallback_records)}close(){this.ws&&this.ws.readyState===WebSocket.OPEN?(this.__remainingRetries=0,this.ws.close()):console.log("server websocket not ready, cannot close")}}async function Ve(s){if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(s),!0;{const t=document.createElement("textarea");t.value=s,t.style.position="absolute",t.style.left="-99999999px",document.body.prepend(t),t.select();let e=!1;try{document.execCommand("copy")}catch(a){console.log(a),e=!0}finally{t.remove()}return!e}}function en(s){window.open(s,"_blank")}function vt(s,t){let e=null;return function(...a){e&&window.clearTimeout(e),e=window.setTimeout(()=>{s(...a),e=null},t)}}function rt(s,t,e=null){let a="";if(e){let i=new Date;i.setTime(i.getTime()+e*24*60*60*1e3),a=`expires=${i.toUTCString()}; `}document.cookie=`${s}=${t}; ${a} path=/; sameSite=Lax`}function tn(s){return decodeURIComponent(document.cookie).split("; ").forEach(a=>{if(a.startsWith(`${s}=`)&&a.includes("expires"))return!0}),!1}function nn(s){const e=decodeURIComponent(document.cookie).split("; ");let a="";return e.forEach(i=>{i.indexOf(s)===0&&(a=i.substring(`${s}=`.length))}),a}const F=qe("uiStatus",{state:()=>({tagStatus:{checked:new O,all:new O,unfolded:new O},shownDataUIDs:[],shownDataScores:[],searchState:{searchBy:"title",content:""},unfoldedDataUIDs:[],recentlyReadDataUIDs:[],preferredReaderLeftPanelWidthPerc:.65,showMiscPanel:!1,popupValues:{},databaseLoadingStatus:{nCurrent:0,nTotal:-1},dataEditorOpened:!1}),getters:{databaseLoadingProgress(){return this.databaseLoadingStatus.nTotal===-1?this.databaseLoadingStatus.nCurrent===0?0:1:this.databaseLoadingStatus.nCurrent/this.databaseLoadingStatus.nTotal}},actions:{updateShownData(){const s=j();this.tagStatus.all=s.allTags,console.log("DEBUG: updateShownData() is called."),J().conn.filter({tags:Array.from(this.tagStatus.checked),searchBy:this.searchState.searchBy,searchContent:this.searchState.content}).then(t=>{this.shownDataUIDs=t.uids,this.shownDataScores=t.scores})},addRecentlyReadDataUID(s){this.recentlyReadDataUIDs.includes(s)&&this.recentlyReadDataUIDs.splice(this.recentlyReadDataUIDs.indexOf(s),1),this.recentlyReadDataUIDs.unshift(s),this.recentlyReadDataUIDs.length>5&&this.recentlyReadDataUIDs.pop()},showPopup(s,t="info",e=3e3){const a=Math.random().toString();this.popupValues[a]={content:s,styleType:t},setTimeout(()=>{delete this.popupValues[a]},e)},reloadDatabase(){j().reload(()=>{this.databaseLoadingStatus.nCurrent=0,j().database.clear(),this.updateShownData()},()=>{F().databaseLoadingStatus.nTotal=-1,F().tagStatus.all=j().database.allTags(),this.updateShownData()},()=>{this.showPopup(`Failed to load database from: ${J().conn.baseURL}`,"alert"),F().databaseLoadingStatus.nTotal=-1})}}}),J=qe("connection",{state:()=>{const s=new Xt(N().backend,()=>N().encKey);return{conn:new Qt(N().backend,()=>N().encKey,()=>s.sessionID),wsConn:s}}}),j=qe("data",{state:()=>({database:new Zt(J().conn),userPool:new Gt(J().conn),user:{id:-1,username:"",enc_key:"",name:"",is_admin:!1,mandatory_tags:[],has_avatar:!1,max_storage:0}}),getters:{allTags(){return this.database.allTags()}},actions:{clearUserInfo(){this.user={id:0,username:"",enc_key:"",name:"",is_admin:!1,mandatory_tags:[],has_avatar:!1,max_storage:0}},reload(s=()=>{this.database.clear()},t=()=>{},e=()=>{}){s();function a(i){i.database.init().then(o=>{t()},o=>{e(o)})}a(this)}}}),N=qe("settings",{state:()=>({__encKey:(()=>{const s=localStorage.getItem("encKey");return s?(localStorage.removeItem("encKey"),rt("encKey",s,1),s):nn("encKey")})(),__showTagPanel:(localStorage.getItem("showTagPanel")||"true")==="true",__show3DScatterPlot:(localStorage.getItem("show3DScatterPlot")||"false")==="true",__readerLayoutType:localStorage.getItem("readerLayoutType")||"2",__numItemsPerPage:localStorage.getItem("numItemsPerPage")||"50",__backendHost:sessionStorage.getItem("backendUrl")||an(),__backendPort:sessionStorage.getItem("backendPort")||sn(),loggedIn:!1}),getters:{encKey(){return this.__encKey},backendHost(){return this.__backendHost},backendPort(){return this.__backendPort},showTagPanel(){return this.__showTagPanel},show3DScatterPlot(){return this.__show3DScatterPlot},readerLayoutType(){return parseInt(this.__readerLayoutType)},numItemsPerPage(){return parseInt(this.__numItemsPerPage)}},actions:{setEncKey(s,t=void 0){t===void 0&&(t=tn("encKey")),this.__encKey=s,rt("encKey",s,t?7:null)},setBackendHost(s){this.__backendHost=s,sessionStorage.setItem("backendUrl",s)},setBackendPort(s){this.__backendPort=s,sessionStorage.setItem("backendPort",s)},setShowTagPanel(s){this.__showTagPanel=s,localStorage.setItem("showTagPanel",s.toString())},setShow3DScatterPlot(s){this.__show3DScatterPlot=s,localStorage.setItem("show3DScatterPlot",s.toString())},setReaderLayoutType(s){this.__readerLayoutType=s.toString(),localStorage.setItem("readerLayoutType",s.toString())},setNumItemsPerPage(s){this.__numItemsPerPage=s.toString(),localStorage.setItem("numItemsPerPage",s.toString())},backend(){return`${this.backendHost}:${this.backendPort}`}}});function an(){let s=window.location.protocol,t=window.location.hostname;return`${s}//${t}`}function sn(){const s=window.location.port;return s==="1420"?"8080":s}function Ze(s,t,e){N().setEncKey(s,e),t!==null?j().user=t:j().clearUserInfo(),t?N().loggedIn=!0:N().loggedIn=!1}function on(){Ze("",null,!0)}async function rn(){const s=J().conn,t=N().encKey;try{const e=await s.authUsr(t);return Ze(t,e,!0),e}catch(e){return console.log("settingsAuthentication failed: ",e),null}}function ln(s,t){return pe(s+pe(t))}const un={class:"loading-widget"},cn=L({__name:"LoadingWidget",props:{size:{default:"40px"},border_width:{default:"5px"}},setup(s){const t=s,e=B(()=>({width:t.size,height:t.size,border:t.border_width+" solid var(--color-border)",borderTopColor:"var(--color-primary)"}));return(a,i)=>(p(),w("div",un,[n("div",{class:"loading-widget__spinner",style:X(e.value)},null,4)]))}}),Oe=q(cn,[["__scopeId","data-v-1d6933bb"]]),dn={class:"loading-popout"},hn=L({__name:"LoadingPopout",props:{text:{default:"loading"}},setup(s){const t=s;return(e,a)=>(p(),w("div",dn,[x(Oe,{size:"25px"}),n("label",null,T(t.text),1)]))}}),gt=q(hn,[["__scopeId","data-v-95a13423"]]),Ne=[];class Z{static registerThemeChangeCallback(t){Ne.indexOf(t)===-1&&Ne.push(t)}static toggleDarkMode(){document.documentElement.classList.contains("light")?Z.setDarkMode(!0):document.documentElement.classList.contains("dark")?Z.setDarkMode(!1):(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,Z.setDarkMode(!0))}static isDefaultDarkMode(){return!!(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches)}static isDarkMode(){return document.documentElement.classList.contains("light")?!1:!!document.documentElement.classList.contains("dark")}static setDefaultDarkMode(){const t=localStorage.getItem("themeMode");t==="dark"?Z.setDarkMode(!0):t=="light"?Z.setDarkMode(!1):Z.isDefaultDarkMode()&&!Z.isDarkMode()&&this.setDarkMode(!0,!1)}static setDarkMode(t,e=!0){t?(document.documentElement.classList.remove("light"),document.documentElement.classList.add("dark")):(document.documentElement.classList.remove("dark"),document.documentElement.classList.add("light"));for(let a of Ne)a(t);if(e){const a=t?"dark":"light";localStorage.getItem("themeMode")!==a&&localStorage.setItem("themeMode",t?"dark":"light")}}static getThemeMode(){const t=localStorage.getItem("themeMode");return t==="dark"?"dark":t==="light"?"light":"auto"}static clear(){document.documentElement.classList.remove("dark"),document.documentElement.classList.remove("light"),this.setDefaultDarkMode(),localStorage.removeItem("themeMode")}}function lt(s,t){let e=s.parentNode;for(;e!=null;){if(e==t)return!0;e=e.parentNode}return!1}function Ie(s){if(s===null||typeof s!="object")return s;let t=Array.isArray(s)?[]:{};for(let e in s)t[e]=Ie(s[e]);return t}function _t(s,t,e=!1){if(s.length!==t.length)throw new Error("arr.length !== scores.length");const a=new Array;for(let l=0;l<s.length;l++)a.push([s[l],t[l]]);let i;e?i=a.sort((l,d)=>l[1]-d[1]):i=a.sort((l,d)=>d[1]-l[1]);const o=new Array,r=new Array;for(const l of i)o.push(l[0]),r.push(l[1]);return[o,r]}const pn=s=>(ne("data-v-719a0f48"),s=s(),ae(),s),fn={id:"popups"},mn=pn(()=>n("div",null,[n("div",{style:{"font-size":"2em","font-weight":"bold",color:"var(--color-red)"}},"Failed to connect to server"),n("div",{style:{color:"gray"}},"Maximum retry exceeded")],-1)),vn={id:"app"},gn=L({__name:"App",setup(s){const t=ye(),e=F(),a=N();t.isReady().then(()=>{if(t.currentRoute.value.query.backendPort&&N().setBackendPort(t.currentRoute.value.query.backendPort),t.currentRoute.value.query.backendHost&&N().setBackendHost(t.currentRoute.value.query.backendHost),t.currentRoute.value.query.credential&&N().setEncKey(t.currentRoute.value.query.credential,!1),window.location.hash.split("?")[0]!=="#/login"){console.log("Authenticating...");const m=()=>{a.loggedIn?a.loggedIn=!1:i()};rn().then(C=>{C||m()},()=>{m()})}});function i(){j().$reset(),F().$reset(),o.close(),t.push({path:"/login",query:{from:t.currentRoute.value.fullPath}})}te(()=>a.loggedIn,(m,C)=>{m?h():i()});const o=J().wsConn,r=b(!1),l=b(!1),d=b(window.location.hash.split("?")[0]==="#/login");t.afterEach((m,C)=>{d.value=m.path==="/login"});const g=B(()=>!r.value&&!d.value&&!l.value),u=B(()=>l.value&&!d.value);function f(){o.connect({onopenCallback:()=>{r.value=!0,l.value=!1},oncloseCallback:()=>r.value=!1,onfailedToConnectCallback:()=>l.value=!0})}setInterval(()=>{!o.isOpen()&&r.value&&!d.value&&!l.value&&(r.value=!1,f())},5e3);function h(){f(),e.reloadDatabase()}ie("add_entry",m=>{const C=j(),D=m.datapoint_summary;C.database.update(D).then(()=>{console.log("DEBUG: add entry update UI"),e.updateShownData()})}),ie(["update_entry","update_note"],m=>{const C=j(),D=m.datapoint_summary;C.database.update(D).then(()=>{console.log("DEBUG: update entry update UI"),e.updateShownData()})}),ie("delete_entry",m=>{const C=j(),D=m.uuid;C.database.delete(D).then(()=>{console.log("DEBUG: delete entry update UI"),e.updateShownData()})}),ie(["delete_tag","update_tag"],m=>{const C=new O([m.src_tag]),D=j();(async function(){await D.database.updateTagCache();const c=D.database.getCacheByTags(C);await Promise.all(c.map(v=>v.update())),e.updateShownData(),console.log("DEBUG: update tag update UI")})()}),ie("update_user",m=>{if(m.username===j().user.username){if(m.user_info===null)throw new Error("assertion failed: User info is null");for(const C of Object.keys(j().user))C!=="enc_key"&&(j().user[C]=m.user_info[C])}});const _=()=>{window.location.reload()};return me(()=>{Z.setDefaultDarkMode()}),(m,C)=>{const D=dt("router-view");return p(),w(W,null,[n("div",fn,[(p(!0),w(W,null,Q(Object.keys(P(e).popupValues),(S,c)=>(p(),V(ot,{key:c,styleType:P(e).popupValues[S].styleType,style:X({transform:`translate(-50%, ${-50+110*c}%) scale(0.9)`})},{default:E(()=>[A(T(P(e).popupValues[S].content),1)]),_:2},1032,["styleType","style"]))),128))]),g.value?(p(),V(gt,{key:0,text:"connecting..."})):R("",!0),u.value?(p(),V(ot,{key:1,styleType:"info",position:"center"},{default:E(()=>[n("div",{style:{display:"flex","flex-direction":"column","align-items":"center",margin:"10px"}},[mn,n("div",{style:{"font-size":"1.2em","margin-top":"10px"}},[A(" Please check if the server is running, make sure your network is working properly, and try to "),n("a",{style:{"text-decoration":"underline",cursor:"pointer"},onClick:_},"reload the page"),A(". ")])])]),_:1})):R("",!0),n("div",vn,[x(D,null,{default:E(({Component:S})=>[(p(),V(Mt,{exclude:"Reader"},[(p(),V(Bt(S)))],1024))]),_:1})])],64)}}}),_n=q(gn,[["__scopeId","data-v-719a0f48"]]),yn={for:"chk"},wn={id:"checkCircle"},bn={key:0,id:"checkStatus"},kn=L({__name:"Toggle",props:{checked:{type:Boolean},identifier:{default:""}},emits:["onCheck"],setup(s,{emit:t}){const e=t,a=s;function i(o){e("onCheck",a.identifier)}return(o,r)=>(p(),w("div",{class:"toggle",onClick:i},[n("label",yn,[fe(o.$slots,"default",{},void 0,!0)]),n("div",wn,[o.checked?(p(),w("div",bn)):R("",!0)])]))}}),ke=q(kn,[["__scopeId","data-v-582ee950"]]),$n={class:"toggleText"},Sn={class:"children slideInDown"},xn=L({__name:"TagCollapsibleToggle",props:{tagStatus:{},identifier:{default:""},children:{}},emits:["update:tagStatus"],setup(s,{emit:t}){const e=s,a=t,i=B({get:()=>e.tagStatus,set:m=>a("update:tagStatus",m)}),o=B(()=>{let m="collapseButton";return Object.keys(e.children).length!==0&&(m+=" collapsible"),m}),r=b(null),l=B(()=>!e.tagStatus.unfolded.has(e.identifier)),d=B(()=>l.value?"triangle-right":"triangle-down rotate90in");function g(m){let C=i.value.unfolded;C.has(e.identifier)?C.delete(e.identifier):C.add(e.identifier)}const u=B(()=>e.tagStatus.checked.has(e.identifier));function f(m){if(m===void 0)return;let C=i.value.checked;C.has(m)?C.delete(m):C.add(m)}const h=b(null),_=m=>{m.button===2&&(g(),m.preventDefault())};return ht(()=>{var m;(m=h.value)==null||m.addEventListener("contextmenu",_)}),pt(()=>{var m;(m=h.value)==null||m.removeEventListener("contextmenu",_)}),(m,C)=>(p(),w(W,null,[n("div",{class:"row",ref_key:"rowDiv",ref:h},[n("div",{id:"button",class:de(o.value),ref_key:"button",ref:r,onClick:g},[Object.keys(e.children).length!==0?(p(),w("div",{key:0,class:de(d.value)},null,2)):R("",!0)],2),n("div",$n,[x(ke,{checked:u.value,identifier:e.identifier,onOnCheck:f},{default:E(()=>[fe(m.$slots,"default",{},void 0,!0)]),_:3},8,["checked","identifier"])])],512),H(n("div",Sn,[(p(!0),w(W,null,Q(m.children,(D,S)=>(p(),V(yt,{identifier:String(S),children:D,"tag-status":i.value,"onUpdate:tagStatus":C[0]||(C[0]=c=>i.value=c)},{default:E(()=>[A(T(String(S).split(P(le)).slice(-1)[0]),1)]),_:2},1032,["identifier","children","tag-status"]))),256))],512),[[je,!l.value]])],64))}}),yt=q(xn,[["__scopeId","data-v-505f8e28"]]),Cn={id:"tagSelector-main",class:"hover-scrollable"},Dn=L({__name:"TagSelector",props:{tagStatus:{}},emits:["update:tagStatus"],setup(s,{emit:t}){const e=s,a=t,i=B(()=>Ce.tagHierarchy(e.tagStatus.all)),o=B(()=>Object.keys(i.value).sort()),r=B({get:()=>e.tagStatus,set:l=>a("update:tagStatus",l)});return(l,d)=>(p(),w("div",Cn,[(p(!0),w(W,null,Q(o.value,g=>(p(),V(yt,{identifier:String(g),children:i.value[g],tagStatus:r.value,"onUpdate:tagStatus":d[0]||(d[0]=u=>r.value=u)},{default:E(()=>[A(T(String(g).split(P(le)).slice(-1)[0]),1)]),_:2},1032,["identifier","children","tagStatus"]))),256))]))}}),wt=q(Dn,[["__scopeId","data-v-5557e59e"]]),Pn={key:0,class:"prefix"},In=L({__name:"TagBubble",props:{tag:{},tStyle:{default:""}},emits:["click"],setup(s,{emit:t}){const e=s,a=t,i=B(()=>{const o=e.tag.split(le);return o.length==1?["",o[0]]:[o.slice(0,o.length-1).join("·"),o[o.length-1]]});return(o,r)=>(p(),w("div",{class:de(`bubble${o.tStyle?" "+o.tStyle:""}`),onClick:r[0]||(r[0]=()=>a("click"))},[i.value[0]?(p(),w("div",Pn,T(i.value[0]),1)):R("",!0),A(" "+T(i.value[1]),1)],2))}}),Tn=q(In,[["__scopeId","data-v-f454bc70"]]),Un=L({__name:"TagBubbleContainer",props:{tags:{},highlightTags:{default:null},mutedTags:{default:null},maxWidth:{default:null},middleAlign:{type:Boolean,default:!1}},emits:["clickOnBubble"],setup(s,{emit:t}){const e=s,a=t,i=B(()=>{const o={};for(const r of e.tags)e.highlightTags&&e.highlightTags.has(r)?o[r]="highlight":e.mutedTags&&e.mutedTags.has(r)?o[r]="muted":o[r]="";return o});return(o,r)=>(p(),w("div",{id:"bubbleContainer",style:X({maxWidth:`${(e.maxWidth?e.maxWidth:999)-10}px`,justifyContent:e.middleAlign?"center":"flex-start"})},[(p(!0),w(W,null,Q(e.tags,l=>(p(),V(Tn,{onClick:()=>a("clickOnBubble",l),tag:l,"t-style":i.value[l]},null,8,["onClick","tag","t-style"]))),256))],4))}}),Ge=q(Un,[["__scopeId","data-v-62e107cd"]]),Je=s=>(ne("data-v-86105994"),s=s(),ae(),s),Bn=Je(()=>n("h3",{class:"green"},"Tags",-1)),Mn=Je(()=>n("hr",null,null,-1)),Ln=Je(()=>n("hr",null,null,-1)),An=L({__name:"FileTags",emits:["onCheck"],setup(s,{emit:t}){const e=t,a=F(),i=j(),o=b(null),r=b(null);te(()=>a.unfoldedDataUIDs,()=>{a.unfoldedDataUIDs.length==0?r.value=null:a.shownDataUIDs.includes(a.unfoldedDataUIDs[0])&&i.database.aget(a.unfoldedDataUIDs[0]).then(h=>{r.value=h})});const l=B(()=>r.value==null?null:a.tagStatus.checked.withChildsFrom(r.value.tags)),d=B(()=>{const h=a.tagStatus.checked.copy();return r.value!==null&&h.pop_ifcontains_(r.value.tags),h});function g(){a.tagStatus.checked=new O,a.updateShownData()}te(a.tagStatus,()=>e("onCheck",a.tagStatus),{deep:!0});function u(){const h=prompt("Old tag");if(h&&i.database.allTags().has(h)){const _=prompt("New tag");_&&J().conn.renameTag(h,_).then(()=>{a.showPopup("Tag renamed","success")},()=>{a.showPopup("Failed to rename tag","error")})}else a.showPopup("Invalid tag","warning")}function f(){const h=prompt("Tag to delete");if(h&&i.database.allTags().has(h)){if(!confirm(`Are you sure to delete tag "${h}"?`))return;J().conn.deleteTag(h).then(()=>{a.showPopup("Tag deleted","success")},()=>{a.showPopup("Failed to delete tag","error")})}else a.showPopup("Invalid tag","warning")}return(h,_)=>(p(),w("div",{id:"file-tags-main",ref_key:"ftPanel",ref:o},[n("div",{class:"title"},[n("div",{id:"title-title"},[Bn,n("div",{id:"title-buttons"},[n("div",{class:"button",onClick:u},"rename"),n("div",{class:"button",onClick:f},"delete")])]),Mn]),x(wt,{onOnCheck:_[0]||(_[0]=m=>e("onCheck",m)),tagStatus:P(a).tagStatus,"onUpdate:tagStatus":_[1]||(_[1]=m=>P(a).tagStatus=m)},null,8,["tagStatus"]),Ln,x(Ge,{onClickOnBubble:_[2]||(_[2]=m=>{P(a).tagStatus.checked.has(m)?P(a).tagStatus.checked.delete(m):P(a).tagStatus.checked.add(m),P(a).updateShownData()}),tags:r.value?r.value.tags:P(a).tagStatus.checked,"highlight-tags":l.value,"muted-tags":d.value,"max-width":o.value?o.value.clientWidth:null},null,8,["tags","highlight-tags","muted-tags","max-width"]),n("div",{class:"buttons"},[n("button",{id:"btnClear",class:"green",onClick:g},"CLEAR SELECTION")])],512))}}),Rn=q(An,[["__scopeId","data-v-86105994"]]),En="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M240-80q-50%200-85-35t-35-85v-120h120v-560h600v680q0%2050-35%2085t-85%2035H240Zm480-80q17%200%2028.5-11.5T760-200v-600H320v480h360v120q0%2017%2011.5%2028.5T720-160ZM360-600v-80h360v80H360Zm0%20120v-80h360v80H360ZM240-160h360v-80H200v40q0%2017%2011.5%2028.5T240-160Zm0%200h-40%20400-360Z'/%3e%3c/svg%3e",Qe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M480%20856q-115%200-197.5-82.5T200%20576q0-115%2082.5-197.5T480%20296q115%200%20197.5%2082.5T760%20576q0%20115-82.5%20197.5T480%20856Z'/%3e%3c/svg%3e",qn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M331%20625h37v-83h48q15.725%200%2026.362-10.638Q453%20520.725%20453%20505v-48q0-15.725-10.638-26.362Q431.725%20420%20416%20420h-85v205Zm37-120v-48h48v48h-48Zm129%20120h84q15%200%2026-10.638%2011-10.637%2011-26.362V457q0-15.725-11-26.362Q596%20420%20581%20420h-84v205Zm37-37V457h47v131h-47Zm133%2037h37v-83h50v-37h-50v-48h50v-37h-87v205ZM260%20856q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h560q24%200%2042%2018t18%2042v560q0%2024-18%2042t-42%2018H260ZM140%20976q-24%200-42-18t-18-42V296h60v620h620v60H140Z'/%3e%3c/svg%3e",On="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M251%20896q-88%200-149.5-61.5T40%20685q0-78%2050-137t127-71q20-97%2094-158.5T482%20257q112%200%20189%2081.5T748%20534v24q72-2%20122%2046.5T920%20727q0%2069-50%20119t-119%2050H251Z'/%3e%3c/svg%3e",Fn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M251%20896q-88%200-149.5-61.5T40%20685q0-78%2050-137t127-71q20-97%2094-158.5T482%20257q112%200%20189%2081.5T748%20534v24q72-2%20122%2046.5T920%20727q0%2069-50%20119t-119%2050H251Zm0-60h500q45%200%2077-32t32-77q0-45-32-77t-77-32h-63v-84q0-91-61-154t-149-63q-88%200-149.5%2063T267%20534h-19q-62%200-105%2043.5T100%20685q0%2063%2044%20107t107%2044Zm229-260Z'/%3e%3c/svg%3e",zn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M220%20976q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h361l219%20219v521q0%2024-18%2042t-42%2018H220Zm331-554h189L551%20236v186Z'/%3e%3c/svg%3e",Hn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M220%20976q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h361l219%20219v521q0%2024-18%2042t-42%2018H220Zm331-554V236H220v680h520V422H551ZM220%20236v186-186%20680-680Z'/%3e%3c/svg%3e",Nn=s=>(ne("data-v-c6dbcdc2"),s=s(),ae(),s),Wn={key:0,id:"window"},jn={class:"header"},Kn=Nn(()=>n("span",{class:"close-icon"},"✕",-1)),Vn=[Kn],Zn=L({__name:"FloatingWindow",props:{title:{default:"_"},show:{type:Boolean},closeKey:{default:"Escape"},compact:{type:Boolean,default:!1},zIndex:{default:100}},emits:["close","onClose","update:show"],setup(s,{emit:t}){const e=s,a=t,i=B({get:()=>e.show,set:l=>{a("update:show",l)}});function o(){i.value=!1,a("onClose"),a("close")}function r(l){l.target===l.currentTarget&&o()}return window.addEventListener("keydown",l=>{l.key===e.closeKey&&(o(),l.preventDefault())}),(l,d)=>i.value?(p(),w("div",Wn,[n("div",{id:"blocker",onClick:r,style:X({"z-index":l.zIndex-1})},[n("div",{class:"floating-window",style:X({"z-index":l.zIndex})},[n("div",jn,[n("label",null,T(e.title),1),n("button",{class:"close-button",onClick:o},Vn)]),n("div",{class:"window-content scrollable",style:X({margin:e.compact?"0px":"15px",marginTop:e.compact?"0px":"5px"})},[fe(l.$slots,"default",{},void 0,!0)],4)],4)],4)])):R("",!0)}}),De=q(Zn,[["__scopeId","data-v-c6dbcdc2"]]),Gn={id:"query-dialog-main"},Jn={class:"content"},Qn={id:"buttons"},Yn=L({__name:"QueryDialog",props:{show:{type:Boolean},title:{default:"Query"},showCancel:{type:Boolean,default:!0},zIndex:{default:99}},emits:["update:show","onClose","onAccept","onCancel"],setup(s,{emit:t}){const e=s,a=t,i=B({get:()=>e.show,set:o=>{a("update:show",o)}});return(o,r)=>(p(),V(De,{show:i.value,"onUpdate:show":r[2]||(r[2]=l=>i.value=l),title:o.title,compact:!0,"z-index":o.zIndex,onOnClose:r[3]||(r[3]=()=>a("onClose"))},{default:E(()=>[n("div",Gn,[n("div",Jn,[fe(o.$slots,"default",{},void 0,!0)]),n("div",Qn,[n("div",{class:"button ok-button",onClick:r[0]||(r[0]=()=>a("onAccept"))},"OK"),o.showCancel?(p(),w("div",{key:0,class:"button cancel-button last-button",onClick:r[1]||(r[1]=()=>a("onCancel"))},"Cancel")):R("",!0)])])]),_:3},8,["show","title","z-index"]))}}),$e=q(Yn,[["__scopeId","data-v-81948a9f"]]),Xn=s=>(ne("data-v-8779a0ab"),s=s(),ae(),s),ea={id:"tag-selector-with-entry-main"},ta={style:{textAlign:"left"}},na=Xn(()=>n("label",{for:"tagSelector"},"Tags",-1)),aa={id:"tagSelector",class:"scrollable"},sa={class:"entry"},oa=L({__name:"TagSelectorWithEntry",props:{tagStatus:{},tagInputValue:{default:""}},emits:["update:tagStatus","update:tagInputValue"],setup(s,{emit:t}){const e=s,a=t,i=B({get:()=>e.tagStatus,set:d=>a("update:tagStatus",d)}),o=b(e.tagInputValue);te(()=>e.tagInputValue,d=>{o.value=d});const r=B({get:()=>o.value,set:d=>{a("update:tagInputValue",d),o.value=d}}),l=()=>{const d=r.value.trim();d!==""&&(i.value.all.add(d),i.value.checked.add(d),i.value.unfolded.union_(Ce.allParentsOf(d)),r.value="")};return(d,g)=>(p(),w("div",ea,[n("div",ta,[na,n("div",aa,[x(wt,{tagStatus:i.value,"onUpdate:tagStatus":g[0]||(g[0]=u=>i.value=u)},null,8,["tagStatus"])])]),n("div",sa,[H(n("input",{type:"text",placeholder:"New tag","onUpdate:modelValue":g[1]||(g[1]=u=>r.value=u),onKeyup:Ke(l,["enter"])},null,544),[[G,r.value]]),n("button",{class:de(`green${r.value?" to-be-confirmed":""}`),onClick:l},"ADD",2)])]))}}),ia=q(oa,[["__scopeId","data-v-8779a0ab"]]);async function ra(s){const t=`https://export.arxiv.org/api/query?id_list=${s}`,a=await(await fetch(t,{method:"GET"})).text();let r=new Nt.XMLParser().parse(a).feed.entry;function l(d){return Array.isArray(d.author)?d.author.map(g=>g.name):d.author?[d.author.name]:[]}if(r){const d=r.id.split("/").pop().split("v")[0],g=r.id,u=r.title,f=r.summary,h=l(r),_=r.updated,m=r.published;return{id:d,link:g,title:u,abstract:f,authors:h,updatedTime:_,publishedTime:m}}else throw new Error("Failed to fetch paper from arxiv")}function la(s){return`@article{${s.id},
  author = {${s.authors.join(" and ")}},
  title = {${s.title}},
  journal = {arXiv preprint arXiv:${s.id}},
  year = {${s.publishedTime.split("-")[0]}},
  abstract = {${s.abstract}}
  }`.replace(/  /g,"")}const ut=(s,{entry:t="",title:e="",authors:a=[""],year:i=new Date().getFullYear()}={})=>(t||(t=`${i}_${Math.random().toString(36).substring(7)}`),s=="article"?`@article{${t},
        author = {${a.join(" and ")}},
        title = {${e}},
        journal = {},
        year = {${i}},
        abstract = {},
        volume = {},
        number = {},
        pages = {},
        month = {},
        doi = {},
        }`.replace(/  /g,""):s=="inproceedings"?`@inproceedings{${t},
        author = {${a.join(" and ")},
        title = {${e}},
        booktitle = {},
        year = {${i}},
        abstract = {},
        editor = {},
        volume = {},
        number = {},
        series = {},
        pages = {},
        }`.replace(/  /g,""):s=="webpage"?`@misc{${t},
        title = "{${e}}",
        author = "{${a.join(" and ")}}",
        year = {${i}},
        url = "{}",
        note = "{}"
        }`.replace(/  /g,""):s=="misc"?`@misc{${t},
        author = {${a.join(" and ")}},
        title = {${e}},
        year = {${i}},
        url = {},
        }`.replace(/  /g,""):"");class We{static async fromArxiv(t){let e=t.toLowerCase();e.startsWith("arxiv:")?e=e.split("arxiv:")[1]:e.includes("arxiv.org/abs/")?e=e.split("arxiv.org/abs/")[1]:e.includes("arxiv.org/pdf/")&&(e=e.split("arxiv.org/pdf/")[1].split(".pdf")[0]);const a=await ra(e);return{bibtex:la(a),url:a.link}}static async fromWebpage(t){var d;const a=await(await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(t)}`)).text(),r=(d=new DOMParser().parseFromString(a,"text/html").querySelector("title"))==null?void 0:d.innerText;return{bibtex:`@misc{${t},
            author = {},
            title = {${r}},
            url = {${t}},
            year = {${new Date().getFullYear()}},
            }`.replace(/  /g,""),url:t}}static async fromDoi(t){const e=`https://api.crossref.org/works/${t}/transform/application/x-bibtex`;return{bibtex:await(await fetch(e,{method:"GET"})).text(),url:`https://doi.org/${t}`}}}const ua={key:0,id:"arrow"},ca=["onKeydown","onClick"],da=L({__name:"Menu",props:{show:{type:Boolean},menuItems:{},position:{},blocker:{type:Boolean,default:!1},middleTop:{type:Boolean,default:!1},zIndex:{default:100},arrow:{type:Boolean,default:!1}},emits:["update:show"],setup(s,{emit:t}){const e=s,a=t,i=B({get:()=>e.show,set:r=>{a("update:show",r)}});function o(){i.value=!1}return(r,l)=>(p(),w(W,null,[r.blocker?(p(),w("div",{key:0,id:"blocker",onClick:o,style:X({zIndex:e.zIndex-1})},null,4)):R("",!0),n("div",{id:"floatingMenu",style:X({left:e.position.x+"px",top:e.position.y+"px",visibility:i.value?"visible":"hidden",transform:e.middleTop?"translate(-50%, 0)":"",zIndex:e.zIndex})},[e.arrow?(p(),w("div",ua)):R("",!0),(p(!0),w(W,null,Q(e.menuItems,(d,g)=>(p(),w("div",{class:de(`non-selectable floatingMenuItem${g!==e.menuItems.length-1?"":" floatingMenuItemLast"}`),tabindex:"0",onKeydown:Ke(u=>{d.action(),o()},["enter"]),onClick:u=>{d.action(),o()}},T(d.name),43,ca))),256))],4)],64))}}),ha=q(da,[["__scopeId","data-v-c6b659c7"]]),Se=L({name:"file-select-button",props:{asLink:{type:Boolean,default:!1},text:{type:String,default:"Upload"},action:{type:Function,required:!0},style:{type:Object,default:()=>({})}},setup(s,t){const e=b(null),a=o=>{const r=o.target;if(r.files&&r.files.length>0){const l=r.files[0];s.action(l)}};function i(){e.value.click()}return t.expose({click:i}),()=>x(W,null,[x("input",{type:"file",id:"upload-file",onChange:a,ref:e,style:{display:"none"}},null),s.asLink?x("a",{class:"btn upload-btn",rel:"noopener noreferrer",onClick:()=>e.value.click(),style:s.style},[s.text]):x("button",{type:"button",class:"btn upload-btn",onClick:()=>e.value.click(),style:s.style},[s.text])])}}),Ye=L({name:"editable-paragraph",props:{contentEditable:{type:Boolean,default:!0},style:{type:Object,default:()=>({})}},emits:["finish","change"],setup(s,t){const e=b(null),a=h=>{e.value.innerText=h},i=h=>{e.value.contentEditable=h.toString()},o=h=>e.value.contains(h),r=function(){return document.activeElement===e.value},l=B({get(){return e.value.innerText},set(h){e.value.innerText=h}});t.expose({setText:a,setEditable:i,contains:o,innerText:l,hasFocus:r});const d=()=>{t.emit("change",e.value.innerText)},g=()=>{t.emit("finish",e.value.innerText)},u=h=>{if(h.key==="Enter")if(h.ctrlKey||h.metaKey){h.preventDefault();const _=window.getSelection(),m=_==null?void 0:_.getRangeAt(0);if(m){const C=document.createElement("br");m.insertNode(C),m.setStartAfter(C),m.setEndAfter(C),_==null||_.removeAllRanges(),_==null||_.addRange(m)}}else e.value.blur()},f=h=>{var m;h.preventDefault();const _=(m=h.clipboardData)==null?void 0:m.getData("text/plain");document.execCommand("insertText",!1,_)};return()=>x("p",{class:"editable-paragraph",contenteditable:s.contentEditable,ref:e,onInput:d,onBlur:g,onKeydown:u,style:s.style,onPaste:f},[t.slots.default&&t.slots.default()])}}),bt=L({name:"menu-attached",props:{menuItems:{type:Array,required:!0}},setup(s,t){const e=b(!1),a=b(null),i=b({x:0,y:0});return te(e,o=>{if(o){const r=a.value.getBoundingClientRect();i.value={x:r.left+r.width/2,y:r.bottom+5}}else i.value={x:0,y:0}}),()=>x("div",null,[x("div",{ref:a,onClick:()=>e.value=!e.value,onKeydown:o=>{o.key==="Enter"&&(o.preventDefault(),e.value=!e.value)}},[t.slots.default&&t.slots.default()]),x(ha,{show:e.value,"onUpdate:show":o=>e.value=o,menuItems:s.menuItems,position:i.value,middleTop:!0,arrow:!0},null)])}}),pa=L({name:"CircularImage",props:{href:{type:String,required:!0},size:{type:String,required:!0},alt:{type:String,default:""}},emits:["click"],setup(s,t){const e={width:`${s.size}`,height:`${s.size}`,borderRadius:"50%",border:"1px solid var(--color-border)",overflow:"hidden"};return()=>x("img",{src:s.href,alt:s.alt,style:e,onClick:()=>t.emit("click")},null)}});function ct(s){function t(u,f){var _;const h=(_=u.split(".").pop())==null?void 0:_.toLowerCase();for(const m of f)if(h===m)return!0;return!1}function e(u){return!!(u.type.startsWith("image/")||t(u.name,["jpg","jpeg","png","gif","bmp","svg","webp"]))}function a(u){return!!(u.type==="application/pdf"||t(u.name,["pdf"]))}function i(u){return!!(u.type==="text/html"||t(u.name,["html"]))}function o(u){return!!(u.type==="text/plain"||t(u.name,["txt","bib","bibtex","nbib","enw","ris"]))}function r(u){return!!(a(u)||i(u)||e(u))}const l=[],d=[],g=[];for(let u=0;u<s.length;u++)o(s[u])?l.push(s[u]):r(s[u])?d.push(s[u]):g.push(s[u]);return{citation:l,document:d,unknown:g}}const ve=s=>(ne("data-v-c51ec443"),s=s(),ae(),s),fa={style:{display:"flex",flexDirection:"column",gap:"10px",padding:"10px",width:"100%",height:"100%"}},ma={style:{margin:"10px"}},va=ve(()=>n("legend",null,"Source",-1)),ga={class:"bibsource-container"},_a=ve(()=>n("legend",{for:"bibsource-arxiv"},"arxiv",-1)),ya={class:"bibsource-container"},wa=ve(()=>n("legend",{for:"bibsource-doi"},"doi",-1)),ba={class:"bibsource-container"},ka=ve(()=>n("legend",{for:"bibsource-webpage"},"webpage",-1)),$a=["placeholder"],Sa={key:0},xa={id:"inputDiv"},Ca={id:"inputLeft"},Da={id:"bibtexArea"},Pa={class:"horizontal"},Ia=ve(()=>n("label",{for:"bibtex"},"Bibtex",-1)),Ta={id:"bibtexSource",class:"horizontal"},Ua={id:"urlArea"},Ba=ve(()=>n("label",{for:"url"},"URL: ",-1)),Ma={id:"inputRight"},La={key:0,style:{display:"flex","justify-content":"center","align-items":"center","padding-inline":"15px"}},Aa=ve(()=>n("div",{class:"hr"},null,-1)),Ra={style:{"margin-top":"5px","text-wrap":"nowrap","white-space":"nowrap","margin-inline":"5px"}},Ea=ve(()=>n("div",{class:"hr"},null,-1)),qa={key:1},Oa=ve(()=>n("div",{style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",height:"430px",width:"590px",border:"5px dashed var(--color-border)","border-radius":"10px",margin:"15px"}},[n("div",{style:{"font-size":"20px","font-weight":"bold","margin-bottom":"10px"}},"Drop to insert citation or document"),n("div",{style:{"font-size":"12px",opacity:"0.5"}},"(only support bibtex/enw/nbib)")],-1)),Fa=[Oa],za=L({__name:"DataEditor",setup(s,{expose:t}){const e=F(),a=J().conn,i=b(!1),o=b(null),r=b(""),l=b(""),d=b(null),g=b({all:new O,checked:new O,unfolded:new O});function u(){const z={uuid:o.value?o.value.summary.uuid:null,bibtex:r.value,tags:Array.from(g.value.checked),url:l.value,file:d.value};_(),e.showPopup("Saving entry...","info"),a.updateDatapoint(z.uuid,{bibtex:z.bibtex,tags:z.tags,url:z.url}).then(U=>{z.file?(e.showPopup("Uploading document...","info"),a.uploadDocument(U.uuid,z.file).then(M=>{e.showPopup("Saved","success")},()=>e.showPopup("Failed to upload document","error"))):e.showPopup("Saved","success")},()=>e.showPopup("Failed to save","error"))}const f=b("");function h({datapoint:z=null,bibtex:U=null,url:M=null,tags:se=null}){e.dataEditorOpened||(e.dataEditorOpened=!0,z!==null&&(o.value=z,r.value=z.summary.bibtex,l.value=z.summary.url,se===null&&(se=new O(z.summary.tags))),U!==null&&(r.value=U),M!==null&&(l.value=M),se!==null?(Array.isArray(se)&&(se=new O(se)),g.value={all:new O(e.tagStatus.all).union(se),checked:se,unfolded:se.allParents()}):g.value={all:new O(e.tagStatus.all),checked:new O(e.tagStatus.checked),unfolded:new O(e.tagStatus.unfolded)},i.value=!0)}function _(){i.value=!1,o.value=null,r.value="",l.value="",g.value={all:new O(e.tagStatus.all),checked:new O(e.tagStatus.checked),unfolded:new O(e.tagStatus.unfolded)},d.value=null,f.value="",re.value=!1,e.dataEditorOpened=!1}function m(){return i.value}function C(z){if(o.value)return e.showPopup("Document can only be added to new entry","error"),!1;if(!ct([z]).document)return e.showPopup("Unsupported file","error"),!1;if(d.value=z,console.log("file selected"),r.value.trim().length===0){console.log("try to extract bibtex from file");const U=z.name,M=z.lastModified,se=ut(c.value,{title:U,year:new Date(M).getFullYear()});r.value=se}return!0}function D(z){let U=!1;if(!z||z.length===0)return U;const M=ct(z);if((M.citation.length>1||M.document.length>1)&&e.showPopup("Only one citation and one document are allowed","error"),M.citation.length==0&&M.document.length==0&&(console.log("[Error] Got files: ",z),e.showPopup("Unsupported file type","error")),M.citation.length>0){const se=M.citation[0];if(se.size<64*1024){const tt=new FileReader;tt.onload=Dt=>{var nt;const Pt=(nt=Dt.target)==null?void 0:nt.result;r.value=Pt},tt.readAsText(se),U=!0}else e.showPopup("Text file too large","error")}return M.document.length>0&&(U=C(M.document[0])),U}t({show:h,close:_,isShown:m,loadFiles:D});const S=b(!1),c=b("article"),v=B(()=>ut(c.value)),$=b(!1),y=b("arxiv"),k={arxiv:z=>We.fromArxiv(z),doi:z=>We.fromDoi(z),webpage:z=>We.fromWebpage(z)},I={arxiv:"e.g. 2106.00001",doi:"e.g. 10.1145/344779.344937",webpage:"e.g. https://news.mit.edu/2021/xxx"},K=b("");function oe(z){e.showPopup("Fetching from BibTeX source...","info"),$.value=!1,K.value="",k[y.value](z).then(U=>{e.showPopup("Obtained bibtex from source","success"),r.value=U.bibtex,l.value=U.url},()=>{e.showPopup("Failed to fetch from source","error")})}const re=b(!1),we=b(null),ge=z=>{z.preventDefault(),re.value=!0},ce=z=>{z.preventDefault(),re.value=!1},be=z=>{var M;z.preventDefault();const U=(M=z.dataTransfer)==null?void 0:M.files;U&&D(U),re.value=!1};return(z,U)=>(p(),w(W,null,[x($e,{show:S.value,"onUpdate:show":U[4]||(U[4]=M=>S.value=M),onOnAccept:U[5]||(U[5]=()=>{r.value=v.value,S.value=!1}),onOnCancel:U[6]||(U[6]=M=>S.value=!1),"z-index":102,title:"Select template"},{default:E(()=>[n("div",fa,[x(ke,{onOnCheck:U[0]||(U[0]=M=>c.value="article"),checked:c.value=="article"},{default:E(()=>[A("Article")]),_:1},8,["checked"]),x(ke,{onOnCheck:U[1]||(U[1]=M=>c.value="inproceedings"),checked:c.value=="inproceedings"},{default:E(()=>[A("Inproceedings")]),_:1},8,["checked"]),x(ke,{onOnCheck:U[2]||(U[2]=M=>c.value="webpage"),checked:c.value=="webpage"},{default:E(()=>[A("Webpage")]),_:1},8,["checked"]),x(ke,{onOnCheck:U[3]||(U[3]=M=>c.value="misc"),checked:c.value=="misc"},{default:E(()=>[A("Misc")]),_:1},8,["checked"])])]),_:1},8,["show"]),x($e,{show:$.value,"onUpdate:show":U[11]||(U[11]=M=>$.value=M),onOnCancel:U[12]||(U[12]=M=>$.value=!1),onOnAccept:U[13]||(U[13]=()=>{oe(K.value)}),"z-index":102,title:"Source input"},{default:E(()=>[n("div",ma,[n("fieldset",{style:X({display:"flex",flexDirection:"row",gap:"10px",border:"1px solid var(--color-border)"})},[va,n("div",ga,[H(n("input",{type:"radio",id:"bibsource-arxiv",name:"bibSource",value:"arxiv","onUpdate:modelValue":U[7]||(U[7]=M=>y.value=M)},null,512),[[ze,y.value]]),_a]),n("div",ya,[H(n("input",{type:"radio",id:"bibsource-doi",name:"bibSource",value:"doi","onUpdate:modelValue":U[8]||(U[8]=M=>y.value=M)},null,512),[[ze,y.value]]),wa]),n("div",ba,[H(n("input",{type:"radio",id:"bibsource-webpage",name:"bibSource",value:"webpage","onUpdate:modelValue":U[9]||(U[9]=M=>y.value=M)},null,512),[[ze,y.value]]),ka])],4),H(n("input",{type:"text","onUpdate:modelValue":U[10]||(U[10]=M=>K.value=M),placeholder:I[y.value],style:{width:"100%",marginTop:"10px"}},null,8,$a),[[G,K.value]])])]),_:1},8,["show"]),x($e,{show:i.value,"onUpdate:show":U[21]||(U[21]=M=>i.value=M),title:o.value?o.value.authorAbbr():"new","show-cancel":!1,onOnAccept:u,onOnCance:_,onOnClose:_},{default:E(()=>[n("div",{id:"data-editor-main",ref_key:"dataEditorComponent",ref:we,onDragover:ge,onDrop:be,onDragend:ce},[re.value?(p(),w("div",qa,Fa)):(p(),w("div",Sa,[n("div",xa,[n("div",Ca,[n("div",Da,[n("div",Pa,[Ia,n("div",Ta,[n("div",{class:"button",onClick:U[14]||(U[14]=M=>S.value=!0)},"template"),n("div",{class:"button",onClick:U[15]||(U[15]=M=>$.value=!0)},"from-source")])]),H(n("textarea",{id:"bibtex","onUpdate:modelValue":U[16]||(U[16]=M=>r.value=M),placeholder:"bibtex / enw / nbib",class:"scrollable wrapword",style:{resize:"none"}},null,512),[[G,r.value]])]),n("div",Ua,[Ba,H(n("input",{id:"url","onUpdate:modelValue":U[17]||(U[17]=M=>l.value=M),placeholder:"url",type:"text"},null,512),[[G,l.value]])])]),n("div",Ma,[x(ia,{"tag-status":g.value,"onUpdate:tagStatus":U[18]||(U[18]=M=>g.value=M),"tag-input-value":f.value,"onUpdate:tagInputValue":U[19]||(U[19]=M=>f.value=M)},null,8,["tag-status","tag-input-value"])])]),o.value===null?(p(),w("div",La,[Aa,n("div",Ra,[A(T(d.value?d.value.name:"")+" ",1),d.value?(p(),w("a",{key:1,onClick:U[20]||(U[20]=M=>d.value=null),style:{cursor:"pointer",padding:"3px","border-radius":"5px"}}," (Remove) ")):(p(),V(P(Se),{key:0,text:"Select document",action:C,"as-link":!0,style:{cursor:"pointer",padding:"3px","border-radius":"5px"}}))]),Ea])):R("",!0)]))],544)]),_:1},8,["show","title"])],64))}}),Xe=q(za,[["__scopeId","data-v-c51ec443"]]),xe=s=>(ne("data-v-9fcb115d"),s=s(),ae(),s),Ha={class:"layout"},Na={id:"info"},Wa=xe(()=>n("td",null,[n("b",null,"Authors")],-1)),ja={id:"authorTD"},Ka=["onClick"],Va={key:0,id:"otherPubTR"},Za={colspan:"2"},Ga={id:"authorPapers"},Ja=xe(()=>n("td",null,[n("b",null,"Publication")],-1)),Qa=xe(()=>n("td",null,[n("b",null,"Year")],-1)),Ya=xe(()=>n("td",null,[n("b",null,"Tags")],-1)),Xa=xe(()=>n("td",null,[n("b",null,"Type")],-1)),es={id:"shortSummary"},ts={id:"shortSummaryTitle"},ns=xe(()=>n("b",null,"AI Summary",-1)),as=xe(()=>n("summary",null,[n("b",null,"Related Articles")],-1)),ss=L({__name:"DataSummary",props:{datapoint:{}},setup(s){const t=s,e=j(),a=b([]),i=b([]),o=B(()=>Object.fromEntries(a.value.map((c,v)=>[c.summary.uuid,i.value[v].toPrecision(3)]))),r=J().conn,l=b(null),d=b("");function g(c=!1){d.value="Loading...";let v="";u(),r.reqAISummary(t.datapoint.summary.uuid,$=>{$.replace(/\\n/g,"<br>"),v+=$,d.value=v},()=>{u(),console.log("finished")},c)}async function u(){let c=null;if(t.datapoint.supp.abstract?c=t.datapoint.supp.abstract:c=await t.datapoint.fetchAbstract(),c||(d.value&&!d.value.startsWith("Error")&&!d.value.startsWith("Loading")?c=d.value:c=t.datapoint.title),c=="")return;const v=await r.filter({searchBy:"feature",searchContent:c,maxResults:9}),$=await e.database.agetMany(v.uids,!1),y=new Array;for(const k of $){const I=v.uids.indexOf(k.summary.uuid);if(I>=0)y.push(v.scores[I]);else throw new Error("Related article not found in search result, IMPOSSIBLE")}[a.value,i.value]=_t($,y,!1),a.value&&a.value[0].summary.uuid==t.datapoint.summary.uuid&&(a.value.shift(),i.value.shift())}const f=b(""),h=b([]),_=b({});async function m(){const c=t.datapoint.authors,v=await Promise.all(c.map($=>e.database.agetByAuthor($)));_.value={};for(let $=0;$<c.length;$++)_.value[c[$]]=v[$]}const C=B(()=>{const c={};for(const v in _.value)_.value[v]&&_.value[v].length>1?c[v]=_.value[v].length-1:c[v]=null;return c});function D(c){h.value=_.value[c],h.value||(h.value=[]),h.value=h.value.filter(v=>v.summary.uuid!=t.datapoint.summary.uuid),f.value===c?f.value="":f.value=c}me(()=>{m(),g(!1)});const S=B(()=>{const k=(Math.min(Math.max(window.innerWidth-600,0)/1800,1)-.5)*Math.PI,I=(Math.sin(k)+1)*.5*1200,K=Math.round(I);return`${window.innerWidth-K}px`});return(c,v)=>(p(),w("div",{id:"main",style:X({width:S.value})},[n("h2",null,T(c.datapoint.summary.title),1),n("div",Ha,[n("div",Na,[n("table",null,[n("tr",null,[Wa,n("td",ja,[(p(!0),w(W,null,Q(c.datapoint.summary.authors,$=>(p(),w("div",null,[n("span",null,T($),1),C.value[$]!==null?(p(),w("a",{key:0,onClick:()=>D($)}," ("+T(C.value[$])+") ",9,Ka)):R("",!0)]))),256))])]),x(Te,{name:"slideDown"},{default:E(()=>[f.value?(p(),w("tr",Va,[n("td",Za,[n("b",null,T(`Other publications from ${f.value.toUpperCase()}:`),1),n("div",Ga,[x(Ue,{uids:h.value.map($=>$.summary.uuid)},null,8,["uids"])])])])):R("",!0)]),_:1}),n("tr",null,[Ja,n("td",null,T(c.datapoint.summary.publication),1)]),n("tr",null,[Qa,n("td",null,T(c.datapoint.summary.year),1)]),n("tr",null,[Ya,n("td",null,T(c.datapoint.summary.tags.toString()),1)]),n("tr",null,[Xa,n("td",null,T(c.datapoint.docType()+`${c.datapoint.summary.has_file?" ("+c.datapoint.summary.doc_size.toString()+"M)":""}`),1)])])]),n("div",es,[n("div",ts,[ns,n("div",{class:"button",onClick:v[0]||(v[0]=$=>g(!0))},"↻")]),n("p",{id:"aiSummary",ref_key:"aiSummaryParagraph",ref:l},T(d.value),513)]),n("details",null,[as,x(Ue,{uids:a.value.map($=>$.summary.uuid),scores:o.value},null,8,["uids","scores"])])])],4))}}),os=q(ss,[["__scopeId","data-v-9fcb115d"]]),is=s=>(ne("data-v-b4af7028"),s=s(),ae(),s),rs={id:"citations",style:{textAlign:"left"}},ls=["onClick"],us={class:"citation-text",style:{overflowX:"hidden",whiteSpace:"nowrap"}},cs={key:0},ds={key:0,id:"moreMain"},hs={class:"row",id:"buttons"},ps=["href"],fs={key:0,class:"row",id:"actions"},ms={id:"abstract"},vs=is(()=>n("summary",null,"Abstract",-1)),gs=L({__name:"FileRowMore",props:{datapoint:{},show:{type:Boolean}},setup(s,{expose:t}){const e=s,a=F(),i=b(null),o=async c=>{c.target instanceof HTMLDetailsElement&&!c.target.open||(i.value.setEditable(!1),i.value.innerText="Loading...",e.datapoint.fetchAbstract().then(v=>{i.value.innerText=v,i.value.setEditable(!0)},()=>{i.value.innerText="Failed to load abstract."}))},r=async c=>{c&&(await e.datapoint.uploadAbstract(c),await e.datapoint.update())},l=b(!1);function d(c,v){return[c,`${v.length>80?v.slice(0,80)+"...":v}`,v]}function g(c){Ve(c).then(v=>{v?a.showPopup("Copied to clipboard.","info"):a.showPopup("Failed to copy to clipboard.","error")})}const u=b(!1);function f(c){a.showPopup("uploading..."),e.datapoint.uploadDocument(c).then(v=>{e.datapoint.update(v),a.showPopup("Document uploaded","success")},()=>a.showPopup("Failed to upload document","error"))}function h(){window.confirm(`Free document? 
${e.datapoint.toString()}`)&&e.datapoint.freeDocument().then(c=>{e.datapoint.update(c),a.showPopup("Document deleted","info")},()=>a.showPopup("Failed to free document","error"))}function _(){const c=e.datapoint.summary.uuid;window.confirm(`[IMPORTANT] Delete? 
${e.datapoint.toString()}`)&&J().conn.deleteDatapoint(c).then(v=>{a.showPopup("Deleted")})}const m=b(null);function C(){m.value.show({datapoint:e.datapoint})}const D=B(()=>i.value===null?!m.value.isShown():!m.value.isShown()&&!i.value.hasFocus());t({editThisDatapoint:C,deleteThisDatapoint:_,shouldEnableEditDatapoint:D});const S=b(!1);return(c,v)=>{const $=dt("router-link");return p(),w(W,null,[x(De,{show:S.value,"onUpdate:show":v[0]||(v[0]=y=>S.value=y),title:"Summary"},{default:E(()=>[x(os,{datapoint:c.datapoint},null,8,["datapoint"])]),_:1},8,["show"]),x(De,{show:l.value,"onUpdate:show":v[1]||(v[1]=y=>l.value=y),title:"Citations"},{default:E(()=>[(p(!0),w(W,null,Q([d("Title",`${c.datapoint.summary.title}`),d("Author-year",`${c.datapoint.authorAbbr()} (${c.datapoint.summary.year})`),d("APA",`${c.datapoint.authorAbbr()} (${c.datapoint.summary.year}). ${c.datapoint.summary.title}. ${c.datapoint.summary.publication}.`),d("Bibtex",c.datapoint.summary.bibtex),d("DocURL",c.datapoint.getRawDocURL()),d("Markdown",`[${c.datapoint.authorAbbr()} (${c.datapoint.summary.year})](${c.datapoint.getRawDocURL()})`),d("UUID",`${c.datapoint.summary.uuid}`)],(y,k)=>(p(),w("div",rs,[n("div",{onClick:()=>{g(y[2]),l.value=!1},style:{cursor:"pointer",display:"flex",flexDirection:"row"}},[n("div",{class:"citation-type",style:X({marginLeft:"10px",marginRight:"10px",borderRadius:"5px",backgroundColor:"var(--color-background-mute)",padding:"3px",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center"})},T(y[0]),5),n("p",us,T(y[1]),1)],8,ls),k!==6?(p(),w("hr",cs)):R("",!0)]))),256))]),_:1},8,["show"]),x(Xe,{ref_key:"dataEditor",ref:m},null,512),x(Te,{name:"expand-transition"},{default:E(()=>[c.show?(p(),w("div",ds,[n("div",hs,[x($,{to:`/reader/${e.datapoint.summary.uuid}`},{default:E(()=>[A("Reader")]),_:1},8,["to"]),c.datapoint.url?(p(),w("a",{key:0,href:c.datapoint.getRawDocURL(),target:"_blank"},"Link",8,ps)):R("",!0),n("a",{rel:"noopener noreferrer",onClick:v[2]||(v[2]=()=>S.value=!S.value)},"Summary"),n("a",{rel:"noopener noreferrer",onClick:v[3]||(v[3]=()=>l.value=!l.value)},"Cite"),n("a",{rel:"noopener noreferrer",onClick:v[4]||(v[4]=()=>u.value=!u.value)},"Actions")]),x(Te,{name:"actions"},{default:E(()=>[u.value?(p(),w("div",fs,[n("a",{rel:"noopener noreferrer",class:"btn",onClick:C},"Edit"),c.datapoint.summary.has_file?(p(),w("a",{key:1,rel:"noopener noreferrer",onClick:h,class:"danger btn"},"Free document")):(p(),V(P(Se),{key:0,action:y=>f(y),text:"Upload document","as-link":!0},null,8,["action"])),n("a",{rel:"noopener noreferrer",onClick:_,class:"danger btn"},"Delete")])):R("",!0)]),_:1}),n("div",ms,[n("details",{onToggle:o},[vs,x(P(Ye),{id:"abstractParagraph",ref_key:"abstractParagraph",ref:i,style:{minHeight:"20px"},onFinish:v[5]||(v[5]=y=>r(y))},null,512)],32)])])):R("",!0)]),_:1})],64)}}}),_s=q(gs,[["__scopeId","data-v-b4af7028"]]),ys="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M200-120v-640q0-33%2023.5-56.5T280-840h400q33%200%2056.5%2023.5T760-760v640L480-240%20200-120Zm80-122%20200-86%20200%2086v-518H280v518Zm0-518h400-400Z'/%3e%3c/svg%3e",ws="data:image/svg+xml,%3c?xml%20version='1.0'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20width='24px'%20height='24px'%3e%3cpath%20d='M%206%202%20C%205.861875%202%205.7278809%202.0143848%205.5976562%202.0410156%20C%204.686084%202.2274316%204%203.033125%204%204%20L%204%2022%20L%2012%2019%20L%2020%2022%20L%2020%204%20C%2020%203.8625%2019.985742%203.7275391%2019.958984%203.5976562%20C%2019.799199%202.8163086%2019.183691%202.2008008%2018.402344%202.0410156%20C%2018.272119%202.0143848%2018.138125%202%2018%202%20L%206%202%20z'/%3e%3c/svg%3e",bs={class:"left",style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start",flexWrap:"nowrap",gap:"0.25rem"}},ks={id:"marks"},$s=["src"],Ss=["src"],xs={class:"row text"},Cs={style:{borderRadius:"10px",marginLeft:"5px",display:"flex",flexDirection:"column"}},Ds={id:"title",style:{display:"flex",fontSize:"1rem"}},Ps={class:"right row"},Is={id:"statusDiv",style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"2px"}},Ts={class:"status"},Us={key:0,src:En,alt:"",class:"icon"},Bs={key:1,src:Qe,alt:"",class:"icon placeholder"},Ms={class:"status"},Ls={key:0,src:qn,alt:"",class:"icon"},As={key:1,src:On,alt:"",class:"icon"},Rs={key:2,src:Fn,alt:"",class:"icon"},Es={key:3,src:Qe,alt:"",class:"icon placeholder"},qs={class:"status"},Os={key:0,src:zn,alt:"",class:"icon"},Fs={key:1,src:Hn,alt:"",class:"icon"},zs={key:2,src:Qe,alt:"",class:"icon placeholder"},Hs=12,Ns=1,Ws=L({__name:"FileRow",props:{datapoint:{},unfoldedIds:{},hoveredIds:{},line_number:{default:0}},emits:["update:unfoldedIds","update:hoveredIds"],setup(s,{emit:t}){const e=s,a=t,i=B({get:()=>e.unfoldedIds,set:v=>a("update:unfoldedIds",v)}),o=B({get:()=>e.hoveredIds,set:v=>a("update:hoveredIds",v)}),r=B(()=>i.value.includes(e.datapoint.summary.uuid)),l=b(null),d=b(null),g=b(null),u=b(null);let f=!1;function h(v){if(lt(v.target,l.value)){if(v.target.id=="authorYear"){const $=e.datapoint.getOpenDocURL();$!==""&&en($),f=!0}if(!lt(v.target,g.value)){if(f){f=!1;return}r.value?i.value=i.value.filter($=>$!==e.datapoint.summary.uuid):i.value=[e.datapoint.summary.uuid]}}}const _=B(()=>e.datapoint.yearAuthor("-")),m=b(!1);te(m,v=>{v?o.value.push(e.datapoint.summary.uuid):o.value=o.value.filter($=>$!==e.datapoint.summary.uuid)});const C=B(()=>m.value?"var(--color-background-theme-highlight)":i.value.includes(e.datapoint.summary.uuid)?"var(--color-background-theme)":e.line_number%2==0?"var(--color-background-ssoft)":"var(--color-background)");function D(v){const $=e.datapoint.summary.tags.slice();v?$.push("* Bookmark"):$.splice($.indexOf("* Bookmark"),1);const y=e.datapoint.summary.uuid;J().conn.updateDatapoint(y,{tags:$}).then(k=>{e.datapoint.update(k),F().updateShownData()},()=>F().showPopup("Failed to save","error")),f=!0}function S(){var v;return i.value.includes(e.datapoint.summary.uuid)&&m.value&&document.activeElement===document.body&&((v=u.value)==null?void 0:v.shouldEnableEditDatapoint)}function c(v){var $,y;v.code==="Space"&&S()&&(($=u.value)==null||$.editThisDatapoint(),v.preventDefault()),(v.code==="Delete"||v.code==="Backspace")&&S()&&((y=u.value)==null||y.deleteThisDatapoint(),v.preventDefault())}return te(()=>i.value,v=>{v.includes(e.datapoint.summary.uuid)?window.addEventListener("keydown",c):window.removeEventListener("keydown",c)}),(v,$)=>(p(),w("div",{id:"fileRow",class:de(`${r.value?" unfolded":""}`),onClick:h,onMouseover:$[2]||($[2]=y=>m.value=!0),onMouseleave:$[3]||($[3]=y=>m.value=!1),ref_key:"dataCard",ref:l,style:X({backgroundColor:C.value})},[n("div",{id:"init",class:"row",ref_key:"initDiv",ref:d},[n("div",bs,[n("div",ks,[v.datapoint.summary.tags.includes("* Bookmark")?(p(),w("img",{key:0,src:P(ws),alt:"",class:"icon redIcon",onClick:$[0]||($[0]=()=>D(!1)),style:{height:"1rem"}},null,8,$s)):(p(),w("img",{key:1,src:P(ys),alt:"",class:"icon",onClick:$[1]||($[1]=()=>D(!0)),style:{height:"1rem"}},null,8,Ss))]),n("div",xs,[n("div",Cs,[n("div",Ds,T(v.datapoint.summary.title),1),n("div",{style:X({marginTop:"0px",padding:"0px",color:"var(--color-text-soft)",fontSize:"0.75rem"})},T(_.value+", "+v.datapoint.publication),5)]),fe(v.$slots,"default",{},void 0,!0)])]),n("div",Ps,[n("div",Is,[n("div",Ts,[v.datapoint.summary.has_abstract?(p(),w("img",Us)):(p(),w("img",Bs))]),n("div",Ms,[v.datapoint.docType()=="pdf"?(p(),w("img",Ls)):v.datapoint.docType()=="html"?(p(),w("img",As)):v.datapoint.docType()=="url"?(p(),w("img",Rs)):(p(),w("img",Es))]),n("div",qs,[v.datapoint.summary.note_linecount>Hs?(p(),w("img",Os)):v.datapoint.summary.note_linecount>Ns?(p(),w("img",Fs)):(p(),w("img",zs))])])])],512),n("div",{id:"more",ref_key:"moreDiv",ref:g},[x(_s,{datapoint:v.datapoint,show:r.value,ref_key:"moreComponent",ref:u},null,8,["datapoint","show"])],512)],38))}}),js=q(Ws,[["__scopeId","data-v-71763e14"]]),Ks={id:"datacard-container-main"},Vs={key:0,class:"relatedArticleScore"},Zs={key:1,id:"datacard-container-footer"},Gs=["disabled"],Js={style:{"margin-left":"10px","margin-right":"10px",display:"flex",gap:"5px"}},Qs=["disabled"],Ys=L({__name:"FileRowContainer",props:{uids:{},unfoldedIds:{default:null},hoveredIds:{default:null},scores:{default:null},compact:{type:Boolean,default:!0}},emits:["update:datapoints","update:unfoldedIds","update:hoveredIds"],setup(s,{emit:t}){const e=s,a=t,i=b([]),o=B({get:()=>e.unfoldedIds==null?i.value:e.unfoldedIds,set:c=>{e.unfoldedIds==null?i.value=c:a("update:unfoldedIds",c)}}),r=b([]),l=B({get:()=>e.hoveredIds==null?r.value:e.hoveredIds,set:c=>{e.hoveredIds==null?r.value=c:a("update:hoveredIds",c)}}),d=b(null),g=b(null),u=b(0),f=N(),h=b([]),_=b(!1);function m(){const c=u.value*f.numItemsPerPage,v=Math.min(c+f.numItemsPerPage,e.uids.length),$=e.uids.slice(c,v),y=j().database;let k=!0;(async()=>(await new Promise(I=>setTimeout(I,500)),k&&(_.value=!1)))(),y.agetMany($).then(I=>{h.value=I,k=!1,_.value=!0})}te([()=>e.uids,()=>u.value,()=>f.numItemsPerPage],()=>{e.uids.length<u.value*f.numItemsPerPage&&(u.value=0),m()}),m();const C=()=>{var c;u.value>=Math.ceil(e.uids.length/f.numItemsPerPage)-1||(u.value++,g.value.setText(""+(u.value+1)),(c=d.value)==null||c.scrollTo({top:0,behavior:"auto"}))},D=()=>{var c;u.value!=0&&(u.value--,g.value.setText(""+(u.value+1)),(c=d.value)==null||c.scrollTo({top:0,behavior:"auto"}))},S=c=>{const v=c.target;v.scrollTop==0||v.scrollTop+v.clientHeight>=v.scrollHeight};return(c,v)=>(p(),w("div",Ks,[n("div",{id:"datacard-container",style:X({gap:c.compact?"0px":"5px"}),ref_key:"datacardContainer",ref:d,onScroll:S,class:"scrollable"},[(p(!0),w(W,null,Q(h.value,($,y)=>(p(),V(js,{datapoint:$,"unfolded-ids":o.value,"onUpdate:unfoldedIds":v[0]||(v[0]=k=>o.value=k),"hovered-ids":l.value,"onUpdate:hoveredIds":v[1]||(v[1]=k=>l.value=k),line_number:y,compact:c.compact},{default:E(()=>[e.scores!=null&&e.scores[$.summary.uuid]!=null?(p(),w("label",Vs,T(e.scores[$.summary.uuid]),1)):R("",!0)]),_:2},1032,["datapoint","unfolded-ids","hovered-ids","line_number","compact"]))),256))],36),_.value?R("",!0):(p(),V(Te,{key:0,name:"fade"},{default:E(()=>[x(gt,{text:"Loading data..."})]),_:1})),c.uids.length>P(f).numItemsPerPage?(p(),w("div",Zs,[n("button",{onClick:D,disabled:u.value==0},"Prev",8,Gs),n("span",Js,[x(P(Ye),{ref_key:"pageIndicatorEditableParagrah",ref:g,onFinish:v[2]||(v[2]=$=>{parseInt($)>0&&parseInt($)<=Math.ceil(c.uids.length/P(f).numItemsPerPage)&&(u.value=parseInt($)-1)})},{default:E(()=>[A(T(u.value+1),1)]),_:1},512),A(" / "),n("p",null,T(Math.ceil(c.uids.length/P(f).numItemsPerPage)),1)]),n("button",{onClick:C,disabled:u.value>=Math.ceil(c.uids.length/P(f).numItemsPerPage)-1},"Next",8,Qs)])):R("",!0)]))}}),Ue=q(Ys,[["__scopeId","data-v-703bfd64"]]),Xs=["title"],eo=["src","alt"],to={for:"icon",class:"iconLabel non-selectable"},no=L({__name:"ToolbarIcon",props:{iconSrc:{},labelText:{},title:{default:""},shortcut:{default:null}},emits:["onClick","click"],setup(s,{expose:t,emit:e}){const a=s,i=B(()=>a.title+(a.shortcut===null?"":` (${a.shortcut})`)),o=e,r=b(null);t({getBoundingClientRect:()=>{var f;return(f=r.value)==null?void 0:f.getBoundingClientRect()}});function d(){o("onClick"),o("click")}function g(f){if(f===null)return null;const h=f.toLowerCase().split("+");return _=>{h.includes("ctrl")&&!_.ctrlKey||h.includes("alt")&&!_.altKey||h.includes("shift")&&!_.shiftKey||h.includes("meta")&&!_.metaKey||h.includes(_.key.toLowerCase())&&(console.log("shortcut triggered: "+f+" | "+a.labelText),d(),_.preventDefault())}}const u=g(a.shortcut);return ht(()=>{u!==null&&window.addEventListener("keydown",u)}),pt(()=>{u!==null&&window.removeEventListener("keydown",u)}),(f,h)=>(p(),w("span",{class:"hoverMaxout105 button non-selecable",onClick:d,onKeydown:Ke(d,["enter"]),tabindex:0,title:`${i.value}`,ref_key:"button",ref:r},[n("img",{id:"icon",class:"icon",src:f.iconSrc,alt:f.labelText.toUpperCase()+"_ICON"},null,8,eo),n("label",to,T(f.labelText),1)],40,Xs))}}),_e=q(no,[["__scopeId","data-v-f0fccbdf"]]);let ao=window.location.protocol,kt;kt=`${ao}//${window.location.hostname}:${window.location.port}`;const so=`${kt}/documentation/`;console.log("production mode");function Be(){const s=N().backendPort;return`${N().backendHost}:${s}`}const oo={name:"Li, Mengxun",email:"mengxunli@whu.edu.cn"},Ae=["SweetiePie","CutiePatootie","CuddleBug","FluffyPaws","HoneyBee","SnuggleMuffin","SugarPlum","AngelFace","PawsomePuppy","TeddyBearHugs","PrettyKitty","LoveBug","BabyDoll","SunshineSmiles","FuzzyWuzzy","BumbleBee","CupcakeQueen","DoodleDaisy","PurrfectPaws","CuddlyKoala","SweetPea","BunnyHop","SparklePony","HappyPanda","DreamyDove","FluffyCloud","CherryBlossom","AngelicWhisper","SnickerDoodle","LuckyLadybug","BlossomButterfly","SugarCubes","CottonCandyDreams","HoneyBunches","FurryFriend","BabyBlueEyes","SweetCheeks","PawsitiveVibes","SnugglyBear","LovelyLlama","PurrfectlyAdorable","TwinkleToes","CuddleBunny","CookieCrumbs","SunnySmiles","FluffyKitten","DarlingDeer","ButterflyKisses","FuzzyWuzzyPanda","SweetDreamer","SillyGoose","DaisyDoodle","CupcakeCutie","BuzzyBee","SnoozySnail","CharmingChick","CandyCane","BerryBlossom","Dimples","CocoaCuddles","CheerfulCherub","PetalPaws","BubblyBumble","AngelWings","JollyJellybean","WhiskerWonder","SprinkleSmiles","GigglyGiraffe","DancingDaisy","SunnySideUp","SnugglySloth","CuteQuokka","PeachyPaws","BouncyBunny","DazzlingDimples","ChirpyChickadee","CandyHeart","CupcakeSprinkle","BuzzyButterfly","SnoozyPanda","CharmingCorgi","CottonCandyCloud","BerryBlush","DimpleDoll","CocoaCuddler","CheerfulChipmunk","PetalWhiskers","BubblyButterfly","AngelFeathers","JollyJumper","WhiskerWanderer","SprinkleSweets","GigglyGazelle","DancingDolphin","SunnySmiles","SnugglySquirrel","CuteKangaroo","PeachyPup","BouncyBear","DazzlingDarling","ChirpyCockatiel","CandyCharm","CupcakeDelight","BuzzyBee","SnoozySloth","CharmingChinchilla","CottonCandyDream","BerryBlossom","DimpleDaisy","CocoaCuddles","CheerfulCheek","PetalPurr","BubblyBumblebee","AngelWhispers","JollyJester","WhiskerWonder","SprinkleSunshine","GigglyGiraffe","DancingDandelion","SunnySideUp","SnugglySheep","CuteKoala","PeachyPanda","BouncyBunny","DazzlingDaisy","ChirpyChickadee","CandyCane","CupcakeCutie","BuzzyButterfly","SnoozySnail","CharmingCherub","CottonCandyCloud","BerryBlush","DimpleDoll","CocoaCuddler","CheerfulChipmunk","PetalWhiskers","BubblyButterfly","AngelFeathers","JollyJumper","WhiskerWanderer","SprinkleSweets","GigglyGazelle","DancingDolphin","SunnySmiles","SnugglySquirrel","CuteKangaroo","PeachyPup","BouncyBear","DazzlingDarling","ChirpyCockatiel","CandyCharm","CupcakeDelight","BuzzyBee","SnoozySloth","CharmingChinchilla","CottonCandyDream","BerryBlossom","DimpleDaisy","CocoaCuddles","CheerfulCheek","PetalPurr","BubblyBumblebee","AngelWhispers","JollyJester","WhiskerWonder","SprinkleSunshine","GigglyGiraffe","DancingDandelion","SunnySideUp","SnugglySheep","CuteKoala","PeachyPanda","BouncyBunny","DazzlingDaisy"],io="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M200-120q-33%200-56.5-23.5T120-200v-560q0-33%2023.5-56.5T200-840h357l-80%2080H200v560h560v-278l80-80v358q0%2033-23.5%2056.5T760-120H200Zm280-360ZM360-360v-170l367-367q12-12%2027-18t30-6q16%200%2030.5%206t26.5%2018l56%2057q11%2012%2017%2026.5t6%2029.5q0%2015-5.5%2029.5T897-728L530-360H360Zm481-424-56-56%2056%2056ZM440-440h56l232-232-28-28-29-28-231%20231v57Zm260-260-29-28%2029%2028%2028%2028-28-28Z'/%3e%3c/svg%3e",ro={data(){return{usedSpace:0,totalSpace:1,unit:"MB"}},computed:{fillPercentage(){return`${Math.min(this.usedSpace/this.totalSpace,1)*100}%`}},mounted(){this.usedSpace=0,this.totalSpace=1,this.unit="MB",this.fetchDiskUsage()},methods:{fetchDiskUsage(){J().conn.reqDatabaseUsage().then(s=>{const t=(s.disk_usage/1024/1024).toFixed(1),e=(s.disk_limit/1024/1024).toFixed(1);e>1024?(this.unit="GB",this.usedSpace=(t/1024).toFixed(1),this.totalSpace=(e/1024).toFixed(1)):(this.unit="MB",this.usedSpace=t,this.totalSpace=e)},()=>{console.log("failed to fetch disk usage")})}}},lo={id:"disk-usage-main"},uo={class:"disk-usage-bar"},co={class:"disk-usage-text"};function ho(s,t,e,a,i,o){return p(),w("div",lo,[n("div",uo,[n("div",{class:"disk-usage-fill",style:X({width:o.fillPercentage})},null,4)]),n("div",co," Space: "+T(i.usedSpace)+" / "+T(i.totalSpace)+" "+T(i.unit),1)])}const po=q(ro,[["render",ho],["__scopeId","data-v-6a56d11b"]]),et=s=>(ne("data-v-7202375c"),s=s(),ae(),s),fo={id:"usercard-main"},mo={id:"user-settings"},vo=et(()=>n("hr",null,null,-1)),go=et(()=>n("summary",null,"Change password",-1)),_o={id:"password-container"},yo={id:"info"},wo={id:"user-desc"},bo={id:"name-edit"},ko={id:"name"},$o=["src"],So={key:0,class:"admin_hint"},xo=et(()=>n("div",{style:{height:"0.2rem"}},null,-1)),Co=L({__name:"UserCard",props:{userInfo:{},avatarSize:{default:"168px"}},emits:["update:userInfo"],setup(s,{emit:t}){const e=s,a=J().conn,i=t,o=B(()=>j().user.id===e.userInfo.id),r=b(null),l=b(d());function d(){return`${Be()}/user-avatar/${e.userInfo.username}?t=${Date.now()}&size=256`}function g(D){if(!D.type.startsWith("image/")){F().showPopup("Please select an image file","error");return}F().showPopup("Uploading avatar..."),a.uploadUserAvatar(e.userInfo.username,D).then(S=>{l.value=d(),i("update:userInfo",S)},S=>{F().showPopup(S,"error")})}const u=b(!1),f=b(""),h=b(""),_=b(""),m=b("");function C(){if(f.value===""||f.value===e.userInfo.name||f.value!==e.userInfo.name&&a.updateUserNickname(f.value).then(D=>{i("update:userInfo",D),u.value=!1},D=>{F().showPopup(D,"error")}),_.value!==""||m.value!==""){if(_.value===""){F().showPopup("Please enter the new password","error");return}if(_.value!==m.value){F().showPopup("The new passwords do not match","error");return}if(N().encKey!==pe(e.userInfo.username+pe(h.value))){F().showPopup("The old password is incorrect","error");return}a.updateUserPassword(_.value).then(D=>{const S=pe(e.userInfo.username+pe(_.value));N().setEncKey(S),h.value="",_.value="",m.value="",u.value=!1},D=>{F().showPopup(D,"error")})}}return(D,S)=>(p(),w("div",fo,[x($e,{show:u.value,"onUpdate:show":S[4]||(S[4]=c=>u.value=c),title:"User settings",onOnCancel:S[5]||(S[5]=c=>u.value=!1),onOnAccept:C},{default:E(()=>[n("div",mo,[n("b",null,T(e.userInfo.username),1),H(n("input",{type:"text","onUpdate:modelValue":S[0]||(S[0]=c=>f.value=c),placeholder:"Nickname",class:"input"},null,512),[[G,f.value]]),vo,n("details",null,[go,n("div",_o,[H(n("input",{type:"password","onUpdate:modelValue":S[1]||(S[1]=c=>h.value=c),placeholder:"Old password",class:"input"},null,512),[[G,h.value]]),H(n("input",{type:"password","onUpdate:modelValue":S[2]||(S[2]=c=>_.value=c),placeholder:"New password",class:"input"},null,512),[[G,_.value]]),H(n("input",{type:"password","onUpdate:modelValue":S[3]||(S[3]=c=>m.value=c),placeholder:"Confirm new password",class:"input"},null,512),[[G,m.value]])])])])]),_:1},8,["show"]),n("div",yo,[n("div",{id:"avatar",style:X(o.value?{cursor:"pointer",borderRadius:"50%"}:{})},[x(P(pa),{href:l.value,size:D.avatarSize,onClick:S[6]||(S[6]=c=>{var v;return o.value?(v=r.value)==null?void 0:v.click():()=>{}})},null,8,["href","size"]),x(P(Se),{text:"Change avatar",action:g,ref_key:"avatarUploadBtn",ref:r,style:{display:"none"}},null,512)],4),n("div",wo,[n("div",bo,[n("h1",ko,T(e.userInfo.name),1),o.value?(p(),w("img",{key:0,src:P(io),alt:"",class:"icon",id:"edit-settings-icon",onClick:S[7]||(S[7]=c=>u.value=!0)},null,8,$o)):R("",!0)]),n("p",{onClick:S[8]||(S[8]=c=>u.value=!0),style:{cursor:"pointer"}},[A(T(e.userInfo.username)+" ",1),e.userInfo.is_admin?(p(),w("label",So,"admin")):R("",!0)]),x(po),xo])]),n("p",{id:"credential",onClick:S[9]||(S[9]=()=>{P(Ve)(P(N)().encKey).then(()=>{P(F)().showPopup("Secret copied to clipboard","info")})})},"-- Credential:"+T(P(N)().encKey.substring(0,12))+" --",1)]))}}),Do=q(Co,[["__scopeId","data-v-7202375c"]]),Po={props:{title:{type:String,required:!0},description:{type:String,required:!0}}},Io={class:"settings-container"},To={class:"settings-header"},Uo={class:"widget"};function Bo(s,t,e,a,i,o){return p(),w("div",Io,[n("div",To,[n("label",null,T(e.title),1),n("p",null,T(e.description),1)]),n("div",Uo,[fe(s.$slots,"default",{},void 0,!0)])])}const Fe=q(Po,[["render",Bo],["__scopeId","data-v-f00f1fc8"]]),Mo=n("option",{value:"auto"},"Auto",-1),Lo=n("option",{value:"light"},"Light",-1),Ao=n("option",{value:"dark"},"Dark",-1),Ro=[Mo,Lo,Ao],Eo=L({__name:"ConfigTheme",setup(s){const t=b("auto");function e(){t.value=Z.getThemeMode()}function a(i){i==="auto"?(Z.clear(),Z.setDefaultDarkMode()):i==="light"?Z.setDarkMode(!1):i==="dark"&&Z.setDarkMode(!0),e()}return e(),(i,o)=>(p(),V(Fe,{title:"Theme",description:"Change the theme of the app"},{default:E(()=>[H(n("select",{"onUpdate:modelValue":o[0]||(o[0]=r=>t.value=r),onChange:o[1]||(o[1]=r=>a(t.value)),style:{width:"80px",textAlign:"center",padding:"0.2rem",justifySelf:"flex-end"}},Ro,544),[[Re,t.value]])]),_:1}))}}),qo={class:"switch-toggle"},Oo=L({__name:"SwitchToggle",props:{checked:{type:Boolean}},emits:["update:checked"],setup(s,{emit:t}){const a=b(s.checked),i=t,o=b(null);return(r,l)=>(p(),w("div",qo,[H(n("input",{type:"checkbox",id:"toggle","onUpdate:modelValue":l[0]||(l[0]=d=>a.value=d),onChange:l[1]||(l[1]=()=>{i("update:checked",a.value)}),ref_key:"checkerRef",ref:o},null,544),[[Lt,a.value]]),n("label",{class:"switch",onClick:l[2]||(l[2]=d=>{var g;return(g=o.value)==null?void 0:g.click()})})]))}}),Me=q(Oo,[["__scopeId","data-v-58ea3d44"]]),Fo=L({__name:"ConfigShowTags",setup(s){const t=N(),e=B({get:()=>t.showTagPanel,set:a=>t.setShowTagPanel(a)});return(a,i)=>(p(),V(Fe,{title:"Tag Display",description:"Show tag panel on the home page"},{default:E(()=>[x(Me,{checked:e.value,"onUpdate:checked":i[0]||(i[0]=o=>e.value=o)},null,8,["checked"])]),_:1}))}}),zo=L({__name:"ConfigShowScatterPlot",setup(s){const t=N(),e=B({get:()=>t.show3DScatterPlot,set:a=>t.setShow3DScatterPlot(a)});return(a,i)=>(p(),V(Fe,{title:"Scatter Plot",description:"Show scatter plot on the home page"},{default:E(()=>[x(Me,{checked:e.value,"onUpdate:checked":i[0]||(i[0]=o=>e.value=o)},null,8,["checked"])]),_:1}))}}),Ho=["value"],No=L({__name:"ConfigPageCapacity",setup(s){const t=B({get:()=>N().numItemsPerPage,set:a=>N().setNumItemsPerPage(a)}),e=[10,20,50,100,200,500];return(a,i)=>(p(),V(Fe,{title:"Page Capacity",description:"Smaller number can improve performance"},{default:E(()=>[H(n("select",{"onUpdate:modelValue":i[0]||(i[0]=o=>t.value=o),style:{width:"80px",textAlign:"center",padding:"0.2rem",justifySelf:"flex-end"}},[(p(),w(W,null,Q(e,o=>n("option",{value:o,key:o},T(o),9,Ho)),64))],512),[[Re,t.value]])]),_:1}))}}),Wo={style:{display:"flex",flexDirection:"column",gap:"0.5rem",padding:"0.5rem",width:"100%",height:"100%",overflowY:"auto"}},jo={style:{display:"flex",justifyContent:"center",alignItems:"center"}},Ko=n("hr",null,null,-1),Vo=L({__name:"SettingsWindow",setup(s){const t=j().user;return(e,a)=>(p(),w("div",Wo,[n("div",jo,[x(Do,{"user-info":P(t),"avatar-size":"120px"},null,8,["user-info"])]),Ko,x(Eo),x(No),x(Fo),x(zo)]))}}),Zo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M180%20936q-24%200-42-18t-18-42V276q0-24%2018-42t42-18h291v60H180v600h291v60H180Zm486-185-43-43%20102-102H375v-60h348L621%20444l43-43%20176%20176-174%20174Z'/%3e%3c/svg%3e",Go="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='m263-263%20290-143%20143-290-290%20143-143%20290Zm217-177q-17%200-28.5-11.5T440-480q0-17%2011.5-28.5T480-520q17%200%2028.5%2011.5T520-480q0%2017-11.5%2028.5T480-440Zm0%20360q-82%200-155-31.5t-127.5-86Q143-252%20111.5-325T80-480q0-83%2031.5-156t86-127Q252-817%20325-848.5T480-880q83%200%20156%2031.5T763-763q54%2054%2085.5%20127T880-480q0%2082-31.5%20155T763-197.5q-54%2054.5-127%2086T480-80Zm0-60q142%200%20241-99.5T820-480q0-142-99-241t-241-99q-141%200-240.5%2099T140-480q0%20141%2099.5%20240.5T480-140Zm0-340Z'/%3e%3c/svg%3e",Jo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M240-200h120v-240h240v240h120v-360L480-740%20240-560v360Zm-80%2080v-480l320-240%20320%20240v480H520v-240h-80v240H160Zm320-350Z'/%3e%3c/svg%3e",Qo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M440-120v-240h80v80h320v80H520v80h-80Zm-320-80v-80h240v80H120Zm160-160v-80H120v-80h160v-80h80v240h-80Zm160-80v-80h400v80H440Zm160-160v-240h80v80h160v80H680v80h-80Zm-480-80v-80h400v80H120Z'/%3e%3c/svg%3e",Yo={class:"button"},Xo={key:0,id:"navigator"},ei={class:"nav-toggle"},ti=L({__name:"Toolbar",props:{returnHome:{type:Boolean,default:!0},compact:{type:Boolean,default:!0},showNavigator:{type:Boolean,default:!0}},setup(s){const t=s,e=ye();function a(){on()}const i=b(null);let o=0;window.addEventListener("scroll",function(){const g=window.scrollY||document.documentElement.scrollTop;g<=o||o<10?i.value&&i.value.classList.contains("hidden")&&i.value.classList.remove("hidden"):i.value&&!i.value.classList.contains("hidden")&&i.value.classList.add("hidden"),o=g});const r=b(!1),l=ft(),d=B(()=>l.path.split("/")[1]);return(g,u)=>(p(),w(W,null,[x(De,{show:r.value,"onUpdate:show":u[0]||(u[0]=f=>r.value=f),title:"Settings"},{default:E(()=>[x(Vo)]),_:1},8,["show"]),n("div",{class:de(`main-toolbar ${t.compact?"compact-layout":"normal-layout shadow"}`),ref_key:"mainDiv",ref:i},[n("div",Yo,[t.returnHome?(p(),V(_e,{key:0,iconSrc:P(Jo),labelText:"Home",shortcut:"ctrl+h",onOnClick:u[1]||(u[1]=()=>{P(e).push("/")}),title:"home"},null,8,["iconSrc"])):(p(),V(_e,{key:1,iconSrc:P(Zo),labelText:"Logout",shortcut:"ctrl+q",onOnClick:a,title:"logout"},null,8,["iconSrc"])),x(_e,{iconSrc:P(Qo),labelText:"Settings",shortcut:"ctrl+c",onOnClick:u[2]||(u[2]=()=>{r.value=!0}),title:"Open settings"},null,8,["iconSrc"]),g.showNavigator?R("",!0):(p(),V(P(bt),{key:2,menuItems:[{name:"Home",action:()=>{P(e).push("/")}},{name:"Dashboard",action:()=>{P(e).push(`/dashboard/${P(j)().user.username}`)}},{name:"Arxiv daily",action:()=>{P(e).push("/feed")}},{name:"About",action:()=>{P(e).push("/about")}}]},{default:E(()=>[x(_e,{iconSrc:P(Go),labelText:"Explore",shortcut:"ctrl+e",title:"look around"},null,8,["iconSrc"])]),_:1},8,["menuItems"]))]),g.showNavigator?(p(),w("div",Xo,[n("div",ei,[n("div",{class:de(`button ${d.value==="home"||!d.value?"active-nav":""}`),onClick:u[3]||(u[3]=()=>{P(e).push("/")})},"Home",2),n("div",{class:de(`button ${d.value==="feed"?"active-nav":""}`),onClick:u[4]||(u[4]=()=>{P(e).push("/feed")})},"Feed",2),n("div",{class:de(`button ${d.value==="about"?"active-nav":""}`),onClick:u[5]||(u[5]=()=>{P(e).push("/about")})},"About",2)])])):R("",!0),fe(g.$slots,"default",{},void 0,!0)],2)],64))}}),Le=q(ti,[["__scopeId","data-v-55da3674"]]),ni="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M453-280h60v-166h167v-60H513v-174h-60v174H280v60h173v166Zm27.266%20200q-82.734%200-155.5-31.5t-127.266-86q-54.5-54.5-86-127.341Q80-397.681%2080-480.5q0-82.819%2031.5-155.659Q143-709%20197.5-763t127.341-85.5Q397.681-880%20480.5-880q82.819%200%20155.659%2031.5Q709-817%20763-763t85.5%20127Q880-563%20880-480.266q0%2082.734-31.5%20155.5T763-197.684q-54%2054.316-127%2086Q563-80%20480.266-80Zm.234-60Q622-140%20721-239.5t99-241Q820-622%20721.188-721%20622.375-820%20480-820q-141%200-240.5%2098.812Q140-622.375%20140-480q0%20141%2099.5%20240.5t241%2099.5Zm-.5-340Z'/%3e%3c/svg%3e",$t="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M480-160q-133%200-226.5-93.5T160-480q0-133%2093.5-226.5T480-800q85%200%20149%2034.5T740-671v-129h60v254H546v-60h168q-38-60-97-97t-137-37q-109%200-184.5%2075.5T220-480q0%20109%2075.5%20184.5T480-220q83%200%20152-47.5T728-393h62q-29%20105-115%20169t-195%2064Z'/%3e%3c/svg%3e",ai=L({__name:"Plot3d",props:{data:{}},setup(s,{expose:t}){const e=b(null),a=s,i=B(()=>a.data.map(m=>({x:m.x,y:m.y,z:m.z,mode:"markers",type:"scatter3d",hoverinfo:"text",hoverlabel:{bgcolor:"#181818",font:{color:"white"}},text:m.text,marker:{size:3.5,opacity:m.opacity,color:m.color}}))),o={autosize:!0,margin:{l:0,r:0,b:0,t:0},showlegend:!1,scene:{xaxis:{title:"",showticklabels:!1,tickfont:{size:10}},yaxis:{title:"",showticklabels:!1,tickfont:{size:10}},zaxis:{title:"",showticklabels:!1,tickfont:{size:10}}},paper_bgcolor:"#f6f6f6",plot_bgcolor:"#f6f6f6"},r={...o,paper_bgcolor:"#151515",plot_bgcolor:"#151515",font:{color:"white"}},l=b(Z.isDarkMode()?"dark":"light");Z.registerThemeChangeCallback(()=>{l.value=Z.isDarkMode()?"dark":"light",f()});const d=B(()=>l.value==="dark"?r:o),g={modeBarButtonsToRemove:["toImage","sendDataToCloud","resetCameraLastSave3d","resetCameraDefault3d"],displaylogo:!1,responsive:!0};let u=null;function f(){if(!e.value)return;He.react(e.value,i.value,d.value,g),e.value.layout.scene&&u&&He.relayout(e.value,"scene.camera",u)}return t({update:f}),me(()=>{He.newPlot(e.value,i.value,d.value,g).then(()=>{e.value.on("plotly_relayout",h=>{if(console.log("plotly_relayout",h),!h["scene.camera"])return;const _=h["scene.camera"];u=Ie(_)})}),e.value.on("plotly_click",function(h){h.points||console.log("Not clicking on any data.");const _=h.points[0].x,m=h.points[0].y,C=h.points[0].z,D=h.points[0].pointNumber;console.log(`You clicked on ${_}, ${m}, ${C} (point ${D})}`)}),te(i,()=>{f()})}),(h,_)=>(p(),w("div",{id:"ploty-chart",ref_key:"plotlyChart",ref:e},null,512))}}),si=q(ai,[["__scopeId","data-v-e21cc654"]]),oi={id:"main-filtervis"},ii={key:0,id:"plot3dDiv"},ri={key:0,id:"loadingDiv",class:"full"},li={key:1,class:"status"},ui=L({__name:"FilterVis",setup(s){const t=j(),e=b(null),a=F(),i=N(),o=b(null),r=B(()=>{if(o.value===null)return{};const h=t.database.allKeys(),_={};for(const m of h)o.value[m]&&(_[m]=o.value[m]);return _});async function l(h,_="rgb(100, 100, 200)"){const m=r.value;if(!m)h=[];else for(let k=h.length-1;k>=0;k--)m[h[k]]===void 0&&h.splice(k,1);const C=h.length,D=await t.database.agetMany(h),S=new Float32Array(C),c=new Float32Array(C),v=new Float32Array(C),$=new Array(C);for(const[k,I]of h.entries()){let K=m[I];if(K==null)throw new Error("uid not found in feats: "+I);S[k]=K[0],c[k]=K[1],v[k]=K[2];const oe=D[k];$[k]=`${oe.authorYear()}<br>${oe.summary.title}`}let y;if(typeof _=="string")y=_;else if(_ instanceof Array)if(typeof _[0]=="string")y=_;else{const k=_,I=Math.max(...k),K=Math.min(...k),oe={0:Z.isDarkMode()?[50,50,50]:[220,220,220],1:[50,200,150]};y=k.map(we=>{const ge=(we-K)/(I-K),ce=Array(3);for(let be=0;be<3;be++)ce[be]=Math.round(oe[0][be]*(1-ge)+oe[1][be]*ge);return`rgb(${ce[0]}, ${ce[1]}, ${ce[2]})`})}else throw new Error("Invalid color type");return{x:S,y:c,z:v,opacity:.75,color:y,text:$}}const d=b(null);async function g(){const h=a.shownDataScores;let _;h?_=await l(Ie(a.shownDataUIDs),h):_=await l(Ie(a.shownDataUIDs));const C=t.database.allKeys().filter(c=>a.shownDataUIDs.indexOf(c)==-1),D=await l(C,Z.isDarkMode()?"rgb(50, 50, 50)":"rgb(220, 220, 220)"),S=await l(Ie(a.unfoldedDataUIDs),"rgb(255, 0, 0)");d.value=[_,D,S]}const u=B(()=>Object.keys(r.value).length>0);async function f(){o.value=null;const h=J().conn,_=(await h.status()).n_data;let m;_<50?m=-1:_<100?m=5:_<300?m=8:_<500?m=12:m=15,console.log("dataset size: ",_,"perp: ",m),o.value=await h.reqDatabaseFeatureTSNE("doc_feature",3,m)}return te(()=>[a.shownDataUIDs,a.unfoldedDataUIDs],()=>{g()}),te(()=>i.show3DScatterPlot,h=>{h&&f().then(()=>{g()})}),me(()=>{i.show3DScatterPlot&&f().then(()=>{g()})}),(h,_)=>(p(),w("div",oi,[P(i).show3DScatterPlot?(p(),w("div",ii,[x(si,{data:d.value?d.value:[],ref_key:"plot3DRef",ref:e},null,8,["data"]),!u.value||!r.value?(p(),w("div",ri,[o.value===null?(p(),V(Oe,{key:0})):(p(),w("p",li,"Data not ready"))])):R("",!0)])):R("",!0)]))}}),ci=q(ui,[["__scopeId","data-v-b8368217"]]),di={id:"searchbar"},hi={id:"searchbar-container"},pi=["value"],fi=L({__name:"Searchbar",setup(s){const t=F(),e=["title","author","year","note","publication","feature","uuid"],a=b(""),i=b(null);function o(){const d={searchBy:i.value.value,content:a.value};t.searchState=d,console.log(d),t.updateShownData()}const r=vt(o,300);function l(d){return d.charAt(0).toUpperCase()+d.slice(1)}return(d,g)=>(p(),w("div",di,[n("div",hi,[n("select",{ref_key:"searchSelector",ref:i,name:"search_type",id:"searchType",onChange:o},[(p(),w(W,null,Q(e,u=>n("option",{value:u},T(l(u)),9,pi)),64))],544),H(n("input",{type:"text",id:"searchbar-input",placeholder:"Search","onUpdate:modelValue":g[0]||(g[0]=u=>a.value=u),onInput:g[1]||(g[1]=(...u)=>P(r)&&P(r)(...u))},null,544),[[G,a.value]])])]))}}),mi=q(fi,[["__scopeId","data-v-758a2cfb"]]),vi=s=>(ne("data-v-3c78df46"),s=s(),ae(),s),gi={id:"main-home",class:"gradIn"},_i={class:"horizontal fullHeight"},yi={key:0,id:"left-panel"},wi={id:"right-panel",class:"panel1"},bi={class:"fullWidth"},ki={style:{display:"flex","justify-content":"space-between"}},$i={style:{"flex-grow":"1"}},Si={style:{display:"flex","flex-grow":"0","margin-right":"5px","margin-block":"5px"}},xi={key:1,id:"blankPlaceholder"},Ci={key:0,style:{"font-size":"xx-large","font-weight":"bold","user-select":"none"}},Di=vi(()=>n("br",null,null,-1)),Pi={name:"Home",inheritAttrs:!1,customOptions:{}},Ii=L({...Pi,setup(s){const t=F(),e=j(),a=N();window.innerWidth<768&&a.setShowTagPanel(!1);const o=ye().currentRoute.value.query.tags;o!=null&&(t.tagStatus.checked=new O(o.split("&&")),t.tagStatus.unfolded=t.tagStatus.checked.allParents());const r=b(null);function l(){r.value.show({datapoint:null})}function d(u){var h;u.preventDefault();const f=(h=u.dataTransfer)==null?void 0:h.files;f&&(l(),r.value.loadFiles(f)||r.value.close())}function g(){t.reloadDatabase(),J().wsConn.resetReconnect()}return(u,f)=>(p(),w(W,null,[x(Xe,{ref_key:"dataEditor",ref:r},null,512),x(Le,{"return-home":!1,compact:!0}),n("div",gi,[n("div",_i,[x(Te,{name:"left-in"},{default:E(()=>[P(a).showTagPanel?(p(),w("div",yi,[x(Rn,{onOnCheck:f[0]||(f[0]=()=>P(t).updateShownData())})])):R("",!0)]),_:1}),n("div",wi,[n("div",bi,[x(ci)]),n("div",{class:"scrollable",id:"fileSelector",onDragover:f[2]||(f[2]=h=>h.preventDefault()),onDrop:d},[n("div",ki,[n("div",$i,[x(mi)]),n("div",Si,[x(_e,{iconSrc:P(ni),labelText:"New",title:"Add new data to database",onClick:l,shortcut:"ctrl+n"},null,8,["iconSrc"]),x(_e,{iconSrc:P($t),labelText:"Reload",title:"Reload database",onClick:g},null,8,["iconSrc"])])]),P(t).shownDataUIDs.length>0?(p(),V(Ue,{key:0,uids:P(t).shownDataUIDs,unfoldedIds:P(t).unfoldedDataUIDs,"onUpdate:unfoldedIds":f[1]||(f[1]=h=>P(t).unfoldedDataUIDs=h)},null,8,["uids","unfoldedIds"])):(p(),w("div",xi,[P(e).database.initialized?(p(),w("p",Ci,[A(" Nothing to show "),n("p",{style:{"font-size":"medium"}},[A(" Add your first enty by clicking the "),n("b",null,[n("a",{onClick:l,style:{cursor:"pointer","border-radius":"5px","padding-inline":"3px","background-color":"var(--color-background-soft)"}},"⊕ New")]),A(" button above."),Di])])):(p(),V(Oe,{key:1}))]))],32)])])])],64))}}),Ti=q(Ii,[["__scopeId","data-v-3c78df46"]]);function Ui(s,t=!1){t&&(s*=1e3);const e=new Date(s);let a=e.getFullYear().toString();a.length!==4&&(a="0".repeat(4-a.length)+a);let i=(e.getMonth()+1).toString();i.length===1&&(i="0"+i);let o=e.getDate().toString();o.length===1&&(o="0"+o);let r=`${a}-${i}-${o} `;const l={hourCycle:"h23",hour:"2-digit",minute:"2-digit",second:"2-digit"};return r+=e.toLocaleTimeString([],l),r}const Bi=s=>(ne("data-v-7fd532ee"),s=s(),ae(),s),Mi={id:"authorPapers"},Li={id:"feed-main",class:"slideInFast"},Ai={class:"articleBlock"},Ri={class:"titleBlock"},Ei={style:{"font-weight":"bold"}},qi={style:{display:"flex","flex-direction":"row","justify-content":"center","align-items":"center"}},Oi={class:"titleId"},Fi={class:"authors"},zi={class:"authorSpan"},Hi=["href"];const Ni=["onClick"],Wi={key:3},ji={class:"actions"},Ki=["href"],Vi=["href"],Zi=Bi(()=>n("summary",null,"Abstract",-1)),Gi={id:"relatedArticles"},Ji=L({__name:"ArticleBlock",props:{article:{}},setup(s){const t=s,e=j(),a=J().conn,i=b(null);async function o(){var D;(D=i.value)==null||D.show({datapoint:null,bibtex:t.article.bibtex,tags:[],url:t.article.url})}const r=b({});async function l(){for(let D=0;D<t.article.authors.length;D++){const S=t.article.authors[D],c=t.article.authors_other_publications[D],v=await e.database.agetMany(c);r.value[S]=v}}l();const d=B(()=>{const D={};for(const S in r.value)r.value[S]?D[S]=r.value[S].length:D[S]=null;return D}),g=b(!1),u=b([]);function f(D){u.value=r.value[D],u.value||(u.value=[]),g.value=!0}const h=b([]),_=b([]),m=B(()=>{const D={};for(let S=0;S<h.value.length;S++)D[h.value[S].summary.uuid]=_.value[S].toPrecision(4);return D});function C(){h.value.length>0||a.filter({searchBy:"feature",searchContent:t.article.abstract,maxResults:10}).then(D=>{const S=D.scores,c=D.uids,v=_t(c,S);e.database.agetMany(v[0],!1).then($=>{h.value=$;const y=[];for(const k of $){const I=c.indexOf(k.summary.uuid);I>=0&&y.push(S[I])}_.value=y})})}return(D,S)=>(p(),w(W,null,[x(Xe,{ref_key:"dataEditor",ref:i},null,512),x(De,{show:g.value,"onUpdate:show":S[0]||(S[0]=c=>g.value=c),title:"Publications in the database",onOnClose:S[1]||(S[1]=c=>u.value=[])},{default:E(()=>[n("div",Mi,[x(Ue,{uids:u.value.map(c=>c.summary.uuid)},null,8,["uids"])])]),_:1},8,["show"]),n("div",Li,[n("div",Ai,[n("div",Ri,[n("h2",Ei,T(t.article.title),1),n("div",qi,[x(Ge,{tags:t.article.tags},null,8,["tags"]),n("label",Oi,T(t.article.uuid),1)])]),n("div",Fi,[(p(!0),w(W,null,Q(t.article.authors,(c,v)=>(p(),w("span",zi,[(p(),w("a",{key:0,class:"link",href:`https://arxiv.org/search/?query=${c}&searchtype=author`,target:"_blank"},T(c),9,Hi)),d.value[c]?(p(),w("a",{key:2,class:"pubCount",onClick:()=>f(c)},T(`(${d.value[c]})`),9,Ni)):R("",!0),v<t.article.authors.length-1?(p(),w("span",Wi,", ")):R("",!0)]))),256))]),n("div",ji,[n("a",{href:D.article.url,target:"_blank"},"Link",8,Ki),A(" | "),n("a",{href:`https://arxiv.org/pdf/${D.article.uuid}.pdf`,target:"_blank"},"PDF",8,Vi),A(" | "),n("a",{onClick:o},"Collect")]),n("p",null,"Added: "+T(P(Ui)(t.article.time_added,!0)),1),n("details",null,[Zi,n("p",null,T(t.article.abstract),1)]),n("details",null,[n("summary",{onClick:C},"Related articles"),n("div",Gi,[x(Ue,{uids:h.value.map(c=>c.summary.uuid),scores:m.value},null,8,["uids","scores"])])])])])],64))}}),Qi=q(Ji,[["__scopeId","data-v-7fd532ee"]]),St=s=>(ne("data-v-5b486ca2"),s=s(),ae(),s),Yi={id:"toolbar"},Xi={id:"main"},er={style:{"margin-block":"1rem"}},tr=["src"],nr={id:"settings"},ar={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",gap:"0.5rem","flex-flow":"row wrap"}},sr=["value"],or=["value"],ir={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",gap:"0.5rem"}},rr={key:0,id:"loadingPlaceholder"},lr=St(()=>n("b",null,"Fetching...",-1)),ur={key:1,id:"loadingPlaceholder"},cr=St(()=>n("b",null,"No articles found",-1)),dr=[cr],hr=L({__name:"Feed",setup(s){const t=J().conn,e=ye();function a(v=0){const $=new Date;return $.setDate($.getDate()+v),$.toISOString().split("T")[0]}const i=b("arxiv"),o=b(!1),r=b(["arxiv"]),l=b(a(1)),d=b(a(-1)),g=b(parseInt(e.currentRoute.value.query.maxResults)||100),u=b(""),f=b(null),h=b([]),_=B(function(){return[...h.value].sort(($,y)=>{if(f.value===null||!$.feature||!y.feature)return 0;{const k=new Float32Array($.feature),I=new Float32Array(y.feature),K=f.value,oe=k.reduce((we,ge,ce)=>we+(ge-K[ce])**2,0),re=I.reduce((we,ge,ce)=>we+(ge-K[ce])**2,0);return oe-re}})});function m(){if(u.value.trim()===""){f.value=null;return}t.featurizeText(u.value).then(v=>{f.value=new Float32Array(v)},()=>{console.log("failed to featurize")})}const C=vt(m,100);g.value>200&&(window.alert("maxResults cannot be larger than 200"),g.value=200);let D=e.currentRoute.value.query.search||"";D!==""&&(u.value=D);const S=b(null);async function c(){h.value=[];const v=J().conn;r.value=["arxiv"].concat(await v.reqFeedCategories()),o.value=!0;const $=new Date(l.value).getTime()/1e3,y=new Date(d.value).getTime()/1e3;try{const k=await v.reqFeedList({maxResults:g.value,category:i.value,timeBefore:$,timeAfter:y});h.value=k,m()}finally{o.value=!1}}return me(()=>{c().then(()=>S.value.classList.remove("spin"),()=>{S.value.classList.remove("spin"),window.alert("Failed to fetch articles")})}),(v,$)=>(p(),w(W,null,[n("div",Yi,[x(Le,{ref:"toolbar"},null,512)]),n("div",Xi,[n("h1",er,[A(" Daily Feed "),n("img",{ref_key:"refreshButton",ref:S,src:P($t),alt:"",class:"icon spin",title:"refresh the page",onClick:$[0]||($[0]=y=>{const k=y.target;k.classList.contains("spin")||(k.classList.add("spin"),c().then(()=>k.classList.remove("spin")))})},null,8,tr)]),n("div",nr,[n("div",ar,[n("span",null,[A(" Category: "),H(n("select",{name:"category",id:"category-select","onUpdate:modelValue":$[1]||($[1]=y=>i.value=y),onChange:c},[(p(!0),w(W,null,Q(r.value,y=>(p(),w("option",{value:y},T(y),9,sr))),256))],544),[[Re,i.value]])]),n("span",null,[A(" Max results: "),H(n("select",{"onUpdate:modelValue":$[2]||($[2]=y=>g.value=y),onChange:c},[(p(),w(W,null,Q([20,50,100,200,500],y=>n("option",{value:y},T(y),9,or)),64))],544),[[Re,g.value]])]),n("span",null,[A(" From: "),H(n("input",{type:"date","onUpdate:modelValue":$[3]||($[3]=y=>d.value=y),onChange:c},null,544),[[G,d.value]])]),n("span",null,[A(" To: "),H(n("input",{type:"date","onUpdate:modelValue":$[4]||($[4]=y=>l.value=y),onChange:c},null,544),[[G,l.value]])])]),n("div",ir,[H(n("input",{type:"text",placeholder:"Search",onInput:$[5]||($[5]=(...y)=>P(C)&&P(C)(...y)),"onUpdate:modelValue":$[6]||($[6]=y=>u.value=y),autocomplete:"off"},null,544),[[G,u.value]])])]),_.value.length===0&&o.value?(p(),w("div",rr,[lr,x(Oe)])):R("",!0),_.value.length===0&&!o.value?(p(),w("div",ur,dr)):R("",!0),(p(!0),w(W,null,Q(_.value,y=>(p(),V(Qi,{article:y},null,8,["article"]))),256))])],64))}}),pr=q(hr,[["__scopeId","data-v-5b486ca2"]]),xt=s=>(ne("data-v-dbb25d40"),s=s(),ae(),s),fr={class:"main"},mr={id:"login",class:"slideIn"},vr={class:"loginLine"},gr={class:"loginLine"},_r=["type"],yr=xt(()=>n("summary",null,"Settings",-1)),wr={id:"settings"},br=xt(()=>n("label",{for:"backendHostInput"},"Backend: ",-1)),kr={class:"options"},$r={key:0,class:"error"},Sr=L({__name:"LoginInput",setup(s){const t=b(""),e=b(""),a=b(""),i=b(!0),o=b(!1),r=B(()=>o.value?"text":"password"),l=b("Login"),d=ye(),g=b(""),u=b("");d.isReady().then(()=>{At(()=>{g.value=N().backendHost,u.value=N().backendPort})});function f(){N().setBackendHost(g.value),N().setBackendPort(u.value),l.value="Connecting...";const h=ln(t.value,e.value);J().conn.authUsr(h).then(m=>{Ze(h,m,i.value),a.value="";const C=d.currentRoute.value.query.from;C?(console.log("Redirecting to",C),d.push(C)):d.push("/"),l.value="Login"},m=>{a.value=m,l.value="Login"})}return(h,_)=>(p(),w("div",fr,[n("div",mr,[n("form",null,[n("div",vr,[H(n("input",{class:"key-input",type:"text",id:"username-input","onUpdate:modelValue":_[0]||(_[0]=m=>t.value=m),placeholder:"Username",autocomplete:"off"},null,512),[[G,t.value]])]),n("div",gr,[H(n("input",{class:"key-input",type:r.value,id:"password-input","onUpdate:modelValue":_[1]||(_[1]=m=>e.value=m),placeholder:"Password"},null,8,_r),[[Rt,e.value]])]),n("details",null,[yr,n("div",wr,[br,H(n("input",{type:"text",id:"backendHostInput","onUpdate:modelValue":_[2]||(_[2]=m=>g.value=m)},null,512),[[G,g.value]]),A(" : "),H(n("input",{type:"text",id:"port","onUpdate:modelValue":_[3]||(_[3]=m=>u.value=m)},null,512),[[G,u.value]]),n("div",kr,[x(ke,{checked:i.value,onOnCheck:_[4]||(_[4]=()=>{i.value=!i.value})},{default:E(()=>[A("Stay login")]),_:1},8,["checked"]),x(ke,{checked:o.value,onOnCheck:_[5]||(_[5]=()=>{o.value=!o.value})},{default:E(()=>[A("Show key")]),_:1},8,["checked"])])])]),n("button",{type:"submit",onClick:Et(f,["prevent"])},T(l.value),1)]),a.value?(p(),w("p",$r,T(a.value),1)):R("",!0)])]))}}),xr=q(Sr,[["__scopeId","data-v-dbb25d40"]]),Cr={id:"main"},Dr={id:"container"},Pr={for:"login",id:"info"},Ir=["href"],Tr=L({__name:"Login",setup(s){Z.setDefaultDarkMode();function t(){alert(`Not implemented yet. 
Please contact the maintainer for registration.`)}return(e,a)=>(p(),w("div",Cr,[n("div",Dr,[x(xr),n("label",Pr,[A(" Need assistant? - "),n("a",{onClick:t},"Register"),A(" | "),n("a",{href:`mailto:${P(oo).email}`},"Contact me",8,Ir)])])]))}}),Ur=q(Tr,[["__scopeId","data-v-a2e2514f"]]);class Br{constructor(t){Y(this,"router");this.router=t}getURLParams(){const t={},e=this.router.currentRoute.value.query;for(const a in e)t[a]=e[a];return t}setURLParam(t,e){const a=this.getURLParams();a[t]=e,this.router.push({query:a})}updateURLWithParam(t,e){const a=this.getURLParams();return a[t]=e,this.router.resolve({query:a}).href}}function Mr(s,{router:t=null,datapoint:e=null}){const a=t?new Br(t):null;if(e){const i=j().user;s=s.replace(new RegExp("./misc/","g"),`${Be()}/misc/${e.summary.uuid}?_u=${i.id}&&fname=`),a&&(window.location.href.includes("/reader/")?s=s.replace(new RegExp("\\$\\{doc\\}#","g"),a.updateURLWithParam("docHashMark","")):s=s.replace(new RegExp("\\$\\{doc\\}#","g"),`${e.getOpenDocURL()}#`))}return s}const Lr={id:"noteEditor"},Ar={key:2,id:"save-hint"},Rr={id:"btn-container"},Er=["id"],qr={key:0,id:"misc-container",class:"hover-scrollable"},Or={key:0,style:{"font-weight":"bold",color:"var(--color-text-soft)",top:"0.5rem"}},Fr=["href"],zr={key:0,style:{color:"var(--color-text-soft)"}},Hr={class:"misc-file-op-container"},Nr=["onClick"],Wr=["onClick"],jr=["onClick"],Kr=L({__name:"NoteEditor",props:{datapoint:{},theme:{default:"light"}},setup(s,{expose:t}){const e=s,a=ye(),i=b(""),o=B(()=>Mr(i.value,{router:a,datapoint:e.datapoint})),r=b(null),l=F(),d=b([]),g=b(""),u=B(()=>g.value===i.value?"":"Unsaved");async function f(){if(e.datapoint.isDummy())return;const y=await e.datapoint.fetchNote();g.value=y,i.value=y,y.trim().length>0&&(c.value=!0)}async function h(){d.value=await e.datapoint.listMiscFiles()}async function _(){e.datapoint.isDummy()||await Promise.all([f(),h()])}_(),te(()=>e.datapoint,()=>{_(),console.log("datapoint changed, fetching note and misc files...")});async function m(){await e.datapoint.uploadNote(i.value),g.value=i.value}const C=async y=>{await e.datapoint.deleteMiscFile(y),d.value=d.value.filter(k=>k.fname!==y),F().showPopup("File deleted","info")},D=async(y,k)=>{if(y.split(".").pop()!==k.split(".").pop()){F().showPopup("File extension must be the same","error");return}await e.datapoint.renameMiscFile(y,k),i.value=i.value.replace(y,k),h(),F().showPopup("File renamed","info")},S=async y=>{(await e.datapoint.uploadMisc(y)).map(I=>r.value.insert(()=>({targetValue:`![image](${I})`,select:!1,deviationStart:0,deviationEnd:0}))),m(),h()},c=b(!1);function v(y){return i.value.indexOf(y)>=0}function $(y){const k=window.prompt(y);if(!k)throw new Error("User cancelled");return k}return t({preview:c,fetchNote:f}),Yt("update_note",y=>{if(y.session_id===J().wsConn.sessionID)return;y.datapoint_summary.uuid===e.datapoint.uid&&_().then(()=>{F().showPopup("update from other clients","info")})}),(y,k)=>(p(),w("div",Lr,[n("div",{class:"editor",onDblclick:k[1]||(k[1]=I=>c.value=!1)},[c.value?(p(),V(P(jt),{key:1,"model-value":o.value,theme:y.theme,"preview-theme":"vuepress"},null,8,["model-value","theme"])):(p(),V(P(Wt),{key:0,ref_key:"mdEditor",ref:r,modelValue:i.value,"onUpdate:modelValue":k[0]||(k[0]=I=>i.value=I),preview:!1,language:"en-US",theme:y.theme,onOnSave:m,onOnUploadImg:S,toolbars:["bold","underline","italic","-","strikeThrough","title","quote","unorderedList","orderedList","task","-","link","-","revoke","next","save","=","catalog"]},null,8,["modelValue","theme"])),!c.value&&u.value?(p(),w("div",Ar,T(u.value),1)):R("",!0)],32),n("div",Rr,[n("button",{onClick:k[2]||(k[2]=I=>c.value=!c.value)},T(c.value?"Edit":"Preview"),1),x(P(Se),{action:I=>{e.datapoint.uploadMisc([I]).then(K=>{P(F)().showPopup("File uploaded","success"),h(),r.value.insert(()=>({targetValue:`[${I.name}](${K[0]})`,select:!1,deviationStart:0,deviationEnd:0}))})}},null,8,["action"])]),n("div",{id:"misc-toggle",onClick:k[3]||(k[3]=()=>{P(l).showMiscPanel=!P(l).showMiscPanel})},[n("div",{id:P(l).showMiscPanel?"triangle-down":"triangle"},null,8,Er)]),P(l).showMiscPanel?(p(),w("div",qr,[d.value.length===0?(p(),w("div",Or," No attached files. ")):R("",!0),(p(!0),w(W,null,Q(d.value,I=>(p(),w("div",{key:I.fname,class:"misc-file"},[n("div",null,[n("a",{href:I.url,target:"_blank"},T(I.fname),9,Fr),v(I.fname)?R("",!0):(p(),w("label",zr," (no-ref) "))]),n("div",Hr,[n("a",{style:{color:"var(--color-text-soft)",cursor:"pointer"},onClick:K=>{P(Ve)(I.fname),P(F)().showPopup("Copied")}}," copy ",8,Nr),n("a",{style:{color:"var(--color-text-soft)",cursor:"pointer"},onClick:K=>D(I.fname,$("New name"))}," rename ",8,Wr),v(I.fname)?R("",!0):(p(),w("a",{key:0,style:{color:"var(--color-danger)",cursor:"pointer"},onClick:K=>C(I.fname)}," delete ",8,jr))])]))),128))])):R("",!0)]))}}),Vr=q(Kr,[["__scopeId","data-v-68fe428a"]]),Zr=s=>(ne("data-v-42acbd7b"),s=s(),ae(),s),Gr={id:"body"},Jr=["src"],Qr=Zr(()=>n("div",{style:{color:"var(--color-text-soft)","font-weight":"bold","font-size":"large"}},"No file, drag and drop to  ",-1)),Yr=L({__name:"ReaderBody",props:{datapoint:{},layoutType:{}},setup(s,{expose:t}){const e=s,a=ye(),i=B(()=>{const $=a.currentRoute.value.query.docHashMark;return $||""}),o=b(null),r=b(null),l=b(null),d=b(!1),g=b(null);t({noteEditor:g});function u(v){l.value&&l.value.contains(v.target)&&(d.value=!0)}function f(){d.value=!1}const h=B({get:()=>F().preferredReaderLeftPanelWidthPerc,set:v=>{F().preferredReaderLeftPanelWidthPerc=v}});function _(v){if(d.value&&o.value&&r.value&&l.value){const y=("touches"in v?v.touches[0].clientX:v.clientX)-o.value.getBoundingClientRect().left;o.value.style.width=`${y}px`,r.value.style.width=`calc(100% - ${y}px)`,h.value=y/(y+r.value.getBoundingClientRect().width),h.value=Math.max(.1,Math.min(.9,h.value))}}window.addEventListener("mousedown",u),window.addEventListener("touchstart",u),window.addEventListener("mouseup",f),window.addEventListener("touchend",f),window.addEventListener("mousemove",_),window.addEventListener("touchmove",_);const m=B(()=>e.layoutType==0||e.layoutType==2),C=B(()=>e.layoutType==1||e.layoutType==2);function D(v){v==2&&(o.value.style.width=`${h.value*100}%`,r.value.style.width=`${(1-h.value)*100}%`),N().setReaderLayoutType(v)}te(()=>e.layoutType,(v,$)=>{console.log("layoutType changed:",$,"->",v),D(v)});const S=b(Z.isDarkMode()?"dark":"light");Z.registerThemeChangeCallback(()=>S.value=Z.isDarkMode()?"dark":"light");const c=B(()=>`${e.datapoint.getOpenDocURL({extraPDFViewerParams:{"color-mode":S.value},urlHashMark:i.value})}`);return me(()=>{D(e.layoutType)}),(v,$)=>(p(),w("div",Gr,[H(n("div",{class:"pane",id:"left-pane",ref_key:"leftPane",ref:o},[v.datapoint.summary.has_file?(p(),w("iframe",{key:0,src:c.value,title:"doc",frameborder:"0",style:X({"pointer-events":d.value?"none":"auto"})},null,12,Jr)):(p(),w("div",{key:1,style:{display:"flex","justify-content":"center","align-items":"center",height:"100%",width:"100%"},onDragover:$[0]||($[0]=y=>y.preventDefault()),onDrop:$[1]||($[1]=y=>{var I;y.preventDefault();const k=(I=y.dataTransfer)==null?void 0:I.files;k&&k.length==1&&v.datapoint.uploadDocument(k[0]).then(()=>{P(F)().showPopup("File uploaded")})})},[Qr,x(P(Se),{action:y=>v.datapoint.uploadDocument(y),text:"upload","as-link":!0,style:{"font-weight":"bold","font-size":"large",cursor:"pointer"}},null,8,["action"])],32))],512),[[je,m.value]]),v.layoutType==2?(p(),w("div",{key:0,id:"splitter",ref_key:"splitter",ref:l,onMousedown:u,onTouchstart:u},null,544)):R("",!0),H(n("div",{class:"pane",id:"right-pane",ref_key:"rightPane",ref:r},[x(Vr,{datapoint:v.datapoint,theme:S.value,ref_key:"noteEditor",ref:g},null,8,["datapoint","theme"])],512),[[je,C.value]])]))}}),Xr=q(Yr,[["__scopeId","data-v-42acbd7b"]]),el="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M180-120q-24%200-42-18t-18-42v-600q0-24%2018-42t42-18h210q24%200%2042%2018t18%2042v600q0%2024-18%2042t-42%2018H180Zm390%200q-24%200-42-18t-18-42v-600q0-24%2018-42t42-18h210q24%200%2042%2018t18%2042v600q0%2024-18%2042t-42%2018H570Zm210-660H570v600h210v-600ZM570-180h210-210Z'/%3e%3c/svg%3e",tl="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M220-160q-24%200-42-18t-18-42v-143h60v143h520v-143h60v143q0%2024-18%2042t-42%2018H220Zm230-153v-371L330-564l-43-43%20193-193%20193%20193-43%2043-120-120v371h-60Z'/%3e%3c/svg%3e",nl={id:"toolbarOps"},al={id:"recently-read"},sl={id:"main-reader",class:"gradIn"},ol={name:"Reader",inheritAttrs:!1,customOptions:{}},il=L({...ol,setup(s){const t=j(),e=F(),a=ft(),i=ye(),o=b(t.database.getDummy());async function r(){const m=await t.database.aget(a.params.id);m&&(o.value=m),e.addRecentlyReadDataUID(m.uid),t.database.agetMany(e.recentlyReadDataUIDs).then(C=>{d(C)}),console.log("Reader: updated datapoint",m.summary.title,"uid",m.uid)}te(()=>a.params.id,()=>{r()});const l=b([]);function d(m){const C=[];for(const D of m)D.summary.uuid!==a.params.id&&C.push({name:D.authorYear(),action:()=>{i.push("/reader/"+D.summary.uuid)}});console.log("Reader: updated recent read menu items",C),l.value=C}const g=b(N().readerLayoutType);window.innerWidth<800&&(g.value=0);function u(){if(window.innerWidth<800)g.value=(g.value+1)%2;else switch(g.value){case 0:g.value=2;break;case 1:g.value=2;break;case 2:g.value=0;break}}const f=b(null);function h(m){function C(){o.value.uploadDocument(m).then(D=>{o.value.update(D),e.showPopup("Document uploaded","success")},()=>e.showPopup("Failed to upload document","error"))}o.value.summary.has_file?o.value.freeDocument().then(D=>{o.value.update(D),C()},()=>e.showPopup("Failed to free document","error")):C()}const _=b(null);return me(()=>{console.log("Reader mounted"),r()}),(m,C)=>(p(),w(W,null,[x(P(Se),{action:h,ref_key:"fileSelectionBtn",ref:f,style:{display:"none"}},null,512),x(Le,{compact:!0,"show-navigator":!1},{default:E(()=>[n("div",nl,[x(_e,{iconSrc:P(el),labelText:"layout",shortcut:"ctrl+r",onOnClick:u,title:"change layout"},null,8,["iconSrc"]),x(_e,{iconSrc:P(tl),labelText:"replace",shortcut:"ctrl+u",onOnClick:C[0]||(C[0]=()=>f.value.click()),title:"upload a new document"},null,8,["iconSrc"]),x(P(bt),{"menu-items":l.value},{default:E(()=>[n("div",al,T(`${o.value.authorAbbr()} (${o.value.summary.year})`),1)]),_:1},8,["menu-items"])])]),_:1}),n("div",sl,[x(Xr,{datapoint:o.value,layoutType:g.value,ref_key:"readerBody",ref:_},null,8,["datapoint","layoutType"])])],64))}}),rl=q(il,[["__scopeId","data-v-65a770f6"]]),ll="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M160-400v-80h280v80H160Zm0-160v-80h440v80H160Zm0-160v-80h440v80H160Zm360%20560v-123l221-220q9-9%2020-13t22-4q12%200%2023%204.5t20%2013.5l37%2037q8%209%2012.5%2020t4.5%2022q0%2011-4%2022.5T863-380L643-160H520Zm300-263-37-37%2037%2037ZM580-220h38l121-122-18-19-19-18-122%20121v38Zm141-141-19-18%2037%2037-18-19Z'/%3e%3c/svg%3e",ee=s=>(ne("data-v-a87fab58"),s=s(),ae(),s),ul={id:"users-widget-main"},cl={id:"user-editor-main"},dl={class:"horizontal"},hl=["src"],pl={id:"user-editor"},fl={class:"horizontal"},ml={class:"horizonal",style:{display:"flex","align-items":"center",gap:"0.5rem"}},vl=ee(()=>n("b",null,"Administrator ",-1)),gl={class:"full-width left-align"},_l=ee(()=>n("b",null,"Max Storage (MB):",-1)),yl=ee(()=>n("br",null,null,-1)),wl={key:0,class:"full-width left-align"},bl=ee(()=>n("b",null,"Mandatory Tags:",-1)),kl={id:"mandatory-tag-edit"},$l={id:"delete-user-dialog-main"},Sl=ee(()=>n("p",{style:{color:"var(--color-danger)"}}," All data under this user will be deleted! ",-1)),xl=ee(()=>n("hr",{style:{"margin-block":"1rem"}},null,-1)),Cl={id:"create-user-main"},Dl={id:"create-user-table"},Pl=ee(()=>n("td",null,"Username:",-1)),Il=ee(()=>n("td",null,"Name:",-1)),Tl=ee(()=>n("td",null,"Password:",-1)),Ul=ee(()=>n("td",null,"Max Storage (MB):",-1)),Bl=ee(()=>n("td",null,"Mandatory Tags:",-1)),Ml=ee(()=>n("td",null,"Administrator:",-1)),Ll={style:{display:"flex","align-items":"center","padding-block":"0.25rem"}},Al={id:"user-widget-header"},Rl=ee(()=>n("div",null,[n("b",null," Users ")],-1)),El={key:0},ql=ee(()=>n("th",null," Avatar ",-1)),Ol=ee(()=>n("th",null," Username ",-1)),Fl=ee(()=>n("th",null," Name ",-1)),zl=ee(()=>n("th",null," Storage ",-1)),Hl=ee(()=>n("th",null," Accessibility ",-1)),Nl={class:"user-line"},Wl={key:0},jl=["onClick"],Kl=["src"],Vl={class:"center full-width full-height"},Zl=["src"],Gl={class:"username"},Jl={style:{"text-align":"right"}},Ql={key:1,class:"admin_hint"},Yl={key:0,colspan:"5"},Xl=L({__name:"UsersWidget",setup(s){const t=b([]),e=B(()=>j().user.is_admin),a=J().conn,i=b(!1),o=b({});function r(y){if(!e.value)return;const k=JSON.parse(JSON.stringify(y));o.value=k,o.value.max_storage/=1024*1024,i.value=!0}function l(y){const k=y.split(";").map(I=>I.trim());k.length===1&&k[0]===""?o.value.mandatory_tags=[]:o.value.mandatory_tags=k}function d(){console.log(o.value),a.updateUserAccess(o.value.username,o.value.is_admin,o.value.mandatory_tags,o.value.max_storage*1024*1024).then(y=>{i.value=!1},y=>{console.log(y),F().showPopup(y,"error")})}const g=b(!1),u=b("");function f(){if(u.value!==o.value.username){F().showPopup("Wrong input","error");return}a.deleteUser(o.value.username).then(y=>{F().showPopup(`User ${o.value.username} deleted`,"info"),g.value=!1,i.value=!1},y=>{console.log(y),F().showPopup(y,"error")})}const h=b(!1),_=b(""),m=b(Ae[Math.floor(Math.random()*Ae.length)]),C=b(""),D=b(!1),S=b(""),c=b(100);function v(){h.value=!1,_.value="",m.value=Ae[Math.floor(Math.random()*Ae.length)],C.value="",D.value=!1,S.value=""}function $(){if(_.value===""){F().showPopup("Please enter the username","error");return}const y=S.value.split(";").map(k=>k.trim());y.length===1&&y[0]===""&&y.splice(0,1),a.createUser(_.value,m.value,C.value,D.value,y,c.value).then(k=>{F().showPopup(`User ${_.value} created`,"success"),v()},k=>{console.log(k),F().showPopup(k,"error")})}return me(()=>{a.reqUserList().then(y=>{t.value=y},y=>{console.log(y)})}),ie("add_user",y=>{const k=y.user_info;t.value.push(k)}),ie("update_user",y=>{const k=y.user_info;t.value.map((I,K)=>{I.id===k.id&&(t.value[K]=k)})}),ie("delete_user",y=>{const k=y.username;t.value=t.value.filter(I=>I.username!==k)}),(y,k)=>(p(),w("div",ul,[x($e,{show:i.value,"onUpdate:show":k[4]||(k[4]=I=>i.value=I),title:"editor",onOnAccept:d,onOnCancel:k[5]||(k[5]=()=>i.value=!1)},{default:E(()=>[n("div",cl,[n("div",dl,[n("img",{src:`${P(Be)()}/user-avatar/${o.value.username}?size=128`,alt:"",class:"avatar-big"},null,8,hl),n("div",pl,[n("div",fl,[n("h2",null,T(o.value.name),1),A(" ("+T(o.value.username)+") ",1)]),n("div",ml,[vl,x(Me,{checked:o.value.is_admin,"onUpdate:checked":k[0]||(k[0]=I=>o.value.is_admin=I)},null,8,["checked"])]),n("div",gl,[_l,yl,H(n("input",{type:"number","onUpdate:modelValue":k[1]||(k[1]=I=>o.value.max_storage=I)},null,512),[[G,o.value.max_storage]])]),o.value.is_admin?R("",!0):(p(),w("div",wl,[bl,n("div",kl,[x(P(Ye),{style:{width:"100%"},"content-editable":!o.value.is_admin,onFinish:k[2]||(k[2]=I=>l(I))},{default:E(()=>[A(T(o.value.mandatory_tags.join("; ")),1)]),_:1},8,["content-editable"])])]))])]),n("input",{id:"delete-user-button",type:"button",value:"Delete user",onClick:k[3]||(k[3]=()=>{g.value=!0})})])]),_:1},8,["show"]),x($e,{show:g.value,"onUpdate:show":k[7]||(k[7]=I=>g.value=I),title:"Delete user",onOnCancel:k[8]||(k[8]=()=>{g.value=!1,u.value=""}),onOnClose:k[9]||(k[9]=()=>{g.value=!1,u.value=""}),onOnAccept:f},{default:E(()=>[n("div",$l,[n("p",null,[A(" Are you sure to delete user "),n("b",null,T(o.value.name)+" ("+T(o.value.username)+")",1),A("? "),Sl]),xl,A(" Type "),n("b",null,T(o.value.username),1),A(" to confirm: "),H(n("input",{type:"text",id:"delete-user-input","onUpdate:modelValue":k[6]||(k[6]=I=>u.value=I),autocomplete:"off"},null,512),[[G,u.value]])])]),_:1},8,["show"]),x($e,{show:h.value,"onUpdate:show":k[16]||(k[16]=I=>h.value=I),onOnCancel:v,onOnAccept:$,onOnClose:v},{default:E(()=>[n("div",Cl,[n("table",Dl,[n("tr",null,[Pl,n("td",null,[H(n("input",{type:"text","onUpdate:modelValue":k[10]||(k[10]=I=>_.value=I),autocomplete:"off",class:"create-user-input"},null,512),[[G,_.value]])])]),n("tr",null,[Il,n("td",null,[H(n("input",{type:"text","onUpdate:modelValue":k[11]||(k[11]=I=>m.value=I),autocomplete:"off",class:"create-user-input"},null,512),[[G,m.value]])])]),n("tr",null,[Tl,n("td",null,[H(n("input",{type:"text","onUpdate:modelValue":k[12]||(k[12]=I=>C.value=I),autocomplete:"off",class:"create-user-input"},null,512),[[G,C.value]])])]),n("tr",null,[Ul,n("td",null,[H(n("input",{type:"text","onUpdate:modelValue":k[13]||(k[13]=I=>c.value=I),autocomplete:"off",class:"create-user-input"},null,512),[[G,c.value]])])]),n("tr",null,[Bl,n("td",null,[H(n("input",{type:"text","onUpdate:modelValue":k[14]||(k[14]=I=>S.value=I),autocomplete:"off",class:"create-user-input",placeholder:"Separate with semicolon ';'"},null,512),[[G,S.value]])])]),n("tr",null,[Ml,n("td",Ll,[x(Me,{checked:D.value,"onUpdate:checked":k[15]||(k[15]=I=>D.value=I)},null,8,["checked"])])])])])]),_:1},8,["show"]),n("div",Al,[Rl,e.value?(p(),w("div",{key:0,id:"add-user-div",onClick:k[17]||(k[17]=()=>h.value=!0)},"+")):R("",!0)]),n("table",null,[n("tr",null,[e.value?(p(),w("th",El)):R("",!0),ql,Ol,Fl,zl,Hl]),(p(!0),w(W,null,Q(t.value,I=>(p(),w("tr",Nl,[e.value?(p(),w("td",Wl,[n("div",{class:"edit-button",onClick:()=>r(I)},[n("img",{src:P(ll),alt:"",class:"icon"},null,8,Kl)],8,jl)])):R("",!0),n("td",null,[n("div",Vl,[n("img",{src:`${P(Be)()}/user-avatar/${I.username}?size=60`,alt:"",class:"avatar"},null,8,Zl)])]),n("td",Gl,T(I.username),1),n("td",null,T(I.name),1),n("td",Jl,T(I.max_storage/1024/1024>1024?`${(I.max_storage/1024/1024/1024).toFixed(1)} G`:`${(I.max_storage/1024/1024).toFixed(0)} M`),1),n("td",null,[I.is_admin?(p(),w("label",Ql,"ADMIN")):(p(),V(Ge,{key:0,tags:I.mandatory_tags,"max-width":200,"middle-align":!0},null,8,["tags"]))])]))),256)),n("tr",null,[t.value.length===0?(p(),w("td",Yl," No users ")):R("",!0)])])]))}}),Ct=q(Xl,[["__scopeId","data-v-a87fab58"]]),ue=s=>(ne("data-v-a3b39d24"),s=s(),ae(),s),eu={class:"toolbar"},tu={id:"about-main",class:"slideIn"},nu=ue(()=>n("h1",null,"About",-1)),au=ue(()=>n("div",{class:"content"},[n("p",null,[A(" Lires is a self-hosted web application for research literature management. "),n("br"),A(" It is open source and available at "),n("a",{href:"https://github.com/MenxLi/Lires",target:"_blank"},"GitHub - MenxLi/Lires"),A(". "),n("br")])],-1)),su={class:"content"},ou=ue(()=>n("h2",null," Resources ",-1)),iu=["href"],ru=["href"],lu={key:0,class:"content"},uu=ue(()=>n("h2",null," Management ",-1)),cu=ue(()=>n("summary",null,"Server status ",-1)),du=ue(()=>n("b",null,"Backend",-1)),hu=ue(()=>n("b",null,"Version",-1)),pu=ue(()=>n("b",null,"Uptime",-1)),fu=ue(()=>n("b",null,"Connection count",-1)),mu=ue(()=>n("summary",null,"User management",-1)),vu={style:{border:"1px solid var(--color-border)","border-radius":"10px",display:"flex","justify-content":"center","margin-block":"10px",padding:"10px",width:"100%"}},gu={id:"versionHistory",class:"content"},_u=ue(()=>n("h1",{style:{"margin-bottom":"0px"}}," Version history ",-1)),yu={class:"block"},wu={key:0},bu={key:1},ku=L({__name:"About",setup(s){const t=b([]),e=b(!1),a=J().conn,i=()=>{a.changelog().then(u=>{t.value=u},u=>{console.error(u)})},o=b(-1),r=B(()=>{if(o.value===-1)return"N/A";const u=Math.floor(o.value/3600),f=Math.floor((o.value-u*3600)/60),h=Math.floor(o.value-u*3600-f*60);return`${u}h ${f}m ${h}s`}),l=b({backend:Be(),version:"",uptime:r,_uptime:-1,numDocs:-1,numConnections:-1}),d=()=>{a.status().then(u=>{o.value=u.uptime,l.value.version=u.version,l.value.numDocs=u.n_data,l.value.numConnections=u.n_connections},u=>{console.error(u)})},g=B(()=>t.value.slice().reverse());return i(),d(),window.setInterval(()=>o.value++,1e3),ie("login",()=>l.value.numConnections++),ie("logout",()=>l.value.numConnections--),(u,f)=>(p(),w(W,null,[n("div",eu,[x(Le)]),n("div",tu,[nu,au,n("div",su,[ou,n("ul",null,[n("li",null,[n("a",{href:P(so),target:"_blank"},"User manual",8,iu)]),n("li",null,[n("a",{href:P(N)().backend()+`/api/api.zip?key=${P(N)().encKey}`},"Javascript API",8,ru)]),n("li",null,[n("a",{onClick:f[0]||(f[0]=h=>e.value=!0),style:{cursor:"pointer"}},"Change log")])])]),P(j)().user.is_admin?(p(),w("div",lu,[uu,n("details",null,[cu,n("ul",null,[n("li",null,[du,A(": "+T(l.value.backend),1)]),n("li",null,[hu,A(": "+T(l.value.version),1)]),n("li",null,[pu,A(": "+T(l.value.uptime),1)]),n("li",null,[fu,A(": "+T(l.value.numConnections),1)])])]),n("details",null,[mu,n("div",vu,[x(Ct)])])])):R("",!0),x(De,{show:e.value,"onUpdate:show":f[1]||(f[1]=h=>e.value=h),title:"Change log"},{default:E(()=>[n("div",gu,[_u,(p(!0),w(W,null,Q(g.value.length,h=>(p(),w("div",yu,[n("h2",null,T(g.value[h-1][0].toString()),1),n("ul",null,[(p(!0),w(W,null,Q(g.value[h-1][1],_=>(p(),w("li",null,[typeof _=="string"?(p(),w("div",wu,T(_),1)):typeof _=="object"?(p(),w("div",bu,[A(T(Object.keys(_)[0])+" ",1),n("ul",null,[(p(!0),w(W,null,Q(_[Object.keys(_)[0]],m=>(p(),w("li",null,T(m),1))),256))])])):R("",!0)]))),256))])]))),256))])]),_:1},8,["show"])])],64))}}),$u=q(ku,[["__scopeId","data-v-a3b39d24"]]),Su={},xu={id:"widget-container-main"};function Cu(s,t){return p(),w("div",xu,[fe(s.$slots,"default",{},void 0,!0)])}const Du=q(Su,[["render",Cu],["__scopeId","data-v-257ac3c4"]]),Pu={id:"main-dashboard",class:"slideIn"},Iu=L({__name:"Dashboard",setup(s){return(t,e)=>(p(),w(W,null,[x(Le),n("div",Pu,[x(Du,null,{default:E(()=>[x(Ct)]),_:1})])],64))}}),Tu=q(Iu,[["__scopeId","data-v-6b501763"]]),Uu={class:"editor-block"},Bu={class:"editor-toolbar"},Mu={id:"editor-body"},Lu={key:0,id:"editor-input",class:"body-area"},Au={key:1,id:"editor-preview",class:"body-area"},Ru=["innerHTML"],Eu=L({__name:"EditorBlock",props:at({preRenderFn:{type:Function,default:s=>s},theme:{default:"light"}},{text:{default:""},textModifiers:{},preview:{type:Boolean,default:!1},previewModifiers:{}}),emits:at(["on-input","on-save","on-upload-images"],["update:text","update:preview"]),setup(s,{expose:t,emit:e}){const a=s,i=st(s,"text"),o=st(s,"preview"),r=b(a.preRenderFn(i.value));te(()=>i.value,f=>{r.value=Kt().render(a.preRenderFn(f))});const l=e;function d(f){l("on-upload-images",[f])}const g=b(null);function u(f){const h=g.value.selectionStart,_=g.value.selectionEnd,m=f.substring(0,h),C=f.substring(_,f.length);f=m+f+C,g.value.value=f}return t({insert:u}),(f,h)=>(p(),w("div",Uu,[n("div",Bu,[n("button",{onClick:h[0]||(h[0]=_=>l("on-save",i.value))},"Save"),n("button",{onClick:h[1]||(h[1]=_=>o.value=!o.value)},"Toggle Preview"),x(P(Se),{action:d})]),n("div",Mu,[o.value?(p(),w("div",Au,[n("div",{innerHTML:r.value},null,8,Ru)])):(p(),w("div",Lu,[H(n("textarea",{"onUpdate:modelValue":h[2]||(h[2]=_=>i.value=_),onInput:h[3]||(h[3]=_=>l("on-input",i.value)),ref_key:"textarea",ref:g},null,544),[[G,i.value]])]))])]))}}),qu=q(Eu,[["__scopeId","data-v-5cb2f3c3"]]),Ou={key:0,class:"test"},Fu={key:1},zu=L({__name:"_Test",setup(s){const e=b(""),a=b(!1);function i(){console.log("Note saved")}const o=async r=>{console.log("Images uploaded",r)};return(r,l)=>P(!1)?(p(),w("div",Ou,[x(Me,{checked:a.value,"onUpdate:checked":l[0]||(l[0]=d=>a.value=d)},null,8,["checked"]),x(qu,{text:e.value,"onUpdate:text":l[1]||(l[1]=d=>e.value=d),preview:a.value,"onUpdate:preview":l[2]||(l[2]=d=>a.value=d),onOnSave:i,onOnUploadImages:o},null,8,["text","preview"])])):(p(),w("p",Fu," Test is not available in production "))}}),Hu=[{path:"/",component:Ti},{path:"/feed",component:pr},{path:"/login",component:Ur},{path:"/reader/:id",component:rl},{path:"/about",component:$u},{path:"/dashboard/:username",component:Tu},{path:"/_test",component:zu}],Nu=Ft({history:zt(),routes:Hu}),Wu=Ot();qt(_n).use(Wu).use(Nu).mount("#app");
