"use strict";(self.webpackChunknucliadb_admin=self.webpackChunknucliadb_admin||[]).push([[64],{9064:(Jt,F,r)=>{r.r(F),r.d(F,{SyncModule:()=>Lt});var b=r(1368),C=r(2220),d=r(6504),S=r(6468),O=r(1828),p=r(3992),t=r(4496),k=r(4676),R=r(1632),A=r(4020),v=r(2064);function M(i,o){if(1&i){const e=t.KQA();t.I0R(0,"div",7)(1,"span"),t.OEk(2),t.wVc(3,"translate"),t.C$Y(),t.I0R(4,"pa-button",8),t.qCj("click",function(){t.usT(e);const s=t.GaO();return t.CGJ(s.setDefaultLocal())}),t.OEk(5),t.wVc(6,"translate"),t.C$Y()()}2&i&&(t.yG2(2),t.cNF(t.kDX(3,2,"upload.server.help-local")),t.yG2(3),t.oRS(" ",t.kDX(6,4,"upload.server.set-local")," "))}let X=(()=>{class i{constructor(e,n,s){this.sync=e,this.navigationService=n,this.router=s,this.localUrl=S.eA,this.serverUrl=new d.Ku(localStorage.getItem(S.uk)||"",{nonNullable:!0})}save(){this.sync.setSyncServer(this.serverUrl.value),this.back()}back(){this.navigationService.kbUrl.pipe((0,p.U)(1)).subscribe(e=>this.router.navigate([`${e}/upload`]))}setDefaultLocal(){this.serverUrl.setValue(this.localUrl),this.serverUrl.markAsDirty()}static#t=this.\u0275fac=function(n){return new(n||i)(t.GI1(S.gH),t.GI1(O.wx),t.GI1(C.E5))};static#e=this.\u0275cmp=t.In1({type:i,selectors:[["nsy-server-setup"]],decls:18,vars:21,consts:[[1,"header"],["icon","chevron-left","aspect","basic",3,"paTooltip","click"],[1,"container"],[3,"innerHTML"],["placeholder","https://my.sync.server",3,"formControl"],["class","local"],["kind","primary",1,"save-button",3,"disabled","click"],[1,"local"],["size","small","aspect","basic",3,"click"]],template:function(n,s){1&n&&(t.I0R(0,"div",0)(1,"pa-button",1),t.qCj("click",function(){return s.back()}),t.wVc(2,"translate"),t.OEk(3),t.wVc(4,"translate"),t.C$Y(),t.I0R(5,"h1"),t.OEk(6),t.wVc(7,"translate"),t.C$Y()(),t.I0R(8,"div",2),t.wR5(9,"p",3),t.wVc(10,"translate"),t.I0R(11,"pa-input",4),t.OEk(12),t.wVc(13,"translate"),t.C$Y(),t.yuY(14,M,7,6,"div",5),t.I0R(15,"pa-button",6),t.qCj("click",function(){return s.save()}),t.OEk(16),t.wVc(17,"translate"),t.C$Y()()),2&n&&(t.yG2(),t.E7m("paTooltip",t.kDX(2,9,"upload.server.back")),t.yG2(2),t.oRS(" ",t.kDX(4,11,"upload.server.back")," "),t.yG2(3),t.cNF(t.kDX(7,13,"upload.server.title")),t.yG2(3),t.E7m("innerHTML",t.kDX(10,15,"upload.server.description"),t.E3n),t.yG2(2),t.E7m("formControl",s.serverUrl),t.yG2(),t.oRS(" ",t.kDX(13,17,"upload.server.url")," "),t.yG2(2),t.C0Y(14,s.serverUrl.value!==s.localUrl?14:-1),t.yG2(),t.E7m("disabled",s.serverUrl.pristine),t.yG2(),t.oRS(" ",t.kDX(17,19,"generic.save")," "))},dependencies:[k.k,R.g,A.u,d.ue,d.ug,v.sD],styles:['@charset "UTF-8";.header[_ngcontent-%COMP%]{display:flex}p[_ngcontent-%COMP%]{margin-bottom:2rem}.container[_ngcontent-%COMP%]{max-width:40rem}.save-button[_ngcontent-%COMP%]{margin-top:1.5rem}.local[_ngcontent-%COMP%]{margin-top:1rem}.local[_ngcontent-%COMP%]   pa-button[_ngcontent-%COMP%]{margin-left:1rem}'],changeDetection:0})}return i})();var h=r(7368),f=r(4704),w=r(5657),T=r(6684),V=r(3616),g=r(3394),U=r(3416),P=r(4555),Q=r(6576),E=r(9212),N=r(5568),I=r(2700),j=r(1056),x=r(9144),K=r(5672),L=r(7360),J=r(9040),H=r(6832),W=r(4180),q=r(874);const z=(i,o)=>o.index;function B(i,o){if(1&i){const e=t.KQA();t.I0R(0,"div",4),t.wR5(1,"pa-icon",5),t.I0R(2,"div",6),t.OEk(3),t.wVc(4,"translate"),t.I0R(5,"pa-button",7),t.qCj("click",function(){t.usT(e);const s=t.GaO(2);return t.CGJ(s.goTo.emit("folders"))}),t.OEk(6),t.wVc(7,"translate"),t.C$Y()()()}2&i&&(t.yG2(3),t.oRS(" ",t.kDX(4,2,"upload.activity.no-folders")," "),t.yG2(3),t.oRS(" ",t.kDX(7,4,"upload.activity.select-folder")," "))}function Z(i,o){if(1&i){const e=t.KQA();t.I0R(0,"p"),t.OEk(1),t.wVc(2,"translate"),t.C$Y(),t.yuY(3,B,8,6,"div",2),t.wVc(4,"async"),t.wVc(5,"async"),t.I0R(6,"pa-button",3),t.qCj("click",function(){t.usT(e);const s=t.GaO();return t.CGJ(s.triggerSync())}),t.wVc(7,"async"),t.wVc(8,"async"),t.OEk(9),t.wVc(10,"translate"),t.C$Y()}if(2&i){const e=t.GaO();t.yG2(),t.cNF(t.kDX(2,4,"upload.activity.help")),t.yG2(2),t.C0Y(3,t.kDX(4,6,e.canSelectFiles)&&t.kDX(5,8,e.noFolderSelected)?3:-1),t.yG2(3),t.E7m("disabled",e.syncing||t.kDX(7,10,e.canSelectFiles)&&t.kDX(8,12,e.noFolderSelected)),t.yG2(3),t.oRS(" ",t.kDX(10,14,"upload.activity.sync-now")," ")}}function tt(i,o){if(1&i&&(t.I0R(0,"pa-table-row")(1,"pa-table-cell"),t.wR5(2,"pa-icon",8),t.C$Y(),t.I0R(3,"pa-table-cell"),t.wR5(4,"pa-datetime",9),t.C$Y(),t.I0R(5,"pa-table-cell"),t.OEk(6),t.C$Y()()),2&i){const e=o.$implicit;t.yG2(2),t.E7m("name",e.icon),t.yG2(2),t.E7m("datetime",e.date),t.yG2(2),t.cNF(e.message)}}let et=(()=>{class i{constructor(e,n,s,c){this.syncService=e,this.cdr=n,this.router=s,this.toast=c,this.goTo=new t._w7,this.unsubscribeAll=new w.E,this.since="",this.currentIndex=0,this.logs=[],this.syncing=!1,this.currentSync=this.syncService.getCurrentSync(),this.canSelectFiles=this.syncService.currentSourceId.pipe((0,f.k)(a=>this.syncService.canSelectFiles(a||""))),this.noFolderSelected=this.currentSync.pipe((0,f.k)(a=>!a.foldersToSync||0===a.foldersToSync.length)),this.disabled=this.currentSync.pipe((0,f.k)(a=>!!a.disabled))}ngOnInit(){this.router.events.pipe((0,T.I)(e=>e instanceof C.MT),(0,E.y)(()=>{this.since="",this.logs=[],this.cdr.markForCheck()}),(0,N.W)(null),(0,h.G)(()=>this.syncService.currentSourceId),(0,T.I)(e=>!!e),(0,h.G)(e=>(0,I.of)(e).pipe((0,j.G)({delay:1e4}))),(0,h.G)(e=>this.syncService.getLogs(e,this.since).pipe((0,x.a)(n=>(console.error("Error while fetching logs",n),(0,I.of)([]))))),(0,f.k)(e=>e.map((n,s)=>({index:s+this.currentIndex,date:n.createdAt,message:n.message,icon:"high"===n.level?"circle-cross":"medium"===n.level?"warning":"circle-check"}))),(0,V.a)(this.unsubscribeAll)).subscribe(e=>{this.since=e[0]?.date||this.since,this.currentIndex+=e.length,this.logs=e.concat(this.logs),this.cdr.markForCheck()})}ngOnDestroy(){this.unsubscribeAll.next(),this.unsubscribeAll.complete()}triggerSync(){this.syncing=!0,this.cdr.markForCheck(),this.syncService.triggerSyncs().subscribe({complete:()=>{this.syncing=!1,this.cdr.markForCheck()},error:()=>{this.toast.error("upload.activity.error"),this.syncing=!1,this.cdr.markForCheck()}})}static#t=this.\u0275fac=function(n){return new(n||i)(t.GI1(S.gH),t.GI1(t.kD9),t.GI1(C.E5),t.GI1(g.Q$))};static#e=this.\u0275cmp=t.In1({type:i,selectors:[["nsy-activity"]],outputs:{goTo:"goTo"},decls:13,vars:9,consts:[["columns","48px 200px auto"],["header",""],["class","warning-container"],[3,"disabled","click"],[1,"warning-container"],["name","warning"],[1,"title-xxs"],["aspect","basic","size","small",3,"click"],[3,"name"],[3,"datetime"]],template:function(n,s){1&n&&(t.yuY(0,Z,11,16),t.wVc(1,"async"),t.I0R(2,"pa-table",0)(3,"pa-table-header"),t.wR5(4,"pa-table-cell",1),t.I0R(5,"pa-table-cell",1),t.OEk(6),t.wVc(7,"translate"),t.C$Y(),t.I0R(8,"pa-table-cell",1),t.OEk(9),t.wVc(10,"translate"),t.C$Y()(),t.c53(11,tt,7,3,"pa-table-row",null,z),t.C$Y()),2&n&&(t.C0Y(0,!1===t.kDX(1,3,s.disabled)?0:-1),t.yG2(6),t.cNF(t.kDX(7,5,"upload.activity.date")),t.yG2(3),t.cNF(t.kDX(10,7,"upload.activity.event")),t.yG2(2),t.oho(s.logs))},dependencies:[k.k,K.g,L.o,J.q,H.K,W.oB,q._,b.a,v.sD],styles:['@charset "UTF-8";.warning-container[_ngcontent-%COMP%]{display:flex;align-items:center;background:#ffdd1a;color:#000;margin-bottom:1rem;padding:1rem;gap:1rem}'],changeDetection:0})}return i})();var Y=r(1560);const nt=(i,o)=>o.id;function it(i,o){if(1&i&&(t.I0R(0,"pa-input",5),t.wVc(1,"translate"),t.OEk(2),t.wVc(3,"translate"),t.C$Y()),2&i){const e=t.GaO().$implicit;t.E7m("help",e.help?t.kDX(1,4,e.help):void 0)("placeholder",e.placeholder)("formControlName",e.id),t.yG2(2),t.oRS(" ",t.kDX(3,6,e.label)," ")}}function st(i,o){if(1&i&&(t.I0R(0,"pa-textarea",6),t.wVc(1,"translate"),t.OEk(2),t.wVc(3,"translate"),t.C$Y()),2&i){const e=t.GaO().$implicit;t.E7m("help",e.help?t.kDX(1,3,e.help):void 0)("formControlName",e.id),t.yG2(2),t.oRS(" ",t.kDX(3,5,e.label)," ")}}function ot(i,o){if(1&i&&(t.I0R(0,"div",4),t.yuY(1,it,4,8,"pa-input",5)(2,st,4,7,"pa-textarea",6),t.C$Y()),2&i){const e=o.$implicit;t.yG2(),t.C0Y(1,"text"===e.type?1:-1),t.yG2(),t.C0Y(2,"textarea"===e.type?2:-1)}}function ct(i,o){if(1&i){const e=t.KQA();t.I0R(0,"form",1),t.qCj("ngSubmit",function(){t.usT(e);const s=t.GaO();return t.CGJ(s.save())}),t.I0R(1,"pa-input",2),t.OEk(2),t.wVc(3,"translate"),t.C$Y(),t.c53(4,ot,3,2,"div",7,nt),t.I0R(6,"pa-button",3),t.OEk(7),t.wVc(8,"translate"),t.C$Y()()}if(2&i){const e=t.GaO();t.E7m("formGroup",e.form),t.yG2(2),t.oRS(" ",t.kDX(3,4,"upload.source.name")," "),t.yG2(2),t.oho(e.fields),t.yG2(2),t.E7m("disabled",!e.form.valid),t.yG2(),t.oRS(" ",t.kDX(8,6,"action.save")," ")}}let at=(()=>{class i{constructor(e,n,s,c){this.syncService=e,this.toast=n,this.formBuilder=s,this.cdr=c,this.goTo=new t._w7}ngOnInit(){this.syncService.getCurrentSync().pipe((0,T.I)(e=>!!e),(0,E.y)(e=>this.sync=e),(0,h.G)(e=>this.syncService.getConnector(e.connector.name,"").pipe((0,h.G)(n=>n.getParameters()),(0,f.k)(n=>({sync:e,fields:n}))))).subscribe(({sync:e,fields:n})=>this.showFields(e,n))}save(){this.sync&&this.syncService.updateSync(this.sync.id,{title:this.form?.value.title||"",connector:{...this.sync.connector,parameters:{...this.sync.connector.parameters,...this.form?.value.fields||{}}}}).subscribe({next:()=>{this.toast.success("upload.saved"),this.goTo.emit("activity")},error:()=>{this.toast.error("upload.failed")}})}showFields(e,n){this.fields=n,this.form=this.formBuilder.group({title:["",d.AQ.required],fields:this.formBuilder.group(n.reduce((s,c)=>({...s,[c.id]:["",this.getFieldValidators(c)]}),{}))}),this.form.patchValue({fields:e.connector.parameters,title:e.title||e.id}),this.cdr.markForCheck()}getFieldValidators(e){const n=[];return e.required&&n.push(d.AQ.required),e.pattern&&n.push(d.AQ.pattern(e.pattern)),n}static#t=this.\u0275fac=function(n){return new(n||i)(t.GI1(S.gH),t.GI1(g.Q$),t.GI1(d.KE),t.GI1(t.kD9))};static#e=this.\u0275cmp=t.In1({type:i,selectors:[["nsy-edit-settings"]],outputs:{goTo:"goTo"},decls:1,vars:1,consts:[["qa","fields-form",3,"formGroup"],["qa","fields-form",3,"formGroup","ngSubmit"],["formControlName","title"],["qa","save-button","type","submit",3,"disabled"],["formGroupName","fields",1,"field"],[3,"help","placeholder","formControlName"],[3,"help","formControlName"],["formGroupName","fields","class","field"]],template:function(n,s){1&n&&t.yuY(0,ct,9,8,"form",0),2&n&&t.C0Y(0,s.fields&&s.form?0:-1)},dependencies:[d.sz,d.ue,d.u,d.uW,d.Wo,d.Kh,R.g,Y.a,k.k,v.sD],styles:['@charset "UTF-8";.field[_ngcontent-%COMP%]{margin:1rem 0}.field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem}pa-button[_ngcontent-%COMP%]{margin-top:1rem}'],changeDetection:0})}return i})();var rt=r(1112),lt=r(7648),dt=r(9336);r(1116);class pt{get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}constructor(o=!1,e,n=!0,s){this._multiple=o,this._emitChanges=n,this.compareWith=s,this._selection=new Set,this._deselectedToEmit=[],this._selectedToEmit=[],this.changed=new w.E,e&&e.length&&(o?e.forEach(c=>this._markSelected(c)):this._markSelected(e[0]),this._selectedToEmit.length=0)}select(...o){this._verifyValueAssignment(o),o.forEach(n=>this._markSelected(n));const e=this._hasQueuedChanges();return this._emitChangeEvent(),e}deselect(...o){this._verifyValueAssignment(o),o.forEach(n=>this._unmarkSelected(n));const e=this._hasQueuedChanges();return this._emitChangeEvent(),e}setSelection(...o){this._verifyValueAssignment(o);const e=this.selected,n=new Set(o);o.forEach(c=>this._markSelected(c)),e.filter(c=>!n.has(this._getConcreteValue(c,n))).forEach(c=>this._unmarkSelected(c));const s=this._hasQueuedChanges();return this._emitChangeEvent(),s}toggle(o){return this.isSelected(o)?this.deselect(o):this.select(o)}clear(o=!0){this._unmarkAll();const e=this._hasQueuedChanges();return o&&this._emitChangeEvent(),e}isSelected(o){return this._selection.has(this._getConcreteValue(o))}isEmpty(){return 0===this._selection.size}hasValue(){return!this.isEmpty()}sort(o){this._multiple&&this.selected&&this._selected.sort(o)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(o){o=this._getConcreteValue(o),this.isSelected(o)||(this._multiple||this._unmarkAll(),this.isSelected(o)||this._selection.add(o),this._emitChanges&&this._selectedToEmit.push(o))}_unmarkSelected(o){o=this._getConcreteValue(o),this.isSelected(o)&&(this._selection.delete(o),this._emitChanges&&this._deselectedToEmit.push(o))}_unmarkAll(){this.isEmpty()||this._selection.forEach(o=>this._unmarkSelected(o))}_verifyValueAssignment(o){}_hasQueuedChanges(){return!(!this._deselectedToEmit.length&&!this._selectedToEmit.length)}_getConcreteValue(o,e){if(this.compareWith){e=e??this._selection;for(let n of e)if(this.compareWith(o,n))return n;return o}return o}}var $=r(3648),mt=r(6920);const ft=(i,o)=>o.uuid;function yt(i,o){if(1&i&&(t.I0R(0,"span",5),t.OEk(1),t.C$Y()),2&i){const e=t.GaO().$implicit;t.yG2(),t.cNF(e.metadata.path)}}function Ct(i,o){if(1&i){const e=t.KQA();t.I0R(0,"tr")(1,"td")(2,"pa-checkbox",3),t.qCj("valueChange",function(){const c=t.usT(e).$implicit,a=t.GaO();return t.CGJ(a.toggle(c))}),t.yuY(3,yt,2,1,"span",4),t.OEk(4),t.C$Y()()()}if(2&i){const e=o.$implicit,n=t.GaO();t.yG2(2),t.E7m("value",n.selection.isSelected(e)),t.yG2(),t.C0Y(3,e.metadata.path?3:-1),t.yG2(),t.oRS(" ",e.title," ")}}function gt(i,o){1&i&&t.wR5(0,"nsi-spinner")}const _t=/\//g;let St=(()=>{class i{constructor(e,n,s){this.syncService=e,this.toast=n,this.cdr=s,this.goTo=new t._w7,this.loading=!1,this.query="",this.selection=new pt(!0,[]),this.triggerSearch=new w.E,this.canSelectFiles=this.syncService.currentSourceId.pipe((0,f.k)(c=>this.syncService.canSelectFiles(c||""))),this.resources=this.triggerSearch.pipe((0,E.y)(()=>{this.loading=!0,this.cdr.markForCheck()}),(0,h.G)(()=>this.syncService.getFolders(this.query).pipe((0,x.a)(c=>(c&&this.toast.error("string"==typeof c?c:c.error?.message||c.error||c.message||"An error occurred"),(0,I.of)({items:[],nextPage:void 0})))).pipe((0,E.y)(()=>{this.loading=!1,this.cdr.markForCheck()}),(0,rt.K)((c,a)=>c.concat(a.items),[]))),(0,f.k)(c=>c.map(a=>{let l=a.metadata.path;return l?(l.startsWith("/")||(l=`/${l}`),l+="/",l=l.replace(_t," / ")):l="/",{...a,metadata:{...a.metadata||{},path:l}}}).sort((a,l)=>("/"===a.metadata.path?` / ${a.title}`:`${a.metadata.path} / ${a.title}`).localeCompare("/"===l.metadata.path?` / ${l.title}`:`${l.metadata.path} / ${l.title}`))),(0,lt.o)())}ngOnInit(){(0,dt.y)([this.syncService.getCurrentSync().pipe((0,p.U)(1)),this.resources.pipe((0,p.U)(1))]).subscribe(([e,n])=>{e.foldersToSync?.forEach(s=>{const c=n.find(a=>a.uuid===s.uuid);c&&this.selection.select(c)}),this.cdr.detectChanges()})}ngAfterViewInit(){setTimeout(()=>{this.triggerSearch.next()},200)}save(){this.syncService.currentSourceId.pipe((0,p.U)(1),(0,h.G)(e=>this.syncService.updateSync(e||"",{foldersToSync:this.selection.selected},!0))).subscribe({next:()=>{this.toast.success("upload.saved"),this.goTo.emit("activity")},error:()=>{this.toast.error("upload.failed")}})}toggle(e){this.selection.toggle(e),this.cdr.detectChanges()}static#t=this.\u0275fac=function(n){return new(n||i)(t.GI1(S.gH),t.GI1(g.Q$),t.GI1(t.kD9))};static#e=this.\u0275cmp=t.In1({type:i,selectors:[["nsy-edit-folders"]],outputs:{goTo:"goTo"},decls:10,vars:6,consts:[[1,"body"],[1,"actions"],["qa","save-button",3,"click"],[3,"value","valueChange"],["class","body-xs"],[1,"body-xs"]],template:function(n,s){1&n&&(t.I0R(0,"div",0)(1,"table"),t.c53(2,Ct,5,3,"tr",null,ft),t.wVc(4,"async"),t.C$Y()(),t.yuY(5,gt,1,0,"nsi-spinner"),t.I0R(6,"div",1)(7,"pa-button",2),t.qCj("click",function(){return s.save()}),t.OEk(8),t.wVc(9,"translate"),t.C$Y()()),2&n&&(t.yG2(2),t.oho(t.kDX(4,2,s.resources)),t.yG2(3),t.C0Y(5,s.loading?5:-1),t.yG2(3),t.oRS(" ",t.kDX(9,4,"action.save")," "))},dependencies:[k.k,$.K,mt.i,b.a,v.sD],styles:['@charset "UTF-8";.body[_ngcontent-%COMP%]{overflow-y:auto}table[_ngcontent-%COMP%]{border-spacing:0;margin-top:.5rem;width:calc(100% - 1rem)}td[_ngcontent-%COMP%]{align-items:center;border-bottom:1px solid hsl(0,0%,44%);display:flex;height:2rem;transition:color .16s ease-in-out}td[_ngcontent-%COMP%]   .disabled[_ngcontent-%COMP%]{color:#c4c4c4;padding-left:1.75rem}.parameters[_ngcontent-%COMP%], .actions[_ngcontent-%COMP%]{margin-top:2rem}'],changeDetection:0})}return i})();var vt=r(6936),bt=r(8532);function kt(i,o){if(1&i){const e=t.KQA();t.I0R(0,"label",0),t.OEk(1),t.wVc(2,"translate"),t.C$Y(),t.I0R(3,"div",1)(4,"nsi-labels-expander",2),t.qCj("updateSelection",function(s){t.usT(e);const c=t.GaO();return t.CGJ(c.updateLabelSelection(s))}),t.wVc(5,"async"),t.C$Y()(),t.I0R(6,"div",3)(7,"pa-button",4),t.qCj("click",function(){t.usT(e);const s=t.GaO();return t.CGJ(s.save())}),t.OEk(8),t.wVc(9,"translate"),t.C$Y()()}if(2&i){const e=t.GaO();t.yG2(),t.oRS(" ",t.kDX(2,4,"upload.labels")," "),t.yG2(3),t.E7m("labelSets",t.kDX(5,6,e.labelSets))("currentSelection",e.currentSelection),t.yG2(4),t.oRS(" ",t.kDX(9,8,"action.save")," ")}}function Gt(i,o){1&i&&(t.I0R(0,"div",5),t.OEk(1),t.wVc(2,"translate"),t.C$Y()),2&i&&(t.yG2(),t.oRS(" ",t.kDX(2,1,"upload.no-labels")," "))}let Et=(()=>{class i{constructor(e,n,s,c){this.syncService=e,this.sdk=n,this.toast=s,this.cdr=c,this.goTo=new t._w7,this.labelSets=this.sdk.currentKb.pipe((0,p.U)(1),(0,h.G)(a=>a.getLabels()),(0,f.k)(a=>Object.entries(a).filter(([,l])=>0===l.kind.length||l.kind.includes(vt.MI.RESOURCES)).reduce((l,[m,u])=>({...l,[m]:u}),{}))),this.hasLabelSets=this.labelSets.pipe((0,f.k)(a=>Object.keys(a||{}).length>0)),this.currentSelection={},this.selectedLabels=[]}ngOnInit(){this.syncService.getCurrentSync().pipe((0,p.U)(1)).subscribe(e=>this.updateLabelSelection((e.labels||[]).reduce((n,s)=>({...n,[(0,g.gn)(s.labelset,s.label)]:!0}),{})))}save(){this.syncService.currentSourceId.pipe((0,p.U)(1),(0,h.G)(e=>this.syncService.updateSync(e||"",{labels:this.selectedLabels}))).subscribe({next:()=>{this.toast.success("upload.saved"),this.goTo.emit("activity")},error:()=>{this.toast.error("upload.failed")}})}updateLabelSelection(e){this.currentSelection=e,this.selectedLabels=(0,g.OS)(e),this.cdr.detectChanges()}static#t=this.\u0275fac=function(n){return new(n||i)(t.GI1(S.gH),t.GI1(O.E3),t.GI1(g.Q$),t.GI1(t.kD9))};static#e=this.\u0275cmp=t.In1({type:i,selectors:[["nsy-edit-labels"]],outputs:{goTo:"goTo"},decls:3,vars:3,consts:[["for","label-expander",1,"body-m"],[1,"labels-container"],["id","label-expander",3,"labelSets","currentSelection","updateSelection"],[1,"actions"],["qa","save-button",3,"click"],[1,"body-m"]],template:function(n,s){1&n&&(t.yuY(0,kt,10,10),t.wVc(1,"async"),t.yuY(2,Gt,3,3)),2&n&&t.C0Y(0,t.kDX(1,1,s.hasLabelSets)?0:2)},dependencies:[k.k,bt.l,b.a,v.sD],styles:['@charset "UTF-8";.actions[_ngcontent-%COMP%]{margin-top:2rem}'],changeDetection:0})}return i})();var Tt=r(5116);let It=(()=>{class i{constructor(e,n,s){this.syncService=e,this.toast=n,this.cdr=s,this.goTo=new t._w7,this.filtersForm=new d.WC({fileExtensions:new d.Ku(""),exclude:new d.Ku(!1),fromDate:new d.Ku(""),toDate:new d.Ku("")})}ngOnInit(){this.syncService.getCurrentSync().pipe((0,p.U)(1)).subscribe(e=>{this.filtersForm.setValue({fileExtensions:e.filters?.fileExtensions?.extensions||"",exclude:e.filters?.fileExtensions?.exclude||!1,fromDate:e.filters?.modified?.from||"",toDate:e.filters?.modified?.to||""}),this.cdr.markForCheck()})}save(){const e={};this.filtersForm.value.fileExtensions&&(e.fileExtensions={extensions:this.filtersForm.value.fileExtensions,exclude:!!this.filtersForm.value.exclude}),(this.filtersForm.value.fromDate||this.filtersForm.value.toDate)&&(e.modified={from:this.filtersForm.value.fromDate||void 0,to:this.filtersForm.value.toDate||void 0}),this.syncService.currentSourceId.pipe((0,p.U)(1),(0,h.G)(n=>this.syncService.updateSync(n||"",{filters:e},!0))).subscribe({next:()=>{this.toast.success("upload.saved"),this.goTo.emit("activity")},error:()=>{this.toast.error("upload.failed")}})}static#t=this.\u0275fac=function(n){return new(n||i)(t.GI1(S.gH),t.GI1(g.Q$),t.GI1(t.kD9))};static#e=this.\u0275cmp=t.In1({type:i,selectors:[["nsy-edit-filters"]],outputs:{goTo:"goTo"},decls:24,vars:19,consts:[[3,"formGroup","ngSubmit"],[1,"title-m"],[1,"field"],["formControlName","fileExtensions","help","upload.filters.extensions-help",3,"placeholder"],["help","upload.filters.exclude-help","formControlName","exclude"],["formControlName","fromDate","label","upload.filters.modified-from"],["formControlName","toDate","label","upload.filters.modified-to"],[1,"actions"],["qa","save-button",3,"click"]],template:function(n,s){1&n&&(t.I0R(0,"form",0),t.qCj("ngSubmit",function(){return s.save()}),t.I0R(1,"h3",1),t.OEk(2),t.wVc(3,"translate"),t.C$Y(),t.I0R(4,"div",2)(5,"pa-input",3),t.wVc(6,"translate"),t.OEk(7),t.wVc(8,"translate"),t.C$Y()(),t.I0R(9,"div",2)(10,"pa-checkbox",4),t.OEk(11),t.wVc(12,"translate"),t.C$Y()(),t.I0R(13,"div",2)(14,"h3",1),t.OEk(15),t.wVc(16,"translate"),t.C$Y(),t.wR5(17,"pa-date-picker",5),t.C$Y(),t.I0R(18,"div",2),t.wR5(19,"pa-date-picker",6),t.C$Y(),t.I0R(20,"div",7)(21,"pa-button",8),t.qCj("click",function(){return s.save()}),t.OEk(22),t.wVc(23,"translate"),t.C$Y()()()),2&n&&(t.E7m("formGroup",s.filtersForm),t.yG2(2),t.cNF(t.kDX(3,7,"upload.filters.extensions")),t.yG2(3),t.E7m("placeholder",t.kDX(6,9,"upload.filters.extensions-placeholder")),t.yG2(2),t.oRS(" ",t.kDX(8,11,"upload.filters.extensions")," "),t.yG2(4),t.oRS(" ",t.kDX(12,13,"upload.filters.exclude")," "),t.yG2(4),t.cNF(t.kDX(16,15,"upload.filters.modified")),t.yG2(7),t.oRS(" ",t.kDX(23,17,"action.save")," "))},dependencies:[d.sz,d.ue,d.u,d.uW,d.Wo,R.g,k.k,$.K,Tt.C,v.sD],styles:['@charset "UTF-8";h3[_ngcontent-%COMP%], .actions[_ngcontent-%COMP%]{margin-top:2rem}.field[_ngcontent-%COMP%]{margin:1rem 0}'],changeDetection:0})}return i})();function Dt(i,o){if(1&i){const e=t.KQA();t.I0R(0,"pa-tab",5),t.qCj("click",function(){t.usT(e);const s=t.GaO();return t.CGJ(s.selectedTab="folders")}),t.OEk(1),t.wVc(2,"translate"),t.C$Y()}if(2&i){const e=t.GaO();t.E7m("active","folders"===e.selectedTab),t.yG2(),t.oRS(" ",t.kDX(2,2,"upload.tabs.folders")," ")}}function Ot(i,o){if(1&i){const e=t.KQA();t.I0R(0,"section")(1,"nsy-activity",7),t.qCj("goTo",function(s){t.usT(e);const c=t.GaO();return t.CGJ(c.goTo(s))}),t.C$Y()()}}function Rt(i,o){if(1&i){const e=t.KQA();t.I0R(0,"section")(1,"nsy-edit-folders",7),t.qCj("goTo",function(s){t.usT(e);const c=t.GaO();return t.CGJ(c.goTo(s))}),t.C$Y()()}}function wt(i,o){if(1&i){const e=t.KQA();t.I0R(0,"section")(1,"nsy-edit-filters",7),t.qCj("goTo",function(s){t.usT(e);const c=t.GaO();return t.CGJ(c.goTo(s))}),t.C$Y()()}}function Ft(i,o){if(1&i){const e=t.KQA();t.I0R(0,"section")(1,"nsy-edit-labels",7),t.qCj("goTo",function(s){t.usT(e);const c=t.GaO();return t.CGJ(c.goTo(s))}),t.C$Y()()}}function Vt(i,o){if(1&i){const e=t.KQA();t.I0R(0,"section")(1,"nsy-edit-settings",7),t.qCj("goTo",function(s){t.usT(e);const c=t.GaO();return t.CGJ(c.goTo(s))}),t.C$Y()()}}let xt=(()=>{class i{constructor(e,n,s,c,a){this.syncService=e,this.router=n,this.toast=s,this.cdr=c,this.route=a,this.currentSync=this.syncService.getCurrentSync(),this.connector=this.currentSync.pipe((0,h.G)(l=>this.syncService.connectorsObs.pipe((0,f.k)(m=>m.find(u=>u.id===l.connector.name))))),this.canSelectFiles=this.syncService.getCurrentSync().pipe((0,f.k)(l=>this.syncService.canSelectFiles(l.id||""))),this.selectedTab="activity",this.enabled=this.currentSync.pipe((0,f.k)(l=>!l.disabled)),this.unsubscribeAll=new w.E}ngOnInit(){this.route.paramMap.subscribe(e=>{this.syncService.setCurrentSourceId(e.get("id")||"")}),this.router.events.pipe((0,T.I)(e=>e instanceof C.MT),(0,f.k)(e=>e.url.split("/upload/sync/")[1]?.split("/")[0]),(0,V.a)(this.unsubscribeAll)).subscribe(e=>{this.syncService.setCurrentSourceId(e),this.selectedTab="activity",this.cdr.markForCheck()}),this.currentSync.pipe((0,p.U)(1),(0,h.G)(e=>this.syncService.hasCurrentSourceAuth().pipe((0,T.I)(n=>!n),(0,h.G)(()=>this.syncService.getConnector(e.connector.name,e.id)),(0,h.G)(n=>this.syncService.authenticateToConnector(e.connector.name,n))))).subscribe({next:()=>{this.toast.success("upload.authentication.success"),this.router.navigate([],{queryParams:{}})},error:()=>this.toast.error("upload.authentication.failed")})}ngOnDestroy(){this.unsubscribeAll.next(),this.unsubscribeAll.complete()}delete(){this.syncService.currentSourceId.pipe((0,p.U)(1),(0,h.G)(e=>this.syncService.deleteSync(e||""))).subscribe({next:()=>{const e=this.router.url.split("/upload/")[0];this.router.navigate([`${e}/upload`])},error:()=>{this.toast.error("upload.deletion-failed")}})}goTo(e){this.selectedTab=e,this.cdr.markForCheck()}toggle(){this.currentSync.pipe((0,p.U)(1),(0,h.G)(e=>this.syncService.updateSync(e.id,{disabled:!e.disabled}))).subscribe({error:()=>{this.toast.error("upload.failed")}})}static#t=this.\u0275fac=function(n){return new(n||i)(t.GI1(S.gH),t.GI1(C.E5),t.GI1(g.Q$),t.GI1(t.kD9),t.GI1(C.gV))};static#e=this.\u0275cmp=t.In1({type:i,selectors:[["ng-component"]],decls:33,vars:39,consts:[[1,"header"],[3,"src","alt"],[1,"actions"],[3,"value","click"],["icon","trash","aspect","basic",3,"click"],[3,"active","click"],[3,"active"],[3,"goTo"]],template:function(n,s){if(1&n&&(t.I0R(0,"div",0)(1,"h2"),t.wR5(2,"img",1),t.wVc(3,"async"),t.wVc(4,"async"),t.OEk(5),t.wVc(6,"async"),t.C$Y(),t.I0R(7,"div",2)(8,"pa-toggle",3),t.qCj("click",function(){return s.toggle()}),t.wVc(9,"async"),t.OEk(10),t.wVc(11,"translate"),t.C$Y(),t.I0R(12,"pa-button",4),t.qCj("click",function(){return s.delete()}),t.C$Y()()(),t.I0R(13,"pa-tabs")(14,"pa-tab",5),t.qCj("click",function(){return s.selectedTab="activity"}),t.OEk(15),t.wVc(16,"translate"),t.C$Y(),t.yuY(17,Dt,3,4,"pa-tab",6),t.wVc(18,"async"),t.I0R(19,"pa-tab",5),t.qCj("click",function(){return s.selectedTab="filters"}),t.OEk(20),t.wVc(21,"translate"),t.C$Y(),t.I0R(22,"pa-tab",5),t.qCj("click",function(){return s.selectedTab="labels"}),t.OEk(23),t.wVc(24,"translate"),t.C$Y(),t.I0R(25,"pa-tab",5),t.qCj("click",function(){return s.selectedTab="settings"}),t.OEk(26),t.wVc(27,"translate"),t.C$Y()(),t.yuY(28,Ot,2,0,"section")(29,Rt,2,0,"section")(30,wt,2,0,"section")(31,Ft,2,0,"section")(32,Vt,2,0,"section")),2&n){let c,a,l;t.yG2(2),t.E7m("src",null==(c=t.kDX(3,19,s.connector))?null:c.logo,t.K6U)("alt",(null==(a=t.kDX(4,21,s.connector))?null:a.title)+" logo"),t.yG2(3),t.oRS(" ",null==(l=t.kDX(6,23,s.currentSync))?null:l.title," "),t.yG2(3),t.E7m("value",t.kDX(9,25,s.enabled)),t.yG2(2),t.oRS(" ",t.kDX(11,27,"upload.active")," "),t.yG2(4),t.E7m("active","activity"===s.selectedTab),t.yG2(),t.oRS(" ",t.kDX(16,29,"upload.tabs.activity")," "),t.yG2(2),t.C0Y(17,t.kDX(18,31,s.canSelectFiles)?17:-1),t.yG2(2),t.E7m("active","filters"===s.selectedTab),t.yG2(),t.oRS(" ",t.kDX(21,33,"upload.tabs.filters")," "),t.yG2(2),t.E7m("active","labels"===s.selectedTab),t.yG2(),t.oRS(" ",t.kDX(24,35,"upload.tabs.labels")," "),t.yG2(2),t.E7m("active","settings"===s.selectedTab),t.yG2(),t.oRS(" ",t.kDX(27,37,"upload.tabs.settings")," "),t.yG2(2),t.C0Y(28,"activity"===s.selectedTab?28:-1),t.yG2(),t.C0Y(29,"folders"===s.selectedTab?29:-1),t.yG2(),t.C0Y(30,"filters"===s.selectedTab?30:-1),t.yG2(),t.C0Y(31,"labels"===s.selectedTab?31:-1),t.yG2(),t.C0Y(32,"settings"===s.selectedTab?32:-1)}},dependencies:[k.k,U.U,P.U,Q.Y,et,at,St,Et,It,b.a,v.sD],styles:['@charset "UTF-8";.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:1rem}h2[_ngcontent-%COMP%]{display:flex}h2[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:2rem;margin-right:1rem}section[_ngcontent-%COMP%]{margin-top:2rem}.actions[_ngcontent-%COMP%]{align-items:center;display:flex;gap:1rem}'],changeDetection:0})}return i})();const Yt=(i,o)=>o.id;function $t(i,o){if(1&i&&(t.I0R(0,"pa-input",7),t.wVc(1,"translate"),t.OEk(2),t.wVc(3,"translate"),t.C$Y()),2&i){const e=t.GaO().$implicit;t.E7m("help",e.help?t.kDX(1,4,e.help):void 0)("placeholder",e.placeholder)("formControlName",e.id),t.yG2(2),t.oRS(" ",t.kDX(3,6,e.label)," ")}}function At(i,o){if(1&i&&(t.I0R(0,"pa-textarea",8),t.wVc(1,"translate"),t.OEk(2),t.wVc(3,"translate"),t.C$Y()),2&i){const e=t.GaO().$implicit;t.E7m("help",e.help?t.kDX(1,3,e.help):void 0)("formControlName",e.id),t.yG2(2),t.oRS(" ",t.kDX(3,5,e.label)," ")}}function Mt(i,o){if(1&i&&(t.I0R(0,"div",6),t.yuY(1,$t,4,8,"pa-input",7)(2,At,4,7,"pa-textarea",8),t.C$Y()),2&i){const e=o.$implicit;t.yG2(),t.C0Y(1,"text"===e.type?1:-1),t.yG2(),t.C0Y(2,"textarea"===e.type?2:-1)}}function Xt(i,o){if(1&i){const e=t.KQA();t.I0R(0,"form",2),t.qCj("ngSubmit",function(){t.usT(e);const s=t.GaO();return t.CGJ(s.save())}),t.I0R(1,"div",3)(2,"pa-input",4),t.OEk(3),t.wVc(4,"translate"),t.C$Y()(),t.c53(5,Mt,3,2,"div",9,Yt),t.I0R(7,"pa-button",5),t.OEk(8),t.wVc(9,"translate"),t.C$Y()()}if(2&i){const e=t.GaO();t.E7m("formGroup",e.form),t.yG2(3),t.oRS(" ",t.kDX(4,4,"upload.source.name")," "),t.yG2(2),t.oho(e.fields),t.yG2(2),t.E7m("disabled",!e.form.valid),t.yG2(),t.oRS(" ",t.kDX(9,6,"action.save")," ")}}const Ut=new RegExp(/[^a-z0-9_-]/g),Pt=[{path:"",children:[{path:"setup/server",component:X},{path:"add/:connector",component:(()=>{class i{constructor(e,n,s,c,a,l,m){this.syncService=e,this.toast=n,this.formBuilder=s,this.cdr=c,this.router=a,this.route=l,this.sdk=m,this.connectorId=(this.sdk.nuclia.options.standalone?location.hash:location.pathname).split("/upload/sync/add/")[1]||"",this.connector=this.syncService.connectorsObs.pipe((0,f.k)(u=>u.find(_=>_.id===this.connectorId)))}ngOnInit(){this.syncService.getConnector(this.connectorId,"").pipe((0,p.U)(1),(0,h.G)(e=>e.getParameters())).subscribe(e=>this.showFields(e))}save(){const e=this.form?.value.title,n=this.form?.value.fields;let s=e?.toLowerCase().replace(Ut,"-");this.sdk.currentKb.pipe((0,p.U)(1),(0,h.G)(c=>(s=`${c.id}-${s}`,this.syncService.addSync({id:s,connector:{name:this.connectorId||"",parameters:n},title:e}))),(0,E.y)(()=>this.syncService.setCurrentSourceId(s)),(0,h.G)(()=>this.syncService.getConnector(this.connectorId,s).pipe((0,p.U)(1))),(0,h.G)(c=>c.allowToSelectFolders?(0,I.of)(c):("function"==typeof c.handleParameters&&c.handleParameters(n),this.syncService.updateSync(s,{foldersToSync:c.getStaticFolders()}).pipe((0,h.G)(()=>this.syncService.getConnector(this.connectorId,s).pipe((0,p.U)(1)))))),(0,E.y)(c=>{if(c.hasServerSideAuth){let a=location.href.split("/upload/sync/add/")[0];this.sdk.nuclia.options.standalone&&(a=a.replace("#/","")),c.goToOAuth(`${a}/upload/sync/${s}`,!0)}else this.router.navigate([`../../${s}`],{relativeTo:this.route})})).subscribe({next:()=>{this.toast.success("upload.saved")},error:c=>{console.warn(c),this.toast.error("upload.failed")}})}showFields(e){this.fields=e,this.form=this.formBuilder.group({title:["",[d.AQ.required]],fields:this.formBuilder.group(e.reduce((n,s)=>({...n,[s.id]:["",this.getFieldValidators(s)]}),{}))}),this.cdr.markForCheck()}getFieldValidators(e){const n=[];return e.required&&n.push(d.AQ.required),e.pattern&&n.push(d.AQ.pattern(e.pattern)),n}static#t=this.\u0275fac=function(n){return new(n||i)(t.GI1(S.gH),t.GI1(g.Q$),t.GI1(d.KE),t.GI1(t.kD9),t.GI1(C.E5),t.GI1(C.gV),t.GI1(O.E3))};static#e=this.\u0275cmp=t.In1({type:i,selectors:[["ng-component"]],decls:7,vars:10,consts:[[3,"src","alt"],["qa","fields-form",3,"formGroup"],["qa","fields-form",3,"formGroup","ngSubmit"],[1,"field"],["formControlName","title"],["qa","save-button","type","submit",3,"disabled"],["formGroupName","fields",1,"field"],[3,"help","placeholder","formControlName"],[3,"help","formControlName"],["formGroupName","fields","class","field"]],template:function(n,s){if(1&n&&(t.I0R(0,"h2"),t.wR5(1,"img",0),t.wVc(2,"async"),t.wVc(3,"async"),t.OEk(4),t.wVc(5,"async"),t.C$Y(),t.yuY(6,Xt,10,8,"form",1)),2&n){let c,a,l;t.yG2(),t.E7m("src",null==(c=t.kDX(2,4,s.connector))?null:c.logo,t.K6U)("alt",(null==(a=t.kDX(3,6,s.connector))?null:a.title)+" logo"),t.yG2(3),t.oRS(" ",null==(l=t.kDX(5,8,s.connector))?null:l.title,"\n"),t.yG2(2),t.C0Y(6,s.fields&&s.form?6:-1)}},dependencies:[d.sz,d.ue,d.u,d.uW,d.Wo,d.Kh,R.g,Y.a,k.k,b.a,v.sD],styles:['@charset "UTF-8";h2[_ngcontent-%COMP%]{display:flex}h2[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:2rem;margin-right:1rem}.field[_ngcontent-%COMP%]{margin:1rem 0}.field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem}'],changeDetection:0})}return i})()},{path:":id",component:xt}]}];let Qt=(()=>{class i{static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275mod=t.a4G({type:i});static#n=this.\u0275inj=t.s3X({imports:[C.qQ.forChild(Pt),C.qQ]})}return i})();var Nt=r(9132),y=r(6696);let jt=(()=>{class i{static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275mod=t.a4G({type:i});static#n=this.\u0275inj=t.s3X({imports:[C.qQ,b.MD,v.O0,Nt.Y,d.y,d.sl,y.HV,y.qC,y.AL,y.Yh,y.aU,g.In,O.Cc,g.l2,y.Zj,y.sL,y.ek,y.I7]})}return i})(),Kt=(()=>{class i{static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275mod=t.a4G({type:i});static#n=this.\u0275inj=t.s3X({imports:[b.MD,v.O0,y.qC,y.HV,y.Yh,d.sl]})}return i})(),Lt=(()=>{class i{static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275mod=t.a4G({type:i});static#n=this.\u0275inj=t.s3X({imports:[b.MD,Qt,jt,Kt]})}return i})()}}]);